<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Chapter&nbsp;20 InnoDB Cluster</title>
    <link rel="stylesheet" href="mvl.css" type="text/css">
    <meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2">
    <link rel="start" href="index.html" title="{book-title}">
    <link rel="up" href="" title="">
    <link rel="prev" href="document-store.html" title="Chapter&nbsp;19 Using MySQL as a Document Store">
    <link rel="next" href="mysql-cluster.html" title="Chapter&nbsp;21 MySQL NDB Cluster 7.5 and NDB Cluster 7.6">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script></head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
    <table width="100%" summary="Navigation header">
        <tbody><tr>
            <th colspan="3" align="center">Chapter&nbsp;20 InnoDB Cluster</th>
        </tr>
        <tr>
            <td width="20%" align="left"><a accesskey="p" href="document-store.html">Prev</a>&nbsp;</td>
            <th width="60%" align="center"></th>
            <td width="20%" align="right">&nbsp;<a accesskey="n" href="mysql-cluster.html">Next</a></td>
        </tr>
        </tbody></table>
    <hr>
</div>
<div class="chapter">
    <div class="titlepage">
        <div>
            <div>
                <h1 class="title"><a name="mysql-innodb-cluster-userguide"></a>Chapter&nbsp;20&nbsp;InnoDB Cluster</h1>

            </div>

        </div>

    </div>
    <div class="toc">
        <p><b>Table of Contents</b></p><p style="color:blue;">目录</p><dl class="toc"><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-introduction">20.1 Introducing InnoDB Cluster</a></span></dt><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-creating">20.2 Creating an InnoDB Cluster</a></span></dt><dd><dl><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-deployment-methods">20.2.1 Deployment Scenarios</a></span></dt><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-requirements">20.2.2 InnoDB Cluster Requirements</a></span></dt><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-methods-installing">20.2.3 Methods of Installing</a></span></dt><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-sandbox-deployment">20.2.4 Sandbox Deployment of InnoDB Cluster</a></span></dt><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-production-deployment">20.2.5 Production Deployment of InnoDB Cluster</a></span></dt><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-from-group-replication">20.2.6 Adopting a Group Replication Deployment</a></span></dt></dl></dd><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-using-router">20.3 Using MySQL Router with InnoDB Cluster</a></span></dt><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-working-with-cluster">20.4 Working with InnoDB Cluster</a></span></dt><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-limitations">20.5 Known Limitations</a></span></dt></dl>
    </div>
    <p>
        This chapter covers MySQL InnoDB cluster, which combines MySQL
        technologies to enable you to create highly available clusters of
        MySQL server instances.
    </p><p style="color:blue;">本章介绍mysql innodb cluster，它结合了mysql技术，使您能够创建mysql服务器实例的高可用集群。</p>
    <div class="section">

        <div class="titlepage">
            <div>
                <div>
                    <h2 class="title" style="clear: both"><a name="mysql-innodb-cluster-introduction"></a>20.1&nbsp;Introducing InnoDB Cluster</h2>
                </div>
            </div>
        </div>
        <p>
            MySQL InnoDB cluster provides a complete high availability
            solution for MySQL.
            <a class="ulink" href="https://dev.mysql.com/doc/mysql-shell/8.0/en/" target="_top">MySQL Shell</a> includes
            AdminAPI which enables you to easily configure and
            administer a group of at least three MySQL server instances to
            function as an InnoDB cluster. Each MySQL server instance runs
            MySQL Group Replication, which provides the mechanism to
            replicate data within InnoDB clusters, with built-in failover.
            AdminAPI removes the need to work directly with Group
            Replication in InnoDB clusters, but for more information see
            <a class="xref" href="group-replication.html" title="Chapter&nbsp;17&nbsp;Group Replication">Chapter&nbsp;17, <i>Group Replication</i></a> which explains the details.
            <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/" target="_top">MySQL Router</a> can automatically
            configure itself based on the cluster you deploy, connecting
            client applications transparently to the server instances. In the
            event of an unexpected failure of a server instance the cluster
            reconfigures automatically. In the default single-primary mode, an
            InnoDB cluster has a single read-write server instance - the
            primary. Multiple secondary server instances are replicas of the
            primary. If the primary fails, a secondary is automatically
            promoted to the role of primary. MySQL Router detects this and
            forwards client applications to the new primary. Advanced users
            can also configure a cluster to have multiple-primaries.


        </p><p style="color:blue;">mysql innodb cluster为mysql提供了一个完整的高可用性解决方案。mysql shell包含adminapi，它使您能够轻松地配置和管理一组至少三个mysql服务器实例，以作为innodb集群运行。每个mysql服务器实例都运行mysql group replication，它提供了在innodb集群内复制数据的机制，并内置了故障转移。adminapi不需要在innodb集群中直接使用组复制，但是有关更多信息，请参阅第17章，组复制，其中解释了详细信息。mysql路由器可以根据您部署的集群自动配置自己，将客户端应用程序透明地连接到服务器实例。如果服务器实例发生意外故障，群集将自动重新配置。在默认的单主模式下，innodb集群有一个读写服务器实例-主服务器。多个辅助服务器实例是主服务器的副本。如果主服务器失败，则会自动将辅助服务器提升为主服务器的角色。mysql路由器检测到这一点并将客户端应用程序转发到新的主服务器。高级用户还可以将集群配置为具有多个主节点。</p>
        <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

            <div class="admon-title">
                Important
            </div>
            <p>
                InnoDB cluster does not provide support for MySQL NDB Cluster.
                NDB Cluster depends on the <a class="link" href="mysql-cluster.html" title="Chapter&nbsp;21&nbsp;MySQL NDB Cluster 7.5 and NDB Cluster 7.6"><code class="literal">NDB</code></a> storage
                engine as well as a number of programs specific to NDB Cluster which
                are not furnished with MySQL Server 5.7;
                <code class="literal">NDB</code> is available only as part of the MySQL
                NDB Cluster distribution. In addition, the MySQL server binary
                (<a class="link" href="programs.html#mysqld" title="4.3.1&nbsp;mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>) that is supplied with MySQL Server
                5.7 cannot be used with NDB Cluster. For more
                information about MySQL NDB Cluster, see
                <a class="xref" href="mysql-cluster.html" title="Chapter&nbsp;21&nbsp;MySQL NDB Cluster 7.5 and NDB Cluster 7.6">Chapter&nbsp;21, <i>MySQL NDB Cluster 7.5 and NDB Cluster 7.6</i></a>.
                <a class="xref" href="mysql-cluster.html#mysql-cluster-compared" title="21.1.6&nbsp;MySQL Server Using InnoDB Compared with NDB Cluster">Section&nbsp;21.1.6, “MySQL Server Using InnoDB Compared with NDB Cluster”</a>, provides information
                about the differences between the <code class="literal">InnoDB</code> and
                <code class="literal">NDB</code> storage engines.
            </p><p style="color:blue;">innodb cluster不支持mysql ndb cluster。ndb cluster依赖于ndb存储引擎以及一些特定于ndb cluster的程序，这些程序不随mysql server 5.7提供；ndb仅作为mysql ndb cluster分发的一部分可用。此外，mysql server 5.7提供的mysql服务器二进制文件（mysqld）不能与ndb集群一起使用。有关mysql ndb cluster的详细信息，请参阅第21章mysql ndb cluster 7.5和ndb cluster 7.6。第21.1.6节“与ndb集群相比，使用innodb的mysql服务器”提供了有关innodb和ndb存储引擎之间差异的信息。</p>
        </div>
        <p>
            The following diagram shows an overview of how these technologies
            work together:
        </p><p style="color:blue;">下图显示了这些技术如何协同工作的概述：</p>
        <div class="figure">
            <a name="innodb-cluster-overview-image"></a><p class="title"><b>Figure&nbsp;20.1&nbsp;InnoDB cluster overview</b></p><p style="color:blue;">图20.1 InnoDB集群概述</p>
            <div class="figure-contents">

                <div class="mediaobject">
                    <img src="images/innodb_cluster_overview.png" width="600" height="753" alt="Three MySQL servers are grouped together as a high availability cluster. One of the servers is the read/write primary instance, and the other two are read-only secondary instances. Group Replication is used to replicate data from the primary instance to the secondary instances. MySQL Router connects client applications (in this example, a MySQL Connector) to the primary instance. The cluster admin capability in MySQL Shell can connect directly to the primary instance using the MySQL X AdminAPI, or it can connect through MySQL Router like other client applications.">
                </div>

            </div>

        </div>
        <br class="figure-break">
        <div class="simplesect">

            <div class="titlepage">
                <div>

                    <div class="simple">
                        <h3 class="title"><a name="admin-api"></a>Using AdminAPI</h3>

                    </div>

                </div>

            </div>
            <p>
                MySQL Shell includes the AdminAPI, which is accessed
                through the <code class="literal">dba</code> global variable and its
                associated methods. The <code class="literal">dba</code> variable's
                methods enable you to deploy, configure, and administer InnoDB
                clusters. For example, use the
                <code class="literal">dba.createCluster()</code> method to create an
                InnoDB cluster.
            </p><p style="color:blue;">mysql shell包括adminapi，可以通过dba全局变量及其相关方法访问它。dba变量的方法使您能够部署、配置和管理innodb集群。例如，使用dba.createCluster（）方法创建InnoDB集群。</p>
            <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Important
                </div>
                <p>
                    MySQL Shell enables you to connect to servers over a socket
                    connection, but AdminAPI requires TCP connections to a
                    server instance. Do not use socket based connections with
                    AdminAPI.
                </p><p style="color:blue;">mysql shell允许您通过套接字连接到服务器，但是adminapi需要到服务器实例的tcp连接。不要对adminapi使用基于套接字的连接。</p>
            </div>
            <p>
                MySQL Shell provides online help for the AdminAPI. To
                list all available <code class="literal">dba</code> commands, use the
                <code class="literal">dba.help()</code> method. For online help on a
                specific method, use the general format
                <code class="literal">object.help('methodname')</code>. For example:
            </p><p style="color:blue;">mysql shell为adminapi提供联机帮助。要列出所有可用的dba命令，请使用dba.help（）方法。有关特定方法的联机帮助，请使用常规格式对象.help（'methodname'）。例如：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>dba.help('getCluster')</code></strong>

Retrieves a cluster from the Metadata Store.

SYNTAX
  &lt;Dba&gt;.getCluster([name])

WHERE
  name: Parameter to specify the name of the cluster to be returned.

DESCRIPTION

If name is not specified, the default cluster will be returned.

If name is specified, and no cluster with the indicated name is found, an error
will be raised.
</pre>
        </div>

    </div>
    <div class="section">
        <div class="titlepage">
            <div>
                <div>
                    <h2 class="title" style="clear: both"><a name="mysql-innodb-cluster-creating"></a>20.2&nbsp;Creating an InnoDB Cluster</h2>

                </div>

            </div>

        </div>
        <div class="toc">
            <dl class="toc"><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-deployment-methods">20.2.1 Deployment Scenarios</a></span></dt><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-requirements">20.2.2 InnoDB Cluster Requirements</a></span></dt><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-methods-installing">20.2.3 Methods of Installing</a></span></dt><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-sandbox-deployment">20.2.4 Sandbox Deployment of InnoDB Cluster</a></span></dt><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-production-deployment">20.2.5 Production Deployment of InnoDB Cluster</a></span></dt><dt><span class="section"><a href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-from-group-replication">20.2.6 Adopting a Group Replication Deployment</a></span></dt></dl>
        </div>
        <p>
            This section explains the different ways you can create an
            InnoDB cluster, the requirements for server instances and the
            software you need to install to deploy a cluster.
        </p><p style="color:blue;">本节介绍创建innodb集群的不同方法、服务器实例的要求以及部署集群所需安装的软件。</p>
        <div class="section">

            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="mysql-innodb-cluster-deployment-methods"></a>20.2.1&nbsp;Deployment Scenarios</h3>
                    </div>
                </div>
            </div>
            <p>
                InnoDB cluster supports the following deployment scenarios:
            </p><p style="color:blue;">InnoDB集群支持以下部署场景：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    <span class="emphasis"><em>Sandbox deployment:</em></span> if you want to test
                    out InnoDB cluster before committing to a full production
                    deployment, the provided sandbox feature enables you to
                    quickly set up a cluster on your local machine. Sandbox
                    server instances are created with the required configuration
                    and you can experiment with InnoDB cluster to become
                    familiar with the technologies employed. See
                    <a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-sandbox-deployment" title="20.2.4&nbsp;Sandbox Deployment of InnoDB Cluster">Section&nbsp;20.2.4, “Sandbox Deployment of InnoDB Cluster”</a>
                    for instructions.
                </p><p style="color:blue;">沙箱部署：如果您想在提交到完整的生产部署之前测试InnoDB集群，那么提供的沙箱功能可以让您在本地计算机上快速设置集群。沙盒服务器实例是用所需的配置创建的，您可以尝试使用innodb集群来熟悉所使用的技术。有关说明，请参阅20.2.4节，“InnoDB群集的沙盒部署”。</p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Production deployment:</em></span> if you want to
                    use InnoDB cluster in a full production environment you
                    need to configure the required number of machines and then
                    deploy your server instances to the machines. A production
                    deployment enables you to exploit the high availability
                    features of InnoDB cluster to their full potential. See
                    <a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-production-deployment" title="20.2.5&nbsp;Production Deployment of InnoDB Cluster">Section&nbsp;20.2.5, “Production Deployment of InnoDB Cluster”</a>
                    for instructions.
                </p><p style="color:blue;">生产部署：如果您想在一个完整的生产环境中使用innodb cluster，您需要配置所需数量的机器，然后将服务器实例部署到这些机器上。生产部署使您能够充分利用innodb集群的高可用性特性。有关说明，请参阅20.2.5节，“InnoDB集群的生产部署”。</p></li></ul>
            </div>
            <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
                <div class="admon-title">
                    Important
                </div>
                <p>
                    A sandbox deployment is not suitable for use in a full
                    production environment.
                </p><p style="color:blue;">沙盒部署不适合在完整的生产环境中使用。</p>
            </div>

        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="mysql-innodb-cluster-requirements"></a>20.2.2&nbsp;InnoDB Cluster Requirements</h3>

                    </div>

                </div>

            </div>
            <p>
                Before installing a production deployment of InnoDB cluster,
                ensure that the server instances you intend to use meet the
                following requirements.
            </p><p style="color:blue;">在安装innodb cluster的生产部署之前，请确保要使用的服务器实例满足以下要求。</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    InnoDB cluster uses Group Replication and therefore your
                    server instances must meet the same requirements. See
                    <a class="xref" href="group-replication.html#group-replication-requirements" title="17.7.1&nbsp;Group Replication Requirements">Section&nbsp;17.7.1, “Group Replication Requirements”</a>.
                    AdminAPI provides the
                    <code class="literal">dba.checkInstanceConfiguration()</code> method
                    to verify that an instance meets the Group Replication
                    requirements, and the
                    <code class="literal">dba.configureLocalInstance()</code> method to
                    configure an instance to meet the requirements.
                </p><p style="color:blue;">innodb cluster使用组复制，因此服务器实例必须满足相同的要求。见第17.7.1节“组复制要求”。adminapi提供dba.checkInstanceConfiguration（）方法来验证实例是否满足组复制要求，并提供dba.configureLocalInstance（）方法来配置实例以满足要求。</p>
                    <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

                        <div class="admon-title">
                            Note
                        </div>
                        <p>
                            When using a sandbox deployment the instances are
                            configured to meet these requirements automatically.
                        </p><p style="color:blue;">当使用沙箱部署时，实例被配置为自动满足这些要求。</p>
                    </div>
                </li><li class="listitem"><p>
                    Group Replication members can contain tables using a storage
                    engine other than <a class="link" href="innodb-storage-engine.html" title="Chapter&nbsp;14&nbsp;The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>, for
                    example <a class="link" href="storage-engines.html#myisam-storage-engine" title="15.2&nbsp;The MyISAM Storage Engine"><code class="literal">MyISAM</code></a>. Such tables
                    cannot be written to by Group Replication, and therefore
                    when using InnoDB cluster. To be able to write to such
                    tables with InnoDB cluster, convert all such tables to
                    <a class="link" href="innodb-storage-engine.html" title="Chapter&nbsp;14&nbsp;The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> before using the
                    instance in a InnoDB cluster.
                </p><p style="color:blue;">组复制成员可以包含使用innodb以外的存储引擎的表，例如myisam。这样的表不能通过组复制写入，因此当使用innodb cluster时。为了能够使用innodb cluster写入这些表，在使用innodb集群中的实例之前，将所有这些表转换为innodb。</p></li><li class="listitem"><p>
                    The Performance Schema must be enabled on any instance which
                    you want to use with InnoDB cluster.
                </p><p style="color:blue;">必须在要与innodb cluster一起使用的任何实例上启用性能架构。</p></li><li class="listitem"><p>
                    The provisioning scripts that MySQL Shell uses to
                    configure servers for use in InnoDB cluster require access
                    to Python version 2.7. For a sandbox deployment Python is
                    required on the single machine used for the deployment,
                    production deployments require Python on each server
                    instance.
                </p><p style="color:blue;">mysql shell用于配置服务器以在innodb集群中使用的配置脚本需要访问python 2.7版本。对于沙盒部署，用于部署的单机上需要使用python，而生产部署则需要在每个服务器实例上使用python。</p><p>
                    On Windows MySQL Shell includes Python and no user
                    configuration is required. On Unix Python must be found as
                    part of the shell environment. To check that your system has
                    Python configured correctly issue:
                </p><p style="color:blue;">在windows上，mysql shell包含python，不需要用户配置。在unix上，python必须作为shell环境的一部分找到。要检查系统是否正确配置了python，请执行以下操作：</p><pre data-lang="terminal" class="programlisting">$ <strong class="userinput"><code>/usr/bin/env python</code></strong></pre><p>
                    If a Python interpreter starts, no further action is
                    required. If the previous command fails, create a soft link
                    between <code class="literal">/usr/bin/python</code> and your chosen
                    Python binary.
                </p><p style="color:blue;">如果python解释器启动，则无需进一步操作。如果前面的命令失败，请在/usr/bin/python和您选择的python二进制文件之间创建一个软链接。</p></li></ul>
            </div>

        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="mysql-innodb-cluster-methods-installing"></a>20.2.3&nbsp;Methods of Installing</h3>

                    </div>

                </div>

            </div>
            <p>
                The method you use to install InnoDB cluster depends on the
                type of deployment you intend to use. For a sandbox deployment
                install the components of InnoDB cluster to a single machine.
                A sandbox deployment is local to a single machine, therefore the
                install needs to only be done once on the local machine.
                Similarly there is no need to connect to the instances
                individually for configuration, the sandbox instances are local.
                For a production deployment install the components to each
                machine that you intend to add to your cluster. A production
                deployment uses multiple remote host machines running MySQL
                server instances, so you need to connect to each machine using a
                tool such as SSH or Windows remote desktop to carry out tasks
                such as installing components and configuring the server
                instance. The following methods of installing InnoDB cluster
                are available:
            </p><p style="color:blue;">安装innodb cluster的方法取决于要使用的部署类型。对于沙箱部署，将innodb集群的组件安装到一台机器上。沙盒部署是单个计算机的本地部署，因此只需在本地计算机上进行一次安装。同样，不需要单独连接到实例进行配置，沙盒实例是本地的。对于生产部署，请将组件安装到要添加到群集的每台计算机上。生产部署使用多个运行mysql服务器实例的远程主机，因此需要使用ssh或windows远程桌面等工具连接到每台计算机，以执行安装组件和配置服务器实例等任务。以下是安装innodb集群的方法：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    Downloading and installing the components using the
                    following documentation:
                </p><p style="color:blue;">使用以下文档下载和安装组件：</p>
                    <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                            MySQL Server - see <a class="xref" href="installing.html" title="Chapter&nbsp;2&nbsp;Installing and Upgrading MySQL">Chapter&nbsp;2, <i>Installing and Upgrading MySQL</i></a>.
                        </p><p style="color:blue;">mysql服务器-见第2章，安装和升级mysql。</p></li><li class="listitem"><p>
                            MySQL Shell - see
                            <a class="xref" href="document-store.html#document-store-shell-install" title="19.3.1&nbsp;Installing MySQL Shell">Section&nbsp;19.3.1, “Installing MySQL Shell”</a>.
                        </p><p style="color:blue;">mysql shell-参见第19.3.1节“安装mysql shell”。</p></li><li class="listitem"><p>
                            MySQL Router - see
                            <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysql-router-installation.html" target="_top">Installing MySQL Router</a>.
                        </p><p style="color:blue;">MySQL路由器-请参阅安装MySQL路由器。</p></li></ul>
                    </div>
                </li><li class="listitem"><p>
                    On Windows you can use the MySQL Installer for Windows for a
                    sandbox deployment. For details, see
                    <a class="xref" href="installing.html#mysql-installer-workflow-innodb-cluster" title="2.3.3.3.1.1&nbsp;High Availability">Section&nbsp;2.3.3.3.1.1, “High Availability”</a>.
                </p><p style="color:blue;">在windows上，您可以使用mysql installer for windows进行沙盒部署。有关详细信息，请参见第2.3.3.3.1.1节“高可用性”。</p></li></ul>
            </div>
            <p>
                Once you have installed the software required by
                InnoDB cluster choose to follow either
                <a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-sandbox-deployment" title="20.2.4&nbsp;Sandbox Deployment of InnoDB Cluster">Section&nbsp;20.2.4, “Sandbox Deployment of InnoDB Cluster”</a> or
                <a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-production-deployment" title="20.2.5&nbsp;Production Deployment of InnoDB Cluster">Section&nbsp;20.2.5, “Production Deployment of InnoDB Cluster”</a>.
            </p><p style="color:blue;">安装完innodb cluster所需的软件后，选择遵循20.2.4节“innodb cluster的沙箱部署”或20.2.5节“innodb cluster的生产部署”。</p>
        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="mysql-innodb-cluster-sandbox-deployment"></a>20.2.4&nbsp;Sandbox Deployment of InnoDB Cluster</h3>

                    </div>

                </div>

            </div>
            <p>
                This section explains how to set up a sandbox InnoDB cluster
                deployment. You create and administer your InnoDB clusters using
                MySQL Shell with the included AdminAPI. This section assumes
                familiarity with MySQL Shell, see
                <a class="ulink" href="https://dev.mysql.com/doc/mysql-shell/8.0/en/" target="_top">MySQL Shell 8.0 (part of MySQL 8.0)</a> for further information.
            </p><p style="color:blue;">本节介绍如何设置沙盒innodb集群部署。您可以使用带有adminapi的mysql shell创建和管理innodb集群。本节假设您熟悉mysql shell，有关更多信息，请参见mysql shell 8.0（mysql 8.0的一部分）。</p><p>
            Initially deploying and using local sandbox instances of MySQL
            is a good way to start your exploration of InnoDB cluster. You
            can fully test out InnoDB cluster locally, prior to deployment
            on your production servers. MySQL Shell has built-in
            functionality for creating sandbox instances that are correctly
            configured to work with Group Replication in a locally deployed
            scenario.
        </p><p style="color:blue;">最初部署和使用mysql的本地沙盒实例是开始探索innodb集群的好方法。在生产服务器上部署之前，您可以在本地完全测试InnoDB集群。mysql shell内置了创建沙盒实例的功能，这些沙盒实例被正确配置为在本地部署的场景中使用组复制。</p>
            <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Important
                </div>
                <p>
                    Sandbox instances are only suitable for deploying and running
                    on your local machine for testing purposes. In a production
                    environment the MySQL Server instances are deployed to various
                    host machines on the network. See
                    <a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-production-deployment" title="20.2.5&nbsp;Production Deployment of InnoDB Cluster">Section&nbsp;20.2.5, “Production Deployment of InnoDB Cluster”</a>
                    for more information.
                </p><p style="color:blue;">沙盒实例只适合在本地计算机上部署和运行以进行测试。在生产环境中，mysql服务器实例被部署到网络上的各种主机上。详见20.2.5节“InnoDB集群的生产部署”。</p>
            </div>
            <p>
                This tutorial shows how to use MySQL Shell to create an
                InnoDB cluster consisting of three MySQL server instances.
            </p><p style="color:blue;">本教程演示如何使用mysql shell创建由三个mysql服务器实例组成的innodb集群。</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#deploy-sandbox-instances" title="Deploying Sandbox Instances">Deploying Sandbox Instances</a></p><p style="color:blue;">部署沙盒实例</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#create-innodb-cluster" title="Creating the Sandbox InnoDB Cluster">Creating the Sandbox InnoDB Cluster</a></p><p style="color:blue;">创建沙盒innodb集群</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#add-instances-innodb-cluster" title="Adding Instances to an InnoDB Cluster">Adding Instances to an InnoDB Cluster</a></p><p style="color:blue;">向innodb集群添加实例</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#persist-configuration-innodb-cluster" title="Persisting the Configuration">Persisting the Configuration</a></p><p style="color:blue;">持久化配置</p></li></ul>
            </div>

            <div class="simplesect">

                <div class="titlepage">
                    <div>

                        <div class="simple">
                            <h4 class="title"><a name="deploy-sandbox-instances"></a>Deploying Sandbox Instances</h4>

                        </div>

                    </div>

                </div>
                <p>
                    MySQL Shell includes the AdminAPI that adds the
                    <code class="literal">dba</code> global variable, which provides
                    functions for administration of sandbox instances. In this
                    example setup, you create three sandbox instances using
                    <code class="literal">dba.deploySandboxInstance()</code>.
                </p><p style="color:blue;">mysql shell包含添加dba全局变量的adminapi，该变量提供管理沙盒实例的功能。在这个示例设置中，使用dba.deploySandboxInstance（）创建三个沙盒实例。</p><p>
                Start MySQL Shell from a command prompt by issuing the
                command:
            </p><p style="color:blue;">通过发出以下命令从命令提示符启动mysql shell：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlsh</code></strong>
</pre><p>
                MySQL Shell provides two scripting language modes,
                JavaScript and Python, in addition to a native SQL mode.
                Throughout this guide MySQL Shell is used primarily in
                JavaScript mode



                . When MySQL Shell starts it is in JavaScript mode by
                default. Switch modes by issuing <code class="literal">\js</code> for
                JavaScript mode, <code class="literal">\py</code> for Python mode, and
                <code class="literal">\sql</code> for SQL mode. Ensure you are in
                JavaScript mode by issuing the <code class="literal">\js</code> command,
                then execute:
            </p><p style="color:blue;">mysql shell提供了两种脚本语言模式，javascript和python，另外还有一种本地sql模式。在本指南中，mysql shell主要用于javascript模式。mysql shell启动时，默认情况下处于javascript模式。通过发出\js for javascript mode、\py for python mode和\sql for sql mode来切换模式。通过发出\js命令确保处于javascript模式，然后执行：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>dba.deploySandboxInstance(3310)</code></strong>
</pre>
                <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

                    <div class="admon-title">
                        Note
                    </div>
                    <p>
                        Terminating commands with a semi-colon is not required in
                        JavaScript and Python modes.
                    </p><p style="color:blue;">在javascript和python模式下，不需要用分号终止命令。</p>
                </div>
                <p>
                    The argument passed to
                    <code class="literal">deploySandboxInstance()</code> is the TCP port
                    number where the MySQL Server instance listens for
                    connections. By default the sandbox is created in a directory
                    named
                    <code class="literal">$HOME/mysql-sandboxes/<em class="replaceable"><code>port</code></em></code>
                    on Unix systems. For Microsoft Windows systems the directory
                    is
                    <code class="literal">%userprofile%\MySQL\mysql-sandboxes\<em class="replaceable"><code>port</code></em></code>.
                </p><p style="color:blue;">传递给deploySandboxInstance（）的参数是MySQL服务器实例侦听连接的TCP端口号。默认情况下，沙盒是在unix系统上名为$home/mysql sandboxes/port的目录中创建的。对于Microsoft Windows系统，目录是%userprofile%\mysql\mysql sandboxes\port。</p><p>
                The root password for the instance is prompted for.
            </p><p style="color:blue;">系统将提示输入实例的根密码。</p>
                <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

                    <div class="admon-title">
                        Important
                    </div>
                    <p>
                        Each instance has its own password. Defining the same
                        password for all sandboxes in this tutorial makes it easier,
                        but remember to use different passwords for each instance in
                        production deployments.
                    </p><p style="color:blue;">每个实例都有自己的密码。在本教程中为所有沙盒定义相同的密码会更容易，但请记住在生产部署中为每个实例使用不同的密码。</p>
                </div>
                <p>
                    To deploy further sandbox server instances, repeat the steps
                    followed for the sandbox instance at port 3310, choosing
                    different port numbers. For each additional sandbox instance
                    issue:
                </p><p style="color:blue;">要进一步部署沙盒服务器实例，请在端口3310处对沙盒实例重复以下步骤，选择不同的端口号。对于每个附加的沙盒实例问题：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>dba.deploySandboxInstance(<em class="replaceable"><code>port_number</code></em>)</code></strong>
</pre><p>
                To follow this tutorial, use port numbers 3310, 3320 and 3330
                for the three sandbox server instances. Issue:
            </p><p style="color:blue;">要遵循本教程，请对三个沙盒服务器实例使用端口号3310、3320和3330。问题</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>dba.deploySandboxInstance(<em class="replaceable"><code>3320</code></em>)</code></strong>
mysql-js&gt; <strong class="userinput"><code>dba.deploySandboxInstance(<em class="replaceable"><code>3330</code></em>)</code></strong>
</pre>
            </div>
            <div class="simplesect">
                <div class="titlepage">
                    <div>
                        <div class="simple">
                            <h4 class="title"><a name="create-innodb-cluster"></a>Creating the Sandbox InnoDB Cluster</h4>

                        </div>

                    </div>

                </div>
                <p>
                    The next step is to create the InnoDB cluster while
                    connected to the seed MySQL Server instance. The seed instance
                    contains the data that you want to replicate to the other
                    instances. In this example the sandbox instances are blank,
                    therefore we can choose any instance.
                </p><p style="color:blue;">下一步是在连接到seed mysql服务器实例时创建innodb集群。seed实例包含要复制到其他实例的数据。在本例中，沙盒实例为空，因此我们可以选择任何实例。</p><p>
                Connect MySQL Shell to the seed instance, in this case the
                one at port 3310:
            </p><p style="color:blue;">将mysql shell连接到seed实例，在本例中是端口3310：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>\connect root@localhost:3310</code></strong></pre><p>
                The <code class="literal">\connect</code> MySQL Shell command is a
                shortcut for the <code class="literal">shell.connect()</code> method:
            </p><p style="color:blue;">\connect mysql shell命令是shell.connect（）方法的快捷方式：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>shell.connect('root@localhost:3310')</code></strong>
</pre><p>
                Once you have connected, AdminAPI can write to the local
                instance's option file. This is different to working with
                a production deployment, where you would need to connect to
                the remote instance and run the MySQL Shell application
                locally on the instance before AdminAPI can write to
                the instance's option file.
            </p><p style="color:blue;">连接后，adminapi可以写入本地实例的选项文件。这与使用生产部署不同，在生产部署中，您需要连接到远程实例并在实例上本地运行mysql shell应用程序，然后adminapi才能写入实例的选项文件。</p><p>
                Use the <code class="literal">dba.createCluster()</code> method to
                create the InnoDB cluster with the currently connected
                instance as the seed:
            </p><p style="color:blue;">使用dba.createCluster（）方法创建InnoDB集群，当前连接的实例作为种子：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>var cluster = dba.createCluster('testCluster')</code></strong>
</pre><p>
                The <code class="literal">createCluster()</code> method deploys the
                InnoDB cluster metadata to the selected instance, and adds
                the instance you are currently connected to as the seed
                instance. The <code class="literal">createCluster()</code> method
                returns the created cluster, in the example above this is
                assigned to the <code class="literal">cluster</code> variable. The
                parameter passed to the <code class="literal">createCluster()</code>
                method is a symbolic name given to this InnoDB cluster, in
                this case <code class="literal">testCluster</code>.
            </p><p style="color:blue;">createCluster（）方法将innodb集群元数据部署到所选实例，并将当前连接到的实例添加为seed实例。createCluster（）方法返回创建的集群，在上面的示例中，这被分配给集群变量。传递给createCluster（）方法的参数是给这个innodb集群的符号名，在本例中是testCluster。</p>
                <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

                    <div class="admon-title">
                        Tip
                    </div>
                    <p>
                        If the instance has
                        <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a> then you
                        might need to confirm that AdminAPI can set
                        <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a>. See
                        <a class="xref" href="mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="Super Read-only and Instances">Super Read-only and Instances</a> for more
                        information.
                    </p><p style="color:blue;">如果实例的super_read_only=on，则可能需要确认adminapi可以设置super_read_only=off。有关详细信息，请参见超级只读和实例。</p>
                </div>

            </div>
            <div class="simplesect">
                <div class="titlepage">
                    <div>
                        <div class="simple">
                            <h4 class="title"><a name="add-instances-innodb-cluster"></a>Adding Instances to an InnoDB Cluster</h4>

                        </div>

                    </div>

                </div>
                <p>
                    The next step is to add more instances to the
                    InnoDB cluster. Any transactions that were executed by the
                    seed instance are re-executed by each secondary instance as it
                    is added. This tutorial uses the sandbox instances that were
                    created earlier at ports 3320 and 3330.
                </p><p style="color:blue;">下一步是向innodb集群添加更多实例。seed实例执行的任何事务在添加时都由每个辅助实例重新执行。本教程使用先前在端口3320和3330创建的沙盒实例。</p><p>
                The seed instance in this example was recently created, so it
                is nearly empty. Therefore, there is little data that needs to
                be replicated from the seed instance to the secondary
                instances. In a production environment, where you have an
                existing database on the seed instance, you could use a tool
                such as MySQL Enterprise Backup to ensure that the secondaries have matching
                data before replication starts. This avoids the possibility of
                lengthy delays while data replicates from the primary to the
                secondaries. See
                <a class="xref" href="group-replication.html#group-replication-enterprise-backup" title="17.4.4&nbsp;Using MySQL Enterprise Backup with Group Replication">Section&nbsp;17.4.4, “Using MySQL Enterprise Backup with Group Replication”</a>.
            </p><p style="color:blue;">本例中的seed实例是最近创建的，因此几乎为空。因此，很少有数据需要从种子实例复制到辅助实例。在生产环境中，在种子实例上有一个现有的数据库，可以使用诸如MySQL企业备份这样的工具，以确保在复制开始之前，次级数据具有匹配的数据。这避免了数据从主数据复制到辅助数据时出现长时间延迟的可能性。请参阅17.4.4节，“将mysql企业备份与组复制结合使用”。</p><p>
                Add the second instance to the InnoDB cluster:
            </p><p style="color:blue;">将第二个实例添加到innodb集群：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>cluster.addInstance('root@localhost:3320')</code></strong>
</pre><p>
                The root user's password is prompted for.
            </p><p style="color:blue;">提示输入根用户的密码。</p><p>
                Add the third instance:
            </p><p style="color:blue;">添加第三个实例：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>cluster.addInstance('root@localhost:3330')</code></strong>
</pre><p>
                The root user's password is prompted for.
            </p><p style="color:blue;">提示输入根用户的密码。</p><p>
                At this point you have created a cluster with three instances:
                a primary, and two secondaries.
            </p><p style="color:blue;">此时，您已经创建了一个包含三个实例的集群：一个主实例和两个辅助实例。</p>
                <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

                    <div class="admon-title">
                        Tip
                    </div>
                    <p>
                        You can only specify <code class="literal">localhost</code> in
                        <code class="literal">addInstance()</code> if the instance is a
                        sandbox instance. This also applies to the implicit
                        <code class="literal">addInstance()</code> after issuing
                        <code class="literal">createCluster()</code>.
                    </p><p style="color:blue;">如果实例是沙盒实例，则只能在addInstance（）中指定localhost。这也适用于发出createcluster（）后的隐式addinstance（）。</p>
                </div>

            </div>
            <div class="simplesect">
                <div class="titlepage">
                    <div>
                        <div class="simple">
                            <h4 class="title"><a name="persist-configuration-innodb-cluster"></a>Persisting the Configuration</h4>

                        </div>

                    </div>

                </div>
                <p>
                    Once the sandbox instances have been added to the cluster, the
                    configuration required for InnoDB cluster must be persisted
                    to each of the instance's option files. Connect to each
                    instance.
                </p><p style="color:blue;">一旦沙盒实例被添加到集群中，innodb集群所需的配置必须持久化到每个实例的选项文件中。连接到每个实例。</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>\connect <em class="replaceable"><code>instance</code></em></code></strong></pre><p>
                Issue
                <code class="literal">dba.configureLocalInstance(<em class="replaceable"><code>instance</code></em>)</code>.
            </p><p style="color:blue;">发布dba.configureLocalInstance（实例）。</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>dba.configureLocalInstance('<em class="replaceable"><code>instance</code></em>')</code></strong>
</pre><p>
                You are prompted for the instance's password. The
                configuration changes are persisted to the instance.
            </p><p style="color:blue;">系统会提示您输入实例的密码。配置更改将持久化到实例。</p>
                <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

                    <div class="admon-title">
                        Important
                    </div>
                    <p>
                        If <code class="literal">dba.configureLocalInstance()</code> is not
                        issued when connected to the instance, the configuration is
                        not persisted to the option file. This does not stop the
                        instance from initially joining a cluster, but it does mean
                        that the instance cannot rejoin the cluster automatically,
                        for example after being stopped.
                    </p><p style="color:blue;">如果在连接到实例时未发出dba.configureLocalInstance（），则配置不会持久化到选项文件。这不会阻止实例最初加入群集，但确实意味着实例无法自动重新加入群集，例如在被停止后。</p>
                </div>
                <p>
                    Repeat the process of connecting to each sandbox instance you
                    added to the cluster and persisting the configuration. For
                    this example we added sandbox instances at ports 3310, 3320
                    and 3330. Therefore issue this for ports 3320 and 3330:
                </p><p style="color:blue;">重复连接到添加到集群的每个沙箱实例并持久化配置的过程。在本例中，我们在端口3310、3320和3330添加了沙盒实例。因此，对端口3320和3330发出此命令：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>\connect root@localhost:<em class="replaceable"><code>port_number</code></em></code></strong>
mysql-js&gt; <strong class="userinput"><code>dba.configureLocalInstance('root@localhost:<em class="replaceable"><code>port_number</code></em>')</code></strong>
 </pre><p>
                To check the cluster has been created, use the cluster
                instance's <code class="literal">status()</code> function. See
                <a class="xref" href="mysql-innodb-cluster-userguide.html#check-innodb-cluster-status" title="Checking the InnoDB Cluster Status">Checking the InnoDB Cluster Status</a>.
            </p><p style="color:blue;">要检查群集是否已创建，请使用群集实例的status（）函数。请参阅检查innodb集群状态。</p><p>
                Once you have your cluster deployed you can configure MySQL Router
                to provide high availability, see
                <a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-using-router" title="20.3&nbsp;Using MySQL Router with InnoDB Cluster">Section&nbsp;20.3, “Using MySQL Router with InnoDB Cluster”</a>.


            </p><p style="color:blue;">一旦部署了集群，就可以配置mysql路由器以提供高可用性，请参阅20.3节，“将mysql路由器与innodb集群一起使用”。</p>
            </div>

        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="mysql-innodb-cluster-production-deployment"></a>20.2.5&nbsp;Production Deployment of InnoDB Cluster</h3>

                    </div>

                </div>

            </div>
            <p>
                When working in a production environment, the MySQL server
                instances which make up an InnoDB cluster run on multiple host
                machines as part of a network



                rather than on single machine as described in
                <a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-sandbox-deployment" title="20.2.4&nbsp;Sandbox Deployment of InnoDB Cluster">Section&nbsp;20.2.4, “Sandbox Deployment of InnoDB Cluster”</a>.
                Before proceeding with these instructions you must install the
                required software to each machine that you intend to add as a
                server instance to your cluster, see
                <a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-methods-installing" title="20.2.3&nbsp;Methods of Installing">Section&nbsp;20.2.3, “Methods of Installing”</a>.
            </p><p style="color:blue;">在生产环境中工作时，组成InnoDB集群的MySQL服务器实例作为网络的一部分运行在多台主机上，而不是在“InnoDB集群的沙箱部署”一节中所述的单机上。在继续执行这些说明之前，必须将所需的软件安装到要作为服务器实例添加到群集的每台计算机上，请参阅第20.2.3节“安装方法”。</p><p>
            The following diagram illustrates the scenario you work with in
            this section:
        </p><p style="color:blue;">下图说明了在本节中使用的场景：</p>
            <div class="figure">
                <a name="production-servers-image"></a><p class="title"><b>Figure&nbsp;20.2&nbsp;Production Deployment</b></p><p style="color:blue;">图20.2生产部署</p>
                <div class="figure-contents">

                    <div class="mediaobject">
                        <img src="images/production_servers.png" width="600" height="837" alt="Three MySQL servers are grouped together as a production InnoDB cluster. One of the servers is the primary instance, and the other two are secondary instances. The IP address for the primary server is 139.59.177.10, and the IP addresses for the two secondary instances are 139.59.177.11 and 139.59.177.12. MySQL Router connects a client application to the primary instance. The admin capability in MySQL Shell interacts directly with the production InnoDB cluster.">
                    </div>

                </div>

            </div>
            <br class="figure-break">
            <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Important
                </div>
                <p>
                    Unlike a sandbox deployment, where all instances are deployed
                    locally to one machine, for a production deployment you must
                    connect to each machine and run MySQL Shell locally before
                    issuing <code class="literal">dba.configureLocalInstance()</code> on the
                    instance. This ensures that any configuration changes are
                    persisted into the option file on the instance. This also
                    requires that you have access to the server and the required
                    permissions to execute MySQL Shell.


                </p><p style="color:blue;">与沙盒部署（所有实例都在本地部署到一台计算机上）不同，对于生产部署，必须连接到每台计算机并在本地运行mysql shell，然后在实例上发出dba.configureLocalInstance（）命令。这可以确保将任何配置更改持久化到实例上的选项文件中。这还要求您具有对服务器的访问权限以及执行mysql shell所需的权限。</p>
            </div>
            <p>
                To pass a server's connection information to AdminAPI use
                URI type strings. See <a class="ulink" href="https://dev.mysql.com/doc/refman/8.0/en/connecting-using-uri-or-key-value-pairs.html#connecting-using-uri" target="_top">Connecting Using URI-Like Connection Strings</a> for
                more information.
            </p><p style="color:blue;">要将服务器的连接信息传递给adminapi，请使用uri类型字符串。有关详细信息，请参阅使用类似于uri的连接字符串进行连接。</p>
            <div class="simplesect">

                <div class="titlepage">
                    <div>

                        <div class="simple">
                            <h4 class="title"><a name="mysql-innodb-cluster-user-privileges"></a>User Privileges</h4>
                        </div>
                    </div>
                </div>
                <p>
                    The user account used to administer an instance does not have
                    to be the root account, however the user needs to be assigned
                    full read and write privileges on the InnoDB cluster
                    metadata tables in addition to full MySQL administrator
                    privileges (<code class="literal">SUPER</code>, <code class="literal">GRANT
                    OPTION</code>, <code class="literal">CREATE</code>,
                    <code class="literal">DROP</code> and so on). The preferred method to
                    create users to administer the cluster is using the
                    <code class="literal">clusterAdmin</code> option with the
                    <code class="literal">dba.configureInstance()</code>, and
                    <code class="literal">Cluster.addInstance()</code> operations. In this
                    procedure the user <code class="literal">ic</code> is shown in examples.
                </p><p style="color:blue;">用于管理实例的用户帐户不必是根帐户，但是除了完全的mysql管理员权限（super、grant option、create、drop等）外，还需要为用户分配innodb cluster元数据表的完全读写权限。创建用户以管理群集的首选方法是将clusterAdmin选项与dba.configureInstance（）和cluster.addinstance（）操作一起使用。在本程序中，用户ic如示例所示。</p><p>
                If only read operations are needed (such as for monitoring
                purposes), an account with more restricted privileges can be
                used. To give the user <em class="replaceable"><code>your_user</code></em>
                the privileges needed to monitor InnoDB cluster issue:
            </p><p style="color:blue;">如果只需要读取操作（例如用于监视目的），则可以使用具有更多受限权限的帐户。要授予用户监视InnoDB群集问题所需的权限，请执行以下操作：</p><pre data-lang="sql" class="programlisting">GRANT SELECT ON mysql_innodb_cluster_metadata.* TO <em class="replaceable"><code>your_user@'%'</code></em>;
GRANT SELECT ON performance_schema.global_status TO <em class="replaceable"><code>your_user@'%'</code></em>;
GRANT SELECT ON performance_schema.replication_applier_configuration TO <em class="replaceable"><code>your_user@'%'</code></em>;
GRANT SELECT ON performance_schema.replication_applier_status TO <em class="replaceable"><code>your_user@'%'</code></em>;
GRANT SELECT ON performance_schema.replication_applier_status_by_coordinator TO <em class="replaceable"><code>your_user@'%'</code></em>;
GRANT SELECT ON performance_schema.replication_applier_status_by_worker TO <em class="replaceable"><code>your_user@'%'</code></em>;
GRANT SELECT ON performance_schema.replication_connection_configuration TO <em class="replaceable"><code>your_user@'%'</code></em>;
GRANT SELECT ON performance_schema.replication_connection_status TO <em class="replaceable"><code>your_user@'%'</code></em>;
GRANT SELECT ON performance_schema.replication_group_member_stats TO <em class="replaceable"><code>your_user@'%'</code></em>;
GRANT SELECT ON performance_schema.replication_group_members TO <em class="replaceable"><code>your_user@'%'</code></em>;
GRANT SELECT ON performance_schema.threads TO <em class="replaceable"><code>your_user@'%'</code></em> WITH GRANT OPTION;
</pre><p>
                In this procedure the user <code class="literal">ic</code> is used in
                examples.
            </p><p style="color:blue;">在这个过程中，用户ic被用在例子中。</p>
            </div>
            <div class="simplesect">
                <div class="titlepage">
                    <div>
                        <div class="simple">
                            <h4 class="title"><a name="mysql-innodb-cluster-production-hostname"></a>Configuring Hostname</h4>

                        </div>

                    </div>

                </div>
                <p>
                    The production instances which make up a cluster run on
                    separate machines, therefore each machine must have a unique
                    host name and be able to resolve the host names of the other
                    machines which run server instances in the cluster. If this is
                    not the case, you can:
                </p><p style="color:blue;">组成群集的生产实例在不同的计算机上运行，因此每台计算机必须具有唯一的主机名，并且能够解析在群集中运行服务器实例的其他计算机的主机名。如果不是这样，您可以：</p>
                <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                        configure each machine to map the IP of each other machine
                        to a hostname. See your operating system documentation for
                        details. This is the recommended solution.
                    </p><p style="color:blue;">配置每台计算机以将彼此计算机的IP映射到主机名。有关详细信息，请参阅操作系统文档。这是推荐的解决方案。</p></li><li class="listitem"><p>
                        set up a DNS service
                    </p><p style="color:blue;">设置DNS服务</p></li><li class="listitem"><p>
                        configure the <a class="link" href="replication.html#sysvar_report_host"><code class="literal">report_host</code></a>
                        variable in the MySQL configuration of each instance to a
                        suitable externally reachable address
                    </p><p style="color:blue;">将每个实例的mysql配置中的report_host变量配置为适当的外部可访问地址</p></li></ul>
                </div>
                <p>
                    In this procedure the host name
                    <code class="literal">ic-<em class="replaceable"><code>number</code></em></code> is
                    used in examples.
                </p><p style="color:blue;">在此过程中，示例中使用主机名ic编号。</p><p>
                To verify whether the hostname of a MySQL server is correctly
                configured, execute the following query to see how the
                instance reports its own address to other servers and try to
                connect to that MySQL server from other hosts using the
                returned address:
            </p><p style="color:blue;">要验证MySQL服务器的主机名配置是否正确，请执行以下查询，以查看实例如何将自己的地址报告给其他服务器，并尝试使用返回的地址从其他主机连接到该MySQL服务器：</p><pre data-lang="sql" class="programlisting">SELECT coalesce(@@report_host, @@hostname);</pre>
            </div>
            <div class="simplesect">
                <div class="titlepage">
                    <div>
                        <div class="simple">
                            <h4 class="title"><a name="mysql-innodb-cluster-logging"></a>Verbose Logging</h4>

                        </div>

                    </div>

                </div>
                <p>
                    When working with a production deployment it can be useful to
                    configure verbose logging for MySQL Shell, the information
                    in the log can help you to find and resolve any issues that
                    might occur when you are preparing server instances to work as
                    part of InnoDB cluster. To start MySQL Shell with a
                    verbose logging level use the
                    <a class="ulink" href="https://dev.mysql.com/doc/mysql-shell/8.0/en/mysqlsh.html#option_mysqlsh_log-level" target="_top"><code class="option">--log-level</code></a> option:
                </p><p style="color:blue;">在处理生产部署时，为mysql shell配置详细日志可能会很有用，日志中的信息可以帮助您查找和解决在准备服务器实例作为innodb集群的一部分工作时可能出现的任何问题。要使用详细日志级别启动mysql shell，请使用--log level选项：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlsh --log-level=DEBUG3</code></strong>
</pre><p>
                The <code class="literal">DEBUG3</code> is recommended, see
                <a class="ulink" href="https://dev.mysql.com/doc/mysql-shell/8.0/en/mysqlsh.html#option_mysqlsh_log-level" target="_top"><code class="option">--log-level</code></a> for more
                information. When <code class="literal">DEBUG3</code> is set the
                MySQL Shell log file contains lines such as <code class="literal">Debug:
                execute_sql( ... )</code> which contain the SQL queries
                that are executed as part of each AdminAPI call. The log file
                generated by MySQL Shell is located in
                <code class="filename">~/.mysqlsh/mysqlsh.log</code> for Unix-based
                systems; on Microsoft Windows systems it is located in
                <code class="filename">%APPDATA%\MySQL\mysqlsh\mysqlsh.log</code>. See
                <a class="ulink" href="https://dev.mysql.com/doc/mysql-shell/8.0/en/mysql-shell-application-log.html" target="_top">MySQL Shell Logging and Debug</a> for more
                information.
            </p><p style="color:blue;">建议使用debug3，有关详细信息，请参阅--log level。设置debug3时，mysql shell日志文件包含debug:execute_sql（…）等行其中包含作为每个adminapi调用的一部分执行的sql查询。mysql shell生成的日志文件位于~/.mysqlsh/mysqlsh.log中（对于基于UNIX的系统）；在Microsoft Windows系统上，它位于%appdata%\mysql\mysqlsh\mysqlsh.log中。有关详细信息，请参阅mysql shell日志和调试。</p><p>
                In addition to enabling the MySQL Shell log level, you can
                configure the amount of output AdminAPI provides in
                MySQL Shell after each call to the API. To enable the amount
                of AdminAPI output, in MySQL Shell issue:
            </p><p style="color:blue;">除了启用mysql shell日志级别之外，还可以在每次调用api之后配置mysql shell中adminapi提供的输出量。要启用adminapi输出量，在mysql shell问题中：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; dba.verbose=2</pre><p>
                This enables the maximum output from AdminAPI calls. The
                available levels of output are:
            </p><p style="color:blue;">这允许从Admin API调用最大输出。可用的输出级别为：</p>
                <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                        0 or OFF is the default. This provides minimal output and
                        is the recommended level when not troubleshooting.
                    </p><p style="color:blue;">默认为0或关闭。这提供了最小的输出，并且是不进行故障排除时的建议级别。</p></li><li class="listitem"><p>
                        1 or ON adds verbose output from each call to the
                        AdminAPI.
                    </p><p style="color:blue;">1或on将每次调用的详细输出添加到adminapi。</p></li><li class="listitem"><p>
                        2 adds debug output to the verbose output providing full
                        information about what each call to AdminAPI executes.
                    </p><p style="color:blue;">2将调试输出添加到详细输出中，提供有关对adminapi执行的每个调用的完整信息。</p></li></ul>
                </div>

            </div>
            <div class="simplesect">
                <div class="titlepage">
                    <div>
                        <div class="simple">
                            <h4 class="title"><a name="check-instance-configuration"></a>Checking Instance Configuration</h4>

                        </div>

                    </div>

                </div>
                <p>
                    Before creating a production deployment from server instances
                    you need to check that MySQL on each instance is correctly
                    configured by using the
                    <code class="literal">dba.checkInstanceConfiguration()</code> function.
                    This ensures that the instance satisfies the
                    <a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-requirements" title="20.2.2&nbsp;InnoDB Cluster Requirements">Section&nbsp;20.2.2, “InnoDB Cluster Requirements”</a>. This does
                    not check any data that is on the instance, see
                    <a class="xref" href="mysql-innodb-cluster-userguide.html#check-instance-state" title="Checking Instance State">Checking Instance State</a> for more information.
                    The following demonstrates issuing this in a running
                    MySQL Shell:
                </p><p style="color:blue;">在从服务器实例创建生产部署之前，需要使用dba.checkInstanceconfiguration（）函数检查每个实例上的mysql是否正确配置。这确保实例满足20.2.2节“innodb集群需求”。这不会检查实例上的任何数据，有关详细信息，请参阅检查实例状态。下面演示如何在正在运行的mysql shell中发出此命令：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>dba.checkInstanceConfiguration('ic@ic-1:3306')</code></strong>

Please provide the password for 'ic@ic-1:3306':
Validating instance...

The instance 'ic-1:3306' is not valid for Cluster usage.

The following issues were encountered:

- Some configuration options need to be fixed.

+----------------------------------+---------------+----------------+--------------------------------------------------+
| Variable                         | Current Value | Required Value | Note                                             |
+----------------------------------+---------------+----------------+--------------------------------------------------+
| binlog_checksum                  | CRC32         | NONE           | Update the server variable or restart the server |
| enforce_gtid_consistency         | OFF           | ON             | Restart the server                               |
| gtid_mode                        | OFF           | ON             | Restart the server                               |
| log_bin                          | 0             | 1              | Restart the server                               |
| log_slave_updates                | 0             | ON             | Restart the server                               |
| master_info_repository           | FILE          | TABLE          | Restart the server                               |
| relay_log_info_repository        | FILE          | TABLE          | Restart the server                               |
| transaction_write_set_extraction | OFF           | XXHASH64       | Restart the server                               |
+----------------------------------+---------------+----------------+--------------------------------------------------+


Please fix these issues , restart the server and try again.

{
  "config_errors": [
    {
      "action": "server_update",
      "current": "CRC32",
      "option": "binlog_checksum",
      "required": "NONE"
    },
    {
      "action": "restart",
      "current": "OFF",
      "option": "enforce_gtid_consistency",
      "required": "ON"
    },
    {
      "action": "restart",
      "current": "OFF",
      "option": "gtid_mode",
      "required": "ON"
    },
    {
      "action": "restart",
      "current": "0",
      "option": "log_bin",
      "required": "1"
    },
    {
      "action": "restart",
      "current": "0",
      "option": "log_slave_updates",
      "required": "ON"
    },
    {
      "action": "restart",
      "current": "FILE",
      "option": "master_info_repository",
      "required": "TABLE"
    },
    {
      "action": "restart",
      "current": "FILE",
      "option": "relay_log_info_repository",
      "required": "TABLE"
    },
    {
      "action": "restart",
      "current": "OFF",
      "option": "transaction_write_set_extraction",
      "required": "XXHASH64"
    }
  ],
  "errors": [],
  "restart_required": true,
  "status": "error"
}
mysql-js&gt;
</pre><p>
                Repeat this process for each server instance that you plan to
                use as part of your cluster. The reports generated after
                running <code class="literal">dba.checkInstanceConfiguration()</code>
                provide information about any configuration changes required
                before you can proceed. The
                <code class="literal">restart_required</code> field in the final part of
                the report tells you whether MySQL on the instance requires a
                restart to detect any change made to the configuration file.
            </p><p style="color:blue;">对计划用作集群一部分的每个服务器实例重复此过程。运行dba.checkInstanceconfiguration（）后生成的报告提供了有关继续之前所需的任何配置更改的信息。报告最后一部分的restart_required字段告诉您实例上的mysql是否需要重新启动以检测对配置文件所做的任何更改。</p>
            </div>
            <div class="simplesect">
                <div class="titlepage">
                    <div>
                        <div class="simple">
                            <h4 class="title"><a name="configuring-the-instance-id"></a>Configuring the Instance</h4>

                        </div>

                    </div>

                </div>
                <p>
                    If configuration issues have been identified in the report
                    generated by running
                    <code class="literal">dba.checkInstanceConfiguration()</code> against
                    the instance, it does not satisfy the
                    <a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-requirements" title="20.2.2&nbsp;InnoDB Cluster Requirements">Section&nbsp;20.2.2, “InnoDB Cluster Requirements”</a>. Therefore
                    you need to connect to the machine and reconfigure the server
                    instance. AdminAPI provides the
                    <code class="literal">dba.configureLocalInstance()</code> function that
                    finds the MySQL server's option file and modifies it to ensure
                    that the instance is correctly configured for
                    InnoDB cluster. Alternatively make the changes to the
                    instance's option file manually based on the information
                    in the report. See <a class="xref" href="programs.html#option-files" title="4.2.2.2&nbsp;Using Option Files">Section&nbsp;4.2.2.2, “Using Option Files”</a> for more
                    information. Regardless of the way you make the configuration
                    changes, you might have to restart MySQL to ensure the
                    configuration changes are detected.


                </p><p style="color:blue;">如果在对实例运行dba.checkInstanceconfiguration（）生成的报告中发现了配置问题，则它不满足20.2.2节“InnoDB群集要求”。因此，您需要连接到计算机并重新配置服务器实例。adminapi提供dba.configureLocalInstance（）函数，用于查找MySQL服务器的选项文件并对其进行修改，以确保为InnoDB群集正确配置了实例。或者，根据报告中的信息手动更改实例的选项文件。有关详细信息，请参见第4.2.2.2节“使用选项文件”。无论您以何种方式进行配置更改，都可能必须重新启动mysql以确保检测到配置更改。</p><p>
                The recommended method is to log in to the remote machine, run
                MySQL Shell as the root user and then connect to the local
                MySQL server:
            </p><p style="color:blue;">建议的方法是登录到远程计算机，以根用户身份运行mysql shell，然后连接到本地mysql服务器：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>sudo -i mysqlsh --log-level=DEBUG3</code></strong>
</pre><p>
                The <code class="literal">dba.configureLocalInstance()</code> method
                verifies that a suitable user is available for cluster usage,
                which is used for connections between members of the cluster.



                The root user cannot do remote logins by default, therefore
                you have three options to continue with the configuration:
                enable remote connections for the root user



                , create a new user or neither of these two previous options.
                The following example demonstrates the second option, creating
                a new user for cluster usage.



                The format of the user names accepted follows the standard
                MySQL account name format, see
                <a class="xref" href="security.html#account-names" title="6.2.4&nbsp;Specifying Account Names">Section&nbsp;6.2.4, “Specifying Account Names”</a>.
            </p><p style="color:blue;">configureLocalInstance（）方法验证是否有合适的用户可用于群集，该用户用于群集成员之间的连接。默认情况下，根用户无法进行远程登录，因此有三个选项可继续配置：为根用户启用远程连接、创建新用户或前两个选项都不启用。下面的示例演示了第二个选项，即创建用于群集的新用户。接受的用户名格式遵循标准MySQL帐户名格式，请参阅第6.2.4节“指定帐户名”。</p><pre data-lang="mysqlsh" class="programlisting">
mysql-js&gt; <strong class="userinput"><code>dba.configureLocalInstance('root@localhost:3306')</code></strong>

Please provide the password for 'root@localhost:3306':

Please specify the path to the MySQL configuration file: /etc/mysql/mysql.conf.d/mysqld.cnf
Validating instance...

The configuration has been updated but it is required to restart the server.
{
  "config_errors": [
    {
      "action": "restart",
      "current": "OFF",
      "option": "enforce_gtid_consistency",
      "required": "ON"
    },
    {
      "action": "restart",
      "current": "OFF",
      "option": "gtid_mode",
      "required": "ON"
      },
    {
      "action": "restart",
      "current": "0",
      "option": "log_bin",
      "required": "1"
    },
    {
      "action": "restart",
      "current": "0",
      "option": "log_slave_updates",
      "required": "ON"
    },
    {
      "action": "restart",
      "current": "FILE",
      "option": "master_info_repository",
      "required": "TABLE"
    },
    {
      "action": "restart",
      "current": "FILE",
      "option": "relay_log_info_repository",
      "required": "TABLE"
    },
    {
      "action": "restart",
      "current": "OFF",
      "option": "transaction_write_set_extraction",
      "required": "XXHASH64"
    }
  ],
  "errors": [],
  "restart_required": true,
  "status": "error"
}
mysql-js&gt;
</pre>
                <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

                    <div class="admon-title">
                        Tip
                    </div>
                    <p>
                        If the instance has
                        <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a> then you
                        might need to confirm that AdminAPI can set
                        <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a>. See
                        <a class="xref" href="mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="Super Read-only and Instances">Super Read-only and Instances</a> for more
                        information.
                    </p><p style="color:blue;">如果实例的super_read_only=on，则可能需要确认adminapi可以设置super_read_only=off。有关详细信息，请参见超级只读和实例。</p>
                </div>
                <p>
                    As with <code class="literal">dba.checkInstanceConfiguration()</code>,
                    the configuration requirements are identified, but this time
                    the chosen configuration file is modified. For the
                    configuration changes to take effect you might need to restart
                    the MySQL Server.
                </p><p style="color:blue;">与dba.checkInstanceconfiguration（）一样，会标识配置需求，但这次会修改所选的配置文件。要使配置更改生效，可能需要重新启动mysql服务器。</p><p>
                The <code class="literal">dba.configureLocalInstance()</code> function
                also accepts the <code class="literal">clusterAdmin</code> and
                <code class="literal">clusterAdminPassword</code> options, which enable
                you to configure the cluster user and password when calling
                the function. <code class="literal">clusterAdmin</code> supports
                identifiers or strings for the user name and host name. By
                default if unquoted it assumes input is a string. For example:
            </p><p style="color:blue;">函数的作用还包括clusterAdmin和clusterAdminPassword选项，这些选项允许您在调用函数时配置集群用户和密码。clusteradmin支持用户名和主机名的标识符或字符串。默认情况下，如果未加引号，则假定输入为字符串。例如：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; dba.configureLocalInstance('ic@ic-1:3306', \
	      {clusterAdmin: 'icadmin@ic-1%',clusterAdminPassword: '<em class="replaceable"><code>password</code></em>'});</pre><p>
                This user is granted the privileges for an administrative user
                described at
                <a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-user-privileges" title="User Privileges">User Privileges</a>.
            </p><p style="color:blue;">此用户被授予用户权限中描述的管理用户的权限。</p>
            </div>
            <div class="simplesect">
                <div class="titlepage">
                    <div>
                        <div class="simple">
                            <h4 class="title"><a name="create-cluster"></a>Creating the Cluster</h4>

                        </div>

                    </div>

                </div>
                <p>
                    Once you have prepared your instances, use the
                    <code class="literal">dba.createCluster()</code> function to create the
                    cluster. The machine which you are running MySQL Shell on is
                    used as the seed instance for the cluster. The seed instance
                    is replicated to the other instances which you add to the
                    cluster, making them replicas of the seed instance.



                    Log in to the instance and run MySQL Shell locally.
                </p><p style="color:blue;">准备好实例后，使用dba.createCluster（）函数创建集群。运行mysql shell的机器用作集群的种子实例。seed实例被复制到您添加到集群的其他实例，使它们成为seed实例的副本。登录到实例并在本地运行mysql shell。</p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysqlsh --uri ic@ic-1:3306</code></strong>

Creating a Session to 'ic@ic-1:3306'
Enter password: *********
Classic Session successfully established. No default schema selected.
</pre><p>
                MySQL Shell must be connected to an instance before you can
                create a cluster because when you issue
                <code class="literal">dba.createCluster(<em class="replaceable"><code>name</code></em>)</code>
                MySQL Shell creates a MySQL protocol session to the server
                instance connected to the MySQL Shell's current global
                session. Use the
                <code class="literal">dba.createCluster(<em class="replaceable"><code>name</code></em>)</code>
                function to create the cluster and assign the returned cluster
                to a variable called <code class="literal">cluster</code>:
            </p><p style="color:blue;">在创建集群之前，mysql shell必须连接到实例，因为在发出dba.create cluster（name）命令时，mysql shell会创建到连接到mysql shell当前全局会话的服务器实例的mysql协议会话。使用dba.createCluster（name）函数创建集群并将返回的集群分配给名为cluster的变量：</p><pre data-lang="mysqlsh" class="programlisting">
mysql-js&gt; <strong class="userinput"><code>var cluster = dba.createCluster('prodCluster')</code></strong>

      A new InnoDB cluster will be created on instance 'ic@ic-1:3306'.

      Creating InnoDB cluster 'prodCluster' on 'ic@ic-1:3306'...
      Adding Seed Instance...

      Cluster successfully created. Use Cluster.addInstance() to add MySQL instances.
      At least 3 instances are needed for the cluster to be able to withstand up to
      one server failure.
</pre>
                <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

                    <div class="admon-title">
                        Tip
                    </div>
                    <p>
                        If the instance has
                        <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a> then you
                        might need to confirm that AdminAPI can set
                        <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a>. See
                        <a class="xref" href="mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="Super Read-only and Instances">Super Read-only and Instances</a> for more
                        information.
                    </p><p style="color:blue;">如果实例的super_read_only=on，则可能需要确认adminapi可以设置super_read_only=off。有关详细信息，请参见超级只读和实例。</p>
                </div>
                <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                    <div class="admon-title">
                        Note
                    </div>
                    <p>
                        If you encounter an error related to metadata being
                        inaccessible you might have the loopback network interface
                        configured. For correct InnoDB cluster usage disable the
                        loopback interface.
                    </p><p style="color:blue;">如果遇到与元数据不可访问相关的错误，则可能已配置环回网络接口。为了正确使用innodb集群，请禁用环回接口。</p>
                </div>
                <p>
                    To check the cluster has been created, use the cluster
                    instance's <code class="literal">status()</code> function. See
                    <a class="xref" href="mysql-innodb-cluster-userguide.html#check-innodb-cluster-status" title="Checking the InnoDB Cluster Status">Checking the InnoDB Cluster Status</a>.
                </p><p style="color:blue;">要检查群集是否已创建，请使用群集实例的status（）函数。请参阅检查innodb集群状态。</p>
                <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

                    <div class="admon-title">
                        Tip
                    </div>
                    <p>
                        Once server instances belong to a cluster it is important to
                        only administer them using MySQL Shell and AdminAPI.
                        Attempting to manually change the configuration of Group
                        Replication on an instance once it has been added to a
                        cluster is not supported. Similarly, modifying server
                        variables critical to InnoDB cluster, such as
                        <a class="link" href="replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a> after an
                        instance is configured using AdminAPI is not
                        supported.
                    </p><p style="color:blue;">一旦服务器实例属于一个集群，就必须使用mysql shell和adminapi来管理它们。不支持将实例添加到群集后尝试手动更改其上的组复制配置。类似地，不支持在使用adminapi配置实例之后修改对innodb cluster至关重要的服务器变量，例如server_uid。</p>
                </div>
                <p>
                    Use the
                    <code class="literal">cluster.addInstance(<em class="replaceable"><code>instance</code></em>)</code>
                    function to add more instances to the cluster, where
                    <em class="replaceable"><code>instance</code></em> is a URI type string to
                    connect to the local instance. The instances must have been
                    configured for cluster usage. You need a minimum of three
                    instances in the cluster to make it tolerant to the failure of
                    one instance. Adding further instances increases the tolerance
                    to failure of an instance. To add an instance to the cluster
                    issue:
                </p><p style="color:blue;">使用cluster.add instance（instance）函数向群集添加更多实例，其中instance是要连接到本地实例的uri类型字符串。必须为群集使用配置实例。集群中至少需要三个实例，以使其能够容忍一个实例的失败。添加更多实例会增加实例的失败容忍度。要将实例添加到群集问题，请执行以下操作：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>cluster.addInstance('ic@ic-2:3306');</code></strong>
</pre><p>
                To verify the instance has been added, use the cluster
                instance's <code class="literal">status()</code> function.


            </p><p style="color:blue;">要验证实例是否已添加，请使用群集实例的status（）函数。</p>
                <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

                    <div class="admon-title">
                        Important
                    </div>
                    <p>
                        At this stage, the server instances have been added to the
                        cluster but the changes to the InnoDB cluster metadata
                        have only been made on the instance which you are currently
                        connected to. To make the configuration changes persistent
                        for all instances in the cluster, you must connect to each
                        instance and issue
                        <code class="literal">dba.configureLocalInstance()</code> locally on
                        each instance you have added. This is essential to ensure
                        that instances rejoin the cluster in the event of leaving
                        the cluster.
                    </p><p style="color:blue;">在此阶段，服务器实例已经添加到集群中，但是对innodb集群元数据的更改只在您当前连接到的实例上进行。要使集群中所有实例的配置更改保持不变，必须连接到每个实例，并在添加的每个实例上本地发出dba.configureLocalInstance（）。这对于确保实例在离开集群时重新加入集群至关重要。</p>
                </div>
                <p>
                    To persist the InnoDB cluster metadata for all instances,
                    log in to each instance that you added to the cluster and run
                    MySQL Shell locally.
                </p><p style="color:blue;">要持久化所有实例的innodb集群元数据，请登录添加到集群中的每个实例，并在本地运行mysql shell。</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlsh</code></strong>
</pre><p>
                Use the <code class="literal">\connect</code> command to log in to MySQL
                server. Execute the
                <code class="literal">dba.configureLocalInstance('<em class="replaceable"><code>instance</code></em>')</code>
                function, where <em class="replaceable"><code>instance</code></em> is a URI
                type string to connect to the local instance. For example:
            </p><p style="color:blue;">使用\connect命令登录mysql服务器。执行dba.configureLocalInstance（'instance'）函数，其中instance是要连接到本地实例的uri类型字符串。例如：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; dba.configureLocalInstance('ic@ic-2:3306')
</pre>
                <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

                    <div class="admon-title">
                        Tip
                    </div>
                    <p>
                        If the instance has
                        <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a> then you
                        might need to confirm that AdminAPI can set
                        <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a>. See
                        <a class="xref" href="mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="Super Read-only and Instances">Super Read-only and Instances</a> for more
                        information.
                    </p><p style="color:blue;">如果实例的super_read_only=on，则可能需要确认adminapi可以设置super_read_only=off。有关详细信息，请参见超级只读和实例。</p>
                </div>
                <p>
                    Repeat this process for each server instance that you added to
                    the cluster. Similarly if you modify the cluster structure,
                    for example changing the number of instances, you need to
                    repeat this process for each server instance to update the
                    InnoDB cluster metadata accordingly for each instance in the
                    cluster.
                </p><p style="color:blue;">对添加到群集的每个服务器实例重复此过程。类似地，如果修改集群结构，例如更改实例数量，则需要对每个服务器实例重复此过程，以相应地更新集群中每个实例的innodb集群元数据。</p><p>
                Once you have your cluster deployed you can configure MySQL Router
                to provide high availability, see
                <a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-using-router" title="20.3&nbsp;Using MySQL Router with InnoDB Cluster">Section&nbsp;20.3, “Using MySQL Router with InnoDB Cluster”</a>.


            </p><p style="color:blue;">一旦部署了集群，就可以配置mysql路由器以提供高可用性，请参阅20.3节，“将mysql路由器与innodb集群一起使用”。</p>
            </div>

        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="mysql-innodb-cluster-from-group-replication"></a>20.2.6&nbsp;Adopting a Group Replication Deployment</h3>

                    </div>

                </div>

            </div>
            <p>
                If you have an existing deployment of Group Replication and you
                want to use it to create a cluster, pass the
                <code class="literal">adoptFromGR</code> option to the
                <code class="literal">dba.createCluster()</code> function. The created
                InnoDB cluster matches whether the replication group is
                running as single-primary or multi-primary.
            </p><p style="color:blue;">如果存在组复制的现有部署，并且希望使用它来创建群集，则将ApvtSufGr选项传递给DBA。CealCuxStruts（）函数。创建的innodb集群匹配复制组是作为单主还是多主运行。</p>
            <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Tip
                </div>
                <p>
                    Group Replication members might contain
                    <a class="link" href="storage-engines.html#myisam-storage-engine" title="15.2&nbsp;The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> tables. Convert all such
                    tables to <a class="link" href="innodb-storage-engine.html" title="Chapter&nbsp;14&nbsp;The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> before adopting
                    the group to an InnoDB cluster.


                </p><p style="color:blue;">组复制成员可能包含myisam表。在采用组到innodb集群之前，将所有这些表转换成innodb。</p>
            </div>
            <p>
                To adopt an existing Group Replication group, connect to a group
                member using MySQL Shell. In the following example a
                single-primary group is adopted. We connect to
                <code class="literal">gr-member-2</code>, a secondary instance, while
                <code class="literal">gr-member-1</code> is functioning as the group's
                primary. Create a cluster using
                <code class="literal">dba.createCluster()</code>, passing in the
                <code class="literal">adoptFromGR</code> option. For example:
            </p><p style="color:blue;">若要采用现有的组复制组，请使用MySQL shell连接到组成员。在下面的示例中，采用单个主组。我们连接到第二个实例gr-member-2，而gr-member-1充当组的主实例。使用dba.createCluster（）创建一个集群，传入adopteFromgr选项。例如：</p><pre data-lang="mysqlsh" class="programlisting">
mysql-js&gt; <strong class="userinput"><code>var cluster = dba.createCluster('prodCluster', {adoptFromGR: true});</code></strong>

A new InnoDB cluster will be created on instance 'root@gr-member-2:3306'.

Creating InnoDB cluster 'prodCluster' on 'root@gr-member-2:3306'...
Adding Seed Instance...

Cluster successfully created. Use cluster.addInstance() to add MySQL instances.
At least 3 instances are needed for the cluster to be able to withstand up to
one server failure.
</pre>
            <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Tip
                </div>
                <p>
                    If the instance has
                    <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a> then you
                    might need to confirm that AdminAPI can set
                    <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a>. See
                    <a class="xref" href="mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="Super Read-only and Instances">Super Read-only and Instances</a> for more
                    information.
                </p><p style="color:blue;">如果实例的super_read_only=on，则可能需要确认adminapi可以设置super_read_only=off。有关详细信息，请参见超级只读和实例。</p>
            </div>
            <p>
                The new cluster matches the mode of the group. If the adopted
                group was running in single-primary mode then a single-primary
                cluster is created. If the adopted group was running in
                multi-primary mode then a multi-primary cluster is created. For
                example:
            </p><p style="color:blue;">新群集与组的模式匹配。如果采用的组正在单主模式下运行，则会创建一个主集群。如果采用的组以多主模式运行，则会创建多主群集。例如：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>cluster.status();</code></strong>

{
    "clusterName": "prodCluster",
    "defaultReplicaSet": {
        "name": "default",
        "primary": "gr-member-1:3306",
        "ssl": "REQUIRED",
        "status": "OK",
        "statusText": "Cluster is ONLINE and can tolerate up to ONE failure.",
        "topology": {
            "gr-member-2:3306": {
                "address": "gr-member-2:3306",
                "mode": "R/O",
                "readReplicas": {},
                "role": "HA",
                "status": "ONLINE"
            },
            "gr-member-1:3306": {
                "address": "gr-member-1:3306",
                "mode": "R/W",
                "readReplicas": {},
                "role": "HA",
                "status": "ONLINE"
            },
            "gr-member-3:3306": {
                "address": "gr-member-3:3306",
                "mode": "R/O",
                "readReplicas": {},
                "role": "HA",
                "status": "ONLINE"
            }
        }
    }
}

	</pre><p>
            As seen above, the newly created cluster is single-primary and
            uses <code class="literal">gr-member-1</code> as the primary.
        </p><p style="color:blue;">如上所示，新创建的集群是单主集群，使用gr-member-1作为主集群。</p>
        </div>

    </div>
    <div class="section">
        <div class="titlepage">
            <div>
                <div>
                    <h2 class="title" style="clear: both"><a name="mysql-innodb-cluster-using-router"></a>20.3&nbsp;Using MySQL Router with InnoDB Cluster</h2>

                </div>

            </div>

        </div>
        <p>
            This section describes how to use MySQL Router with InnoDB cluster
            to achieve high availability. Regardless of whether you have
            deployed a sandbox or production cluster, MySQL Router can configure
            itself based on the InnoDB cluster's metadata using the
            <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysqlrouter.html#option_mysqlrouter_bootstrap" target="_top"><code class="option">--bootstrap</code></a> option. This
            configures MySQL Router automatically to route connections to the
            cluster's server instances. Client applications connect to
            the ports MySQL Router provides, without any need to be aware of the
            InnoDB cluster topology. In the event of a unexpected failure,
            the InnoDB cluster adjusts itself automatically and MySQL Router
            detects the change. This removes the need for your client
            application to handle failover. For more information, see
            <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysql-router-innodb-cluster.html" target="_top">Routing for MySQL InnoDB cluster</a>.
        </p><p style="color:blue;">本节介绍如何将mysql路由器与innodb集群结合使用，实现高可用性。不管您是部署了沙箱还是生产集群，mysql路由器都可以使用--bootstrap选项根据innodb集群的元数据进行自我配置。这将自动配置mysql路由器以将连接路由到集群的服务器实例。客户端应用程序连接到mysql路由器提供的端口，无需知道innodb集群拓扑。如果出现意外故障，innodb集群会自动调整自身，mysql路由器会检测到变化。这消除了客户端应用程序处理故障转移的需要。有关更多信息，请参见针对mysql innodb cluster的路由。</p>
        <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

            <div class="admon-title">
                Note
            </div>
            <p>
                Do not attempt to configure MySQL Router manually to redirect to the
                ports of an InnoDB cluster. Always use the
                <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysqlrouter.html#option_mysqlrouter_bootstrap" target="_top"><code class="option">--bootstrap</code></a> option as this
                ensures that MySQL Router takes its configuration from the
                InnoDB cluster's metadata. See
                <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysql-router-general-metadata.html" target="_top">Cluster Metadata and State</a>.
            </p><p style="color:blue;">不要试图手动配置mysql路由器以重定向到innodb集群的端口。始终使用--bootstrap选项，因为这样可以确保mysql路由器从innodb集群的元数据中获取其配置。请参见群集元数据和状态。</p>
        </div>
        <p>
            The recommended deployment of MySQL Router is on the same host as the
            application. When using a sandbox deployment, everything is
            running on a single host, therefore you deploy MySQL Router to the
            same host. When using a production deployment, we recommend
            deploying one MySQL Router instance to each machine used to host one
            of your client applications. It is also possible to deploy
            MySQL Router to a common machine through which your application
            instances connect. You need the MASTER key of the InnoDB cluster
            to auto-configure MySQL Router.


        </p><p style="color:blue;">建议将mysql路由器部署在与应用程序相同的主机上。当使用沙箱部署时，所有东西都在一个主机上运行，因此您将mysql路由器部署到同一个主机上。当使用生产部署时，我们建议将一个mysql路由器实例部署到用于承载一个客户端应用程序的每台计算机上。还可以将mysql路由器部署到应用程序实例连接的公共计算机上。您需要innodb集群的主密钥来自动配置mysql路由器。</p><p>
        Assuming MySQL Router is already installed (see
        <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysql-router-installation.html" target="_top">Installing MySQL Router</a>), use the
        <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysqlrouter.html#option_mysqlrouter_bootstrap" target="_top"><code class="option">--bootstrap</code></a> option to provide
        the location of a server instance that belongs to the
        InnoDB cluster. MySQL Router uses the included metadata cache



        plugin to retrieve the InnoDB cluster's metadata,
        consisting of a list of server instance addresses which make up
        the InnoDB cluster and their role in the cluster. You pass the
        URI type string of the server that MySQL Router should retrieve the
        InnoDB cluster metadata from. For example:
    </p><p style="color:blue;">假设已经安装了mysql router（请参阅安装mysql router），使用--bootstrap选项提供属于innodb集群的服务器实例的位置。mysql router使用包含的元数据缓存插件来检索innodb集群的元数据，由组成innodb集群的服务器实例地址列表及其在集群中的角色组成。传递mysql路由器应该从中检索innodb集群元数据的服务器的uri类型字符串。例如：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlrouter --bootstrap ic@ic-1:3306 --user=mysqlrouter </code></strong>
</pre><p>
        You are prompted for the instance password and encryption key for
        MySQL Router to use. This encryption key is used to encrypt the
        instance password used by MySQL Router to connect to the cluster. The
        ports you can use to connect to the InnoDB cluster are also
        displayed. The MySQL Router bootstrap process creates a
        <code class="filename">mysqlrouter.conf</code> file, with the settings
        based on the cluster metadata retrieved from the address passed to
        the <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysqlrouter.html#option_mysqlrouter_bootstrap" target="_top"><code class="option">--bootstrap</code></a> option, in the
        above example <code class="literal">ic@ic-1:3306</code>. Based on the
        InnoDB cluster metadata retrieved, MySQL Router automatically
        creates a configuration file, including a
        <code class="literal">metadata_cache</code> section with
        <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysql-router-conf-options.html#option_mysqlrouter_bootstrap_server_addresses" target="_top"><code class="option">bootstrap_server_addresses</code></a>
        containing the addresses for all server instances in the cluster.
        For example:
    </p><p style="color:blue;">系统会提示您输入mysql路由器要使用的实例密码和加密密钥。此加密密钥用于加密MySQL路由器用于连接到群集的实例密码。您可以用来连接到innodb集群的端口也会显示出来。mysql router bootstrap进程创建一个mysqlrouter.conf文件，其设置基于从传递给--bootstrap选项的地址中检索的集群元数据，在上面的示例ic@ic-1:3306中。根据检索到的innodb cluster元数据，mysql router会自动创建一个配置文件，包括一个metadata_cache部分，其中bootstrap_server_addresses包含集群中所有服务器实例的地址。例如：</p><pre data-lang="ini" class="programlisting">[metadata_cache:prodCluster]
router_id=1
bootstrap_server_addresses=mysql://ic@ic-1:3306,mysql://ic@ic-2:3306,mysql://ic@ic-3:3306
user=mysql_router1_jy95yozko3k2
metadata_cluster=prodCluster
ttl=300
</pre>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

            <div class="admon-title">
                Tip
            </div>
            <p>
                When you change the topology of a cluster by adding another
                server instance after you have bootstrapped MySQL Router, you need
                to update
                <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysql-router-conf-options.html#option_mysqlrouter_bootstrap_server_addresses" target="_top"><code class="option">bootstrap_server_addresses</code></a>
                based on the updated metadata. Either restart MySQL Router using the
                <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysqlrouter.html#option_mysqlrouter_bootstrap" target="_top"><code class="option">--bootstrap</code></a> option, or
                manually edit the
                <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysql-router-conf-options.html#option_mysqlrouter_bootstrap_server_addresses" target="_top"><code class="option">bootstrap_server_addresses</code></a>
                section of the <code class="filename">mysqlrouter.conf</code> file and
                restart MySQL Router.
            </p><p style="color:blue;">在启动mysql路由器之后，通过添加另一个服务器实例来更改集群的拓扑结构时，需要根据更新的元数据更新引导服务器地址。使用--bootstrap选项重新启动mysql路由器，或者手动编辑mysql router.conf文件的bootstrap_server_addresses部分，然后重新启动mysql路由器。</p>
        </div>
        <p>
            The generated MySQL Router configuration creates TCP ports which you
            use to connect to the cluster. Ports for communicating with the
            cluster using both Classic MySQL protocol and X Protocol are
            created. To use X Protocol the server instances must have
            X Plugin installed and configured. For a sandbox deployment,
            instances have X Plugin set up automatically. For a
            production deployment, if you want to use X Protocol you
            need to install and configure X Plugin on each instance, see
            <a class="xref" href="document-store.html#document-store-setting-up" title="19.3&nbsp;Setting Up MySQL as a Document Store">Section&nbsp;19.3, “Setting Up MySQL as a Document Store”</a>. The default available
            TCP ports are:
        </p><p style="color:blue;">生成的mysql路由器配置创建用于连接到集群的tcp端口。创建了使用经典mysql协议和x协议与集群通信的端口。要使用x协议，服务器实例必须安装并配置x插件。对于沙盒部署，实例会自动设置x插件。对于生产部署，如果要使用x协议，则需要在每个实例上安装和配置x插件，请参阅19.3节“将mysql设置为文档存储”。默认可用的TCP端口为：</p>
        <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">6446</code> - for Classic MySQL protocol
                read-write sessions, which MySQL Router redirects incoming
                connections to primary server instances.
            </p><p style="color:blue;">6446-对于经典的MySQL协议读写会话，MySQL路由器将传入连接重定向到主服务器实例。</p></li><li class="listitem"><p>
                <code class="literal">6447</code> - for Classic MySQL protocol read-only
                sessions, which MySQL Router redirects incoming connections to one
                of the secondary server instances.
            </p><p style="color:blue;">6447-对于经典的mysql协议只读会话，mysql路由器将传入的连接重定向到一个辅助服务器实例。</p></li><li class="listitem"><p>
                <code class="literal">64460</code> - for X Protocol read-write
                sessions, which MySQL Router redirects incoming connections to
                primary server instances.
            </p><p style="color:blue;">64460-对于X协议读写会话，MySQL路由器将传入连接重定向到主服务器实例。</p></li><li class="listitem"><p>
                <code class="literal">64470</code> - for X Protocol read-only
                sessions, which MySQL Router redirects incoming connections to one
                of the secondary server instances.
            </p><p style="color:blue;">64470-对于X协议只读会话，MySQL路由器将传入连接重定向到一个辅助服务器实例。</p></li></ul>
        </div>
        <p>
            Depending on your MySQL Router configuration the port numbers might be
            different to the above. For example if you use the
            <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysqlrouter.html#option_mysqlrouter_conf-base-port" target="_top"><code class="option">--conf-base-port</code></a> option, or
            the
            <a class="link" href="group-replication.html#sysvar_group_replication_single_primary_mode"><code class="literal">group_replication_single_primary_mode</code></a>
            variable. The exact ports are listed when you start MySQL Router.
        </p><p style="color:blue;">根据您的mysql路由器配置，端口号可能与上面的不同。例如，如果您使用--conf base port选项，或使用group_replication_single_primary_mode变量。启动mysql路由器时会列出确切的端口。</p><p>
        The way incoming connections are redirected depends on the type of
        cluster being used. When using a single-primary cluster,
        read-write sessions are redirected to the single primary, with a
        multi-primary cluster read-write sessions are redirected to one of
        the primary instances.



        For incoming read-only connections MySQL Router redirects connections
        to one of the secondary instances in a round-robin fashion.


    </p><p style="color:blue;">传入连接重定向的方式取决于使用的群集类型。当使用单个主集群时，读写会话将重定向到单个主集群，而多个主集群读写会话将重定向到其中一个主实例。对于传入的只读连接，mysql路由器以循环方式将连接重定向到一个辅助实例。</p><p>
        Once bootstrapped and configured, start MySQL Router:
    </p><p style="color:blue;">启动并配置后，启动mysql路由器：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlrouter &amp;</code></strong>
</pre><p>
        Alternatively set up a service to start MySQL Router automatically
        when the system boots, see
        <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysql-router-server-starting.html" target="_top">Starting MySQL Router</a>. You can now
        connect a MySQL client, such as MySQL Shell to one of the
        incoming MySQL Router ports as described above and see how the client
        gets transparently connected to one of the InnoDB cluster
        instances.
    </p><p style="color:blue;">或者，设置一个服务以在系统启动时自动启动mysql路由器，请参阅启动mysql路由器。现在可以将mysql客户机（如mysql shell）连接到上面描述的一个传入mysql路由器端口，并查看客户机如何透明地连接到一个innodb集群实例。</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlsh --uri root@localhost:6442</code></strong>
</pre><p>
        To verify which instance you are actually connected to, simply
        issue an SQL query against the
        <a class="link" href="server-administration.html#sysvar_port"><code class="literal">port</code></a> status variable.


    </p><p style="color:blue;">要验证实际连接到哪个实例，只需对port status变量发出一个sql查询。</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>\sql</code></strong>
Switching to SQL mode... Commands end with ;
mysql-sql&gt; <strong class="userinput"><code>select @@port;</code></strong>
+--------+
| @@port |
+--------+
|   3310 |
+--------+
</pre>
        <div class="simplesect">

            <div class="titlepage">
                <div>

                    <div class="simple">
                        <h3 class="title"><a name="test-failover"></a>Testing High Availability</h3>
                    </div>
                </div>
            </div>
            <p>
                To test if high availability works, simulate an unexpected halt
                by killing an instance. The cluster detects the fact that the
                instance left the cluster and reconfigures itself. Exactly how
                the cluster reconfigures itself depends on whether you are using
                a single-primary or multi-primary cluster, and the role the
                instance serves within the cluster.
            </p><p style="color:blue;">要测试高可用性是否有效，请通过终止实例来模拟意外停止。集群检测到实例离开集群并重新配置自身。确切地说，集群如何重新配置自身取决于您使用的是单个主集群还是多个主集群，以及实例在集群中所扮演的角色。</p><p>
            In single-primary mode:
        </p><p style="color:blue;">在单主模式下：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    If the current primary leaves the cluster, one of the
                    secondary instances is elected as the new primary, with
                    instances prioritized by the lowest
                    <a class="link" href="replication.html#sysvar_server_uuid"><code class="literal">server_uuid</code></a>. MySQL Router
                    redirects read-write connections to the newly elected
                    primary.
                </p><p style="color:blue;">如果当前主实例离开集群，则会选择其中一个辅助实例作为新主实例，实例的优先级由最低的服务器uuid决定。mysql路由器将读写连接重定向到新选择的主节点。</p></li><li class="listitem"><p>
                    If a current secondary leaves the cluster, MySQL Router stops
                    redirecting read-only connections to the instance.
                </p><p style="color:blue;">如果当前辅助服务器离开群集，mysql路由器将停止将只读连接重定向到实例。</p></li></ul>
            </div>
            <p>
                For more information see
                <a class="xref" href="group-replication.html#group-replication-single-primary-mode" title="17.4.1.1&nbsp;Single-Primary Mode">Section&nbsp;17.4.1.1, “Single-Primary Mode”</a>.
            </p><p style="color:blue;">有关更多信息，请参见第17.4.1.1节“单主模式”。</p><p>
            In multi-primary mode:
        </p><p style="color:blue;">在多主模式下：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    If a current "R/W" instance leaves the cluster, MySQL Router
                    redirects read-write connections to other primaries.


                </p><p style="color:blue;">如果当前的“r/w”实例离开集群，mysql路由器会将读写连接重定向到其他主节点。</p></li><li class="listitem"><p>
                    If a current "R/O" instance leaves the cluster,


                </p><p style="color:blue;">如果当前的“r/o”实例离开集群，</p></li></ul>
            </div>
            <p>
                For more information see
                <a class="xref" href="group-replication.html#group-replication-multi-primary-mode" title="17.4.1.2&nbsp;Multi-Primary Mode">Section&nbsp;17.4.1.2, “Multi-Primary Mode”</a>.
            </p><p style="color:blue;">有关更多信息，请参见第17.4.1.2节“多主模式”。</p><p>
            There are various ways to simulate an instance leaving a
            cluster, for example you can forcibly stop the MySQL server on
            an instance, or use the AdminAPI
            <code class="literal">dba.killSandboxInstance()</code> if testing a
            sandbox deployment. In this example assume there is a
            single-primary sandbox cluster deployment with three server
            instances and the instance listening at port 3310 is the current
            primary. Simulate the instance leaving the cluster unexpectedly:
        </p><p style="color:blue;">有多种方法可以模拟实例离开集群，例如，可以强制停止实例上的MySQL服务器，或者在测试沙盒部署时使用adminapi dba.killSandboxInstance（）。在本例中，假设有一个带有三个服务器实例的主沙盒集群部署，并且在端口3310侦听的实例是当前主沙盒集群。模拟意外离开群集的实例：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>dba.killSandboxInstance(3310)</code></strong>
</pre><p>
            Switch to SQL mode in MySQL Shell using the
            <code class="literal">\sql</code> command and verify the
            <a class="link" href="server-administration.html#sysvar_port"><code class="literal">port</code></a> variable to check which
            instance you are connected to.



            Notice that the first <a class="link" href="sql-syntax.html#select" title="13.2.9&nbsp;SELECT Syntax"><code class="literal">SELECT</code></a>
            statement fails as the connection to the original primary was
            lost. This means the current session has been closed,
            MySQL Shell automatically reconnects for you and when you
            issue the command again the new port is confirmed.
        </p><p style="color:blue;">使用\sql命令切换到mysql shell中的sql模式，并验证端口变量以检查连接到的实例。请注意，第一个select语句失败，因为与原始主语句的连接丢失。这意味着当前会话已关闭，mysql shell将自动为您重新连接，当您再次发出命令时，新端口将得到确认。</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>\sql</code></strong>
Switching to SQL mode... Commands end with ;
mysql-sql&gt; <strong class="userinput"><code>SELECT @@port;</code></strong>
ERROR: 2013 (HY000): Lost connection to MySQL server during query
The global session got disconnected.
Attempting to reconnect to 'root@localhost:6446'...
The global session was successfully reconnected.
mysql-sql&gt; <strong class="userinput"><code>SELECT @@port;</code></strong>
+--------+
| @@port |
+--------+
|   3330 |
+--------+
1 row in set (0.00 sec)
</pre><p>
            This shows that the InnoDB cluster provided us with automatic
            failover, that MySQL Router has automatically reconnected us to the
            new primary instance, and that we have high availability.
        </p><p style="color:blue;">这说明innodb集群为我们提供了自动故障转移，mysql路由器已经自动将我们重新连接到新的主实例，并且我们有很高的可用性。</p>
        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="router-and-metadata-servers"></a>MySQL Router and Metadata Servers</h3>

                    </div>

                </div>

            </div>
            <p>
                When MySQL Router is bootstrapped against a cluster, it records the
                server instance's addresses in its configuration file. If
                any additional instances are added to the cluster after
                bootstrapping the MySQL Router, they are not automatically detected
                and therefore are <span class="emphasis"><em>not</em></span> used for connection
                routing.
            </p><p style="color:blue;">当mysql路由器在集群上引导时，它会在其配置文件中记录服务器实例的地址。如果在引导mysql路由器之后向集群中添加了任何其他实例，则不会自动检测到它们，因此不会用于连接路由。</p><p>
            To ensure that newly added instances are routed to correctly you
            must bootstrap MySQL Router against the cluster to read the updated
            metadata. This means that you must restart MySQL Router and include
            the <a class="ulink" href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysqlrouter.html#option_mysqlrouter_bootstrap" target="_top"><code class="option">--bootstrap</code></a> option.
        </p><p style="color:blue;">为了确保新添加的实例被正确路由到，必须针对集群引导mysql路由器以读取更新的元数据。这意味着您必须重新启动mysql路由器并包含--bootstrap选项。</p>
        </div>

    </div>
    <div class="section">
        <div class="titlepage">
            <div>
                <div>
                    <h2 class="title" style="clear: both"><a name="mysql-innodb-cluster-working-with-cluster"></a>20.4&nbsp;Working with InnoDB Cluster</h2>

                </div>

            </div>

        </div>
        <p>
            This section explains how to work with InnoDB cluster, and how
            to handle common administration tasks.


        </p><p style="color:blue;">本节介绍如何使用innodb集群，以及如何处理常见的管理任务。</p>
        <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#retrieving-an-innodb-cluster" title="Retrieving an InnoDB cluster">Retrieving an InnoDB cluster</a></p><p style="color:blue;">检索innodb集群</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#check-innodb-cluster-status" title="Checking the InnoDB Cluster Status">Checking the InnoDB Cluster Status</a></p><p style="color:blue;">检查InnoDB集群状态</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#describe-structure-innodb-cluster" title="Describing the Structure of the InnoDB Cluster">Describing the Structure of the InnoDB Cluster</a></p><p style="color:blue;">描述InnoDB集群的结构</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="Super Read-only and Instances">Super Read-only and Instances</a></p><p style="color:blue;">超级只读和实例</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#manage-sandbox-instances" title="Managing Sandbox Instances">Managing Sandbox Instances</a></p><p style="color:blue;">管理沙盒实例</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#remove-instances-from-innodb-cluster" title="Removing Instances from the InnoDB Cluster">Removing Instances from the InnoDB Cluster</a></p><p style="color:blue;">从innodb集群中移除实例</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#customize-your-cluster" title="Customizing InnoDB clusters">Customizing InnoDB clusters</a></p><p style="color:blue;">定制innodb集群</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#rejoin-cluster" title="Rejoining a Cluster">Rejoining a Cluster</a></p><p style="color:blue;">重新加入群集</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#restore-cluster-from-quorum-loss" title="Restoring a Cluster from Quorum Loss">Restoring a Cluster from Quorum Loss</a></p><p style="color:blue;">从仲裁丢失恢复群集</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#reboot-outage" title="Rebooting a Cluster from a Major Outage">Rebooting a Cluster from a Major Outage</a></p><p style="color:blue;">从重大停机重新启动群集</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#rescan-cluster" title="Rescanning a Cluster">Rescanning a Cluster</a></p><p style="color:blue;">重新扫描群集</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#check-instance-state" title="Checking Instance State">Checking Instance State</a></p><p style="color:blue;">检查实例状态</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#dissolve-innodb-cluster" title="Dissolving an InnoDB Cluster">Dissolving an InnoDB Cluster</a></p><p style="color:blue;">解散InnoDB集群</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-securing" title="Securing your Cluster">Securing your Cluster</a></p><p style="color:blue;">保护群集</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#create-whitelist-servers" title="Creating a Whitelist of Servers">Creating a Whitelist of Servers</a></p><p style="color:blue;">创建服务器白名单</p></li><li class="listitem"><p><a class="xref" href="mysql-innodb-cluster-userguide.html#use-mysql-shell-execute-script" title="Using MySQL Shell to Execute a Script">Using MySQL Shell to Execute a Script</a></p><p style="color:blue;">使用mysql shell执行脚本</p></li></ul>
        </div>

        <div class="simplesect">

            <div class="titlepage">
                <div>

                    <div class="simple">
                        <h3 class="title"><a name="retrieving-an-innodb-cluster"></a>Retrieving an InnoDB cluster</h3>

                    </div>

                </div>

            </div>
            <p>
                When you create a cluster using
                <code class="literal">dba.createCluster()</code>, the operation returns a
                Cluster object which can be assigned to a variable. You use this
                object to work with the cluster, for example to add instances or
                check the cluster's status. If you want to retrieve a cluster
                again at a later date, for example after restarting
                MySQL Shell, use the
                <code class="literal">dba.getCluster(<em class="replaceable"><code>name</code></em>,
                    [<em class="replaceable"><code>options</code></em>])</code> function. For
                example:
            </p><p style="color:blue;">当使用dba.createCluster（）创建集群时，该操作返回一个可以分配给变量的集群对象。您可以使用此对象处理群集，例如添加实例或检查群集的状态。如果您想在以后再次检索集群，例如在重新启动mysql shell之后，请使用dba.getcluster（name，[options]）函数。例如：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>var cluster1 = dba.getCluster()</code></strong>
</pre><p>
            If you do not specify a cluster <em class="replaceable"><code>name</code></em>
            then the default cluster is returned. If there is more than one
            cluster stored in the InnoDB cluster metadata of the server
            instance which the MySQL Shell global session is currently
            connected to, specify the <em class="replaceable"><code>name</code></em> of the
            cluster you want to retrieve.
        </p><p style="color:blue;">如果未指定群集名称，则返回默认群集。如果mysql shell全局会话当前连接到的服务器实例的innodb cluster元数据中存储了多个集群，请指定要检索的集群的名称。</p>
        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="check-innodb-cluster-status"></a>Checking the InnoDB Cluster Status</h3>

                    </div>

                </div>

            </div>
            <p>
                Cluster objects provide the <code class="literal">status()</code> method
                that enables you to check how a cluster is running. Before you
                can check the status of the InnoDB cluster, you need to get a
                reference to the InnoDB cluster object by connecting to any of
                its instances. However, if you want to make changes to the
                configuration of the cluster, you must connect to a "R/W"
                instance. Issuing <code class="literal">status()</code> retrieves the
                status of the cluster based on the view of the cluster which the
                server instance you are connected to is aware of and outputs a
                status report.
            </p><p style="color:blue;">cluster对象提供status（）方法，使您能够检查集群的运行方式。在检查innodb集群的状态之前，需要通过连接到innodb集群对象的任何实例来获取对该对象的引用。但是，如果要更改群集的配置，则必须连接到“r/w”实例。Issuing Status（）根据连接到的服务器实例知道的群集视图检索群集的状态，并输出状态报告。</p>
            <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Important
                </div>
                <p>
                    The instance's state in the cluster directly influences the
                    information provided in the status report. An instance which
                    has left the cluster provides a different view of the cluster
                    compared to a instance which belongs to the cluster. Therefore
                    ensure the instance you are connected to has a status of
                    <code class="literal">ONLINE</code>.


                </p><p style="color:blue;">集群中实例的状态直接影响状态报告中提供的信息。离开集群的实例提供了与属于集群的实例不同的集群视图。因此，请确保连接到的实例的状态为“联机”。</p>
            </div>
            <p>
                For information about how the InnoDB cluster is running, use
                the cluster's <code class="literal">status()</code> method:
            </p><p style="color:blue;">有关InnoDB集群如何运行的信息，请使用集群的status（）方法：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>var cluster = dba.getCluster()</code></strong>
mysql-js&gt; <strong class="userinput"><code>cluster.status()</code></strong>
{
    "clusterName": "testCluster",
    "defaultReplicaSet": {
        "name": "default",
        "primary": "localhost:3320",
	"ssl": "REQUIRED",
        "status": "OK",
        "statusText": "Cluster is ONLINE and can tolerate up to ONE failure.",
        "topology": {
            "localhost:3310": {
                "address": "localhost:3310",
                "mode": "R/O",
                "readReplicas": {},
                "role": "HA",
                "status": "ONLINE"
            },
            "localhost:3320": {
                "address": "localhost:3320",
                "mode": "R/W",
                "readReplicas": {},
                "role": "HA",
                "status": "ONLINE"
            },
            "localhost:3330": {
                "address": "localhost:3330",
                "mode": "R/O",
                "readReplicas": {},
                "role": "HA",
                "status": "ONLINE"
            }
        }
    }
}
</pre><p>
            The information output by <code class="literal">cluster.status()</code>
            provides the following information:
        </p><p style="color:blue;">cluster.status（）输出的信息提供以下信息：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    clusterName: name assigned to this cluster during
                    <code class="literal">dba.createCluster()</code>.
                </p><p style="color:blue;">clusterName：在dba.createCluster（）期间分配给此群集的名称。</p></li><li class="listitem"><p>
                    defaultReplicaSet: the server instances which belong to an
                    InnoDB cluster and contain the data set.
                </p><p style="color:blue;">defaultreplicaset：属于innodb集群并包含数据集的服务器实例。</p></li><li class="listitem"><p>
                    primary: displayed when the cluster is operating in
                    single-primary mode only. Shows the address of the current
                    primary instance. If this field is not displayed, the
                    cluster is operating in multi-primary mode.
                </p><p style="color:blue;">主模式：仅当群集在单主模式下运行时显示。显示当前主实例的地址。如果未显示此字段，则群集以多主模式运行。</p></li><li class="listitem"><p>
                    ssl: whether secure connections are used by the cluster or
                    not. Shows values of <code class="literal">REQUIRED</code> or
                    <code class="literal">DISABLED</code>, depending on how the
                    <code class="literal">memberSslMode</code> option was configured
                    during either <code class="literal">createCluster()</code> or
                    <code class="literal">addInstance()</code>. The value returned by this
                    parameter corresponds to the value of the
                    <a class="link" href="group-replication.html#sysvar_group_replication_ssl_mode"><code class="literal">group_replication_ssl_mode</code></a>
                    server variable on the instance. See
                    <a class="xref" href="mysql-innodb-cluster-userguide.html#mysql-innodb-cluster-securing" title="Securing your Cluster">Securing your Cluster</a>.
                </p><p style="color:blue;">ssl：集群是否使用安全连接。显示Required或Disabled的值，具体取决于在createCluster（）或addInstance（）期间如何配置membersSlMode选项。此参数返回的值与实例上的group_replication_ssl_mode server变量的值相对应。请参见保护群集。</p></li><li class="listitem"><p>
                    status: The status of this element of the cluster. For the
                    overall cluster this describes the high availability
                    provided by this cluster. The status is one of the
                    following:
                </p><p style="color:blue;">status：集群中此元素的状态。对于整个集群，这描述了这个集群提供的高可用性。状态如下：</p>
                    <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                            <code class="literal">ONLINE</code>: The instance is online and
                            participating in the cluster.
                        </p><p style="color:blue;">联机：实例联机并参与群集。</p></li><li class="listitem"><p>
                            <code class="literal">OFFLINE</code>: The instance has lost
                            connection to the other instances.
                        </p><p style="color:blue;">脱机：实例已失去与其他实例的连接。</p></li><li class="listitem"><p>
                            <code class="literal">RECOVERING</code>: The instance is
                            attempting to synchronize with the cluster by retrieving
                            transactions it needs before it can become an
                            <code class="literal">ONLINE</code> member.
                        </p><p style="color:blue;">恢复：实例正在尝试通过检索其成为联机成员之前所需的事务来与群集同步。</p></li><li class="listitem"><p>
                            <code class="literal">UNREACHABLE</code>: The instance has lost
                            communication with the cluster.
                        </p><p style="color:blue;">无法访问：实例已与群集失去通信。</p></li><li class="listitem"><p>
                            <code class="literal">ERROR</code>: The instance has encountered
                            an error during the recovery phase or while applying a
                            transaction.
                        </p><p style="color:blue;">错误：实例在恢复阶段或应用事务时遇到错误。</p>
                            <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

                                <div class="admon-title">
                                    Important
                                </div>
                                <p>
                                    Once an instance enters <code class="literal">ERROR</code>
                                    state, the
                                    <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only</code></a>
                                    option is set to <code class="literal">ON</code>. To leave the
                                    <code class="literal">ERROR</code> state you must manually
                                    configure the instance with
                                    <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a>.
                                </p><p style="color:blue;">一旦实例进入错误状态，super_read_only选项将设置为on。要离开错误状态，必须手动将实例配置为super_read_only=off。</p>
                            </div>
                        </li><li class="listitem"><p>
                            <code class="literal">(MISSING)</code>: The state of an instance
                            which is part of the configured cluster, but is
                            currently unavailable.
                        </p><p style="color:blue;">（缺少）：实例的状态，该实例是已配置群集的一部分，但当前不可用。</p>
                            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

                                <div class="admon-title">
                                    Note
                                </div>
                                <p>
                                    The <code class="literal">MISSING</code> state is specific to
                                    InnoDB cluster, it is not a state generated by Group
                                    Replication. MySQL Shell uses this state to indicate
                                    instances that are registered in the metadata, but
                                    cannot be found in the live cluster view.
                                </p><p style="color:blue;">丢失的状态特定于innodb cluster，它不是由组复制生成的状态。mysql shell使用此状态指示在元数据中注册但在live cluster视图中找不到的实例。</p>
                            </div>
                        </li></ul>
                    </div>
                </li><li class="listitem"><p>
                    topology: The instances which have been added to the
                    cluster.
                </p><p style="color:blue;">拓扑：已添加到群集的实例。</p></li><li class="listitem"><p>
                    Host name of instance: The host name of an instance, for
                    example localhost:3310.
                </p><p style="color:blue;">实例的主机名：实例的主机名，例如localhost:3310。</p></li><li class="listitem"><p>
                    role: what function this instance provides in the cluster.
                    Currently only HA, for high availability.
                </p><p style="color:blue;">角色：这个实例在集群中提供什么功能。目前只有ha，用于高可用性。</p></li><li class="listitem"><p>
                    mode: whether the server is read-write ("R/W") or read-only
                    ("R/O"). The mode indicates either <code class="literal">R/W</code>
                    (read and writable) or <code class="literal">R/O</code> (read only).
                    In single-primary mode, only the one instance marked "R/W"
                    can execute transactions that update the database, so it is
                    the primary. If that instance becomes unreachable for any
                    reason (like an unexpected halt), one of the remaining "R/O"
                    instances automatically takes over its place and becomes the
                    new "R/W" primary. In multi-primary mode, all instances are
                    marked as "R/W" and there is no single elected primary.
                </p><p style="color:blue;">模式：服务器是读写（“r/w”）还是只读（“r/o”）。模式指示R/W（读写）或R/O（只读）。在单主模式下，只有一个标记为“r/w”的实例可以执行更新数据库的事务，因此它是主实例。如果由于任何原因无法访问该实例（如意外停止），则剩余的一个“r/o”实例将自动取代它，成为新的“r/w”主实例。在多主模式下，所有实例都标记为“R/W”，并且没有单个选定的主实例。</p></li></ul>
            </div>

        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="describe-structure-innodb-cluster"></a>Describing the Structure of the InnoDB Cluster</h3>

                    </div>

                </div>

            </div>
            <p>
                To get information about the structure of the InnoDB cluster
                itself, use the <code class="literal">cluster.describe()</code> function:
            </p><p style="color:blue;">要获取InnoDB集群本身的结构信息，请使用cluster.descripe（）函数：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>cluster.describe();</code></strong>
{
    "clusterName": "test",
    "adminType": "local",
    "defaultReplicaSet": {
        "name": "default",
        "instances": [
            {
                "name": "localhost:3310",
                "host": "localhost:3310",
                "role": "HA"
            },
            {
                "name": "localhost:3320",
                "host": "localhost:3320",
                "role": "HA"
            },
            {
                "name": "localhost:3330",
                "host": "localhost:3330",
                "role": "HA"
            }
        ]
    }
}
</pre><p>
            The output from this function shows the structure of the
            InnoDB cluster including all of its configuration information,
            and so on.


        </p><p style="color:blue;">这个函数的输出显示了innodb集群的结构，包括它的所有配置信息，等等。</p>
        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="super-read-only-on-instance"></a>Super Read-only and Instances</h3>

                    </div>

                </div>

            </div>
            <p>
                Whenever Group Replication stops, the
                <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only</code></a> variable is set
                to <code class="literal">ON</code> to ensure no writes are made to the
                instance. When you try to use such an instance with the
                following AdminAPI commands you are given the choice to set
                <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a> on the
                instance:
            </p><p style="color:blue;">每当组复制停止时，super_read_only变量设置为on，以确保不对实例进行任何写入。当您尝试将此类实例与以下adminapi命令一起使用时，您可以选择在实例上设置super_read_only=off：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    <code class="literal">dba.configureLocalInstance()</code>
                </p><p style="color:blue;">dba.configureLocalInstance（）</p></li><li class="listitem"><p>
                    <code class="literal">dba.createCluster()</code>
                </p><p style="color:blue;">dba.createCluster（）</p></li><li class="listitem"><p>
                    <code class="literal">dba.rebootClusterFromCompleteOutage()</code>
                </p><p style="color:blue;">dba.rebootclusterfromcompleteoutup（）</p></li><li class="listitem"><p>
                    <code class="literal">dba.dropMetadataSchema()</code>
                </p><p style="color:blue;">dba.dropMetadataSchema（）</p></li></ul>
            </div>
            <p>
                When AdminAPI encounters an instance which has
                <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a>, in
                interactive mode you are given the choice to set
                <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a>. For
                example:
            </p><p style="color:blue;">当adminapi遇到super_read_only=on的实例时，在交互模式下，您可以选择设置super_read_only=off。例如：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; var myCluster = dba.createCluster('testCluster')
A new InnoDB cluster will be created on instance 'ic@ic-1:3306'.

The MySQL instance at 'ic@ic-1:3306' currently has the super_read_only
system variable set to protect it from inadvertent updates from applications.
You must first unset it to be able to perform any changes to this instance.
For more information see: https://dev.mysql.com/doc/refman/en/server-system-variables.html#sysvar_super_read_only.

Note: there are open sessions to 'ic@ic-1:3306'.
You may want to kill these sessions to prevent them from performing unexpected updates:

1 open session(s) of 'ic@ic-1:3306'.


Do you want to disable super_read_only and continue? [y|N]:
	</pre><p>
            The number of current active sessions to the instance is shown.
            You must ensure that no applications might write to the instance
            inadvertently. By answering <code class="literal">y</code> you confirm
            that AdminAPI can write to the instance. If there is more than
            one open session to the instance listed, exercise caution before
            permitting AdminAPI to set
            <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a>.
        </p><p style="color:blue;">将显示实例的当前活动会话数。必须确保没有应用程序可能会无意中写入实例。通过回答y，可以确认adminapi可以写入实例。如果列出的实例有多个打开的会话，请在允许adminapi将super_read_only设置为off之前小心操作。</p><p>
            To force the function to set
            <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a> in a
            script, pass the <code class="literal">clearReadOnly</code> option set to
            <code class="literal">true</code>. For example
            <code class="literal">dba.configureInstance(<em class="replaceable"><code>instance</code></em>,
                {clearReadOnly: true}).</code>
        </p><p style="color:blue;">要强制函数在脚本中设置super_read_only=off，请将clearReadOnly选项设置为true。例如dba.configureInstance（实例，{clearReadOnly:true}）。</p>
        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="manage-sandbox-instances"></a>Managing Sandbox Instances</h3>

                    </div>

                </div>

            </div>
            <p>
                Once a sandbox instance is running, it is possible to change its
                status at any time using the following:
            </p><p style="color:blue;">沙盒实例运行后，可以随时使用以下命令更改其状态：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    To stop a sandbox instance use
                    <code class="literal">dba.stopSandboxInstance(<em class="replaceable"><code>instance</code></em>)</code>.
                    This stops the instance gracefully, unlike
                    <code class="literal">dba.killSandboxInstance(<em class="replaceable"><code>instance</code></em>)</code>.
                </p><p style="color:blue;">要停止沙盒实例，请使用dba.StopSandboxInstance（实例）。与dba.killSandboxInstance（instance）不同，这会优雅地停止实例。</p></li><li class="listitem"><p>
                    To start a sandbox instance use
                    <code class="literal">dba.startSandboxInstance(<em class="replaceable"><code>instance</code></em>)</code>.
                </p><p style="color:blue;">要启动沙盒实例，请使用dba.startsandboxInstance（实例）。</p></li><li class="listitem"><p>
                    To kill a sandbox instance use
                    <code class="literal">dba.killSandboxInstance(<em class="replaceable"><code>instance</code></em>)</code>.
                    This stops the instance without gracefully stopping it and
                    is useful in simulating unexpected halts.
                </p><p style="color:blue;">要杀死沙盒实例，请使用dba.killSandboxInstance（实例）。这将停止实例而不优雅地停止它，并且在模拟意外停止时非常有用。</p></li><li class="listitem"><p>
                    To delete a sandbox instance use
                    <code class="literal">dba.deleteSandboxInstance(<em class="replaceable"><code>instance</code></em>)</code>.
                    This completely removes the sandbox instance from your file
                    system.
                </p><p style="color:blue;">要删除沙盒实例，请使用dba.deleteSandboxInstance（实例）。这将从文件系统中完全删除沙盒实例。</p></li></ul>
            </div>

        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="remove-instances-from-innodb-cluster"></a>Removing Instances from the InnoDB Cluster</h3>

                    </div>

                </div>

            </div>
            <p>
                You can remove an instance from a cluster at any time should you
                wish to do so. This can be done with the
                <code class="literal">removeInstance()</code> method, as in the following
                example:
            </p><p style="color:blue;">如果希望，可以随时从集群中删除实例。这可以通过removeInstance（）方法完成，如下例所示：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>cluster.removeInstance('root@localhost:3310')</code></strong>
</pre>
        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="customize-your-cluster"></a>Customizing InnoDB clusters</h3>

                    </div>

                </div>

            </div>
            <p>
                When you create a cluster and add instances to it, values such
                as the group name, the local address, and the seed instances are
                configured automatically by AdminAPI. These default
                values are recommended for most deployments, but advanced users
                can override these defaults by passing the following options to
                the <code class="literal">dba.createCluster()</code> and
                <code class="literal">cluster.addInstance()</code>.
            </p><p style="color:blue;">创建集群并向其添加实例时，adminapi会自动配置组名、本地地址和种子实例等值。对于大多数部署，建议使用这些默认值，但是高级用户可以通过将以下选项传递给dba.createCluster（）和cluster.addInstance（）来覆盖这些默认值。</p><p>
            To customize the name of the replication group created by
            InnoDB cluster, pass the <code class="literal">groupName</code> option
            to the <code class="literal">dba.createCluster()</code> command. This sets
            the
            <a class="link" href="group-replication.html#sysvar_group_replication_group_name"><code class="literal">group_replication_group_name</code></a>
            system variable. The name must be a valid UUID.
        </p><p style="color:blue;">要自定义由innodb cluster创建的复制组的名称，请将group name选项传递给dba.createcluster（）命令。这将设置GROUP U REPLICATION U GROUP U NAME系统变量。名称必须是有效的uuid。</p><p>
            To customize the address which an instance provides for
            connections from other instances, pass the
            <code class="literal">localAddress</code> option to the
            <code class="literal">dba.createCluster()</code> and
            <code class="literal">cluster.addInstance()</code> commands. Specify the
            address in the format
            <code class="literal"><em class="replaceable"><code>host</code></em>:<em class="replaceable"><code>port</code></em></code>.
            This sets the
            <a class="link" href="group-replication.html#sysvar_group_replication_local_address"><code class="literal">group_replication_local_address</code></a>
            system variable on the instance. The address must be accessible
            to all instances in the cluster, and must be reserved for
            internal cluster communication only. In other words do not use
            this address for communication with the instance.
        </p><p style="color:blue;">要自定义实例为来自其他实例的连接提供的地址，请将localaddress选项传递给dba.createcluster（）和cluster.addinstance（）命令。以主机：端口的格式指定地址。这将设置实例上的组复制本地地址系统变量。该地址必须可供群集中的所有实例访问，并且必须仅为内部群集通信保留。换句话说，不要使用此地址与实例通信。</p><p>
            To customize the instances used as seeds when an instance joins
            the cluster, pass the <code class="literal">groupSeeds</code> option to
            the <code class="literal">dba.createCluster()</code> and
            <code class="literal">cluster.addInstance()</code> commands. Seed
            instances are contacted when a new instance joins a cluster and
            used to provide data to the new instance. The addresses are
            specified as a comma separated list such as
            <code class="literal">host1:port1</code>,<code class="literal">host2:port2</code>.
            This configures the
            <a class="link" href="group-replication.html#sysvar_group_replication_group_seeds"><code class="literal">group_replication_group_seeds</code></a>
            system variable.
        </p><p style="color:blue;">要自定义实例加入群集时用作种子的实例，请将groupseeds选项传递给dba.createcluster（）和cluster.addinstance（）命令。当新实例加入集群并用于向新实例提供数据时，将联系种子实例。这些地址被指定为逗号分隔的列表，如host1:port1、host2:port2。这将配置GROUP U REPLICATION U GROUP U SEEDS系统变量。</p><p>
            For more information see the documentation of the system
            variables configured by these AdminAPI options.
        </p><p style="color:blue;">有关更多信息，请参阅由这些adminapi选项配置的系统变量的文档。</p>
        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="rejoin-cluster"></a>Rejoining a Cluster</h3>

                    </div>

                </div>

            </div>
            <p>
                If an instance leaves the cluster, for example because it lost
                connection and did not or could not automatically rejoin the
                cluster, it might be necessary to rejoin it to the cluster at a
                later stage. To rejoin an instance to a cluster issue
                <code class="literal">cluster.rejoinInstance()</code>.
            </p><p style="color:blue;">如果一个实例离开集群，例如因为它失去了连接，并且没有或不能自动重新加入集群，那么可能需要在稍后阶段将其重新加入集群。将实例重新加入到群集问题cluster.rejoinInstance（）。</p><p>
            In the case where an instance has not had it's
            configuration persisted, for example when you have not issued
            <code class="literal">dba.configureLocalInstance()</code>
            <span class="emphasis"><em>locally</em></span> on the instance but it has been
            added to a cluster, upon restart the instance does not rejoin
            the cluster automatically. The solution is to issue
            <code class="literal">cluster.rejoinInstance()</code> so that the instance
            is added to the cluster again. Then connect to the instance, run
            MySQL Shell locally and issue
            <code class="literal">dba.configureLocalInstance()</code>. This ensures
            the InnoDB cluster configuration is persisted to the
            instance's option file to enable it to rejoin the cluster
            automatically.
        </p><p style="color:blue;">如果一个实例的配置没有持久化，例如，当您没有在实例上本地发出dba.configureLocalInstance（）但它已添加到群集时，在重新启动时，该实例不会自动重新加入群集。解决方案是发出cluster.rejoinInstance（），以便再次将实例添加到集群中。然后连接到实例，在本地运行mysql shell并发出dba.configureLocalInstance（）。这确保了innodb集群配置被持久化到实例的选项文件中，使其能够自动重新加入集群。</p>
            <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Tip
                </div>
                <p>
                    If the instance has
                    <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a> then you
                    might need to confirm that AdminAPI can set
                    <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a>. See
                    <a class="xref" href="mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="Super Read-only and Instances">Super Read-only and Instances</a> for more
                    information.
                </p><p style="color:blue;">如果实例的super_read_only=on，则可能需要确认adminapi可以设置super_read_only=off。有关详细信息，请参见超级只读和实例。</p>
            </div>

        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="restore-cluster-from-quorum-loss"></a>Restoring a Cluster from Quorum Loss</h3>

                    </div>

                </div>

            </div>
            <p>
                If a instance (or instances) fail, then a cluster can lose its
                quorum, which is the ability to vote in a new primary. In this
                case you can re-establish quorum using the method
                <code class="literal">cluster.forceQuorumUsingPartitionOf()</code>, as
                shown in the following MySQL Shell example:
            </p><p style="color:blue;">如果一个实例（或多个实例）失败，则群集可能会失去其仲裁（即在新主节点中投票的能力）。在这种情况下，可以使用cluster.forcequorumusingpartitionof（）方法重新建立仲裁，如下mysql shell示例所示：</p><pre data-lang="mysqlsh" class="programlisting">  // open session to a cluster

mysql-js&gt; <strong class="userinput"><code>cluster = dba.getCluster("prodCluster")</code></strong>

  // The cluster lost its quorum and its status shows
  // "status": "NO_QUORUM"

mysql-js&gt; <strong class="userinput"><code>cluster.forceQuorumUsingPartitionOf("localhost:3310")</code></strong>

  Restoring replicaset 'default' from loss of quorum, by using the partition composed of [localhost:3310]

  Please provide the password for 'root@localhost:3310': ******
  Restoring the InnoDB cluster ...

  The InnoDB cluster was successfully restored using the partition from the instance 'root@localhost:3310'.

  WARNING: To avoid a split-brain scenario, ensure that all other members of the replicaset
  are removed or joined back to the group that was restored.
</pre>
        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="reboot-outage"></a>Rebooting a Cluster from a Major Outage</h3>

                    </div>

                </div>

            </div>
            <p>


                If your cluster suffers from a complete outage, you can ensure
                it is reconfigured correctly using
                <code class="literal">dba.rebootClusterFromCompleteOutage()</code>. In the
                event that a cluster has completely stopped, the instances must
                be started and only then can the cluster be started. For example
                if the machine a sandbox cluster was running on has been
                restarted, and the instances were at ports 3310, 3320 and 3330,
                issue:
            </p><p style="color:blue;">如果集群遭受完全中断，可以使用dba.rebootclusterfromcompleteoutup（）确保正确重新配置它。如果集群已完全停止，则必须启动实例，然后才能启动集群。例如，如果运行沙盒群集的计算机已重新启动，并且实例位于端口3310、3320和3330，则问题：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; dba.startSandboxInstance(3310)
mysql-js&gt; dba.startSandboxInstance(3320)
mysql-js&gt; dba.startSandboxInstance(3330)
    </pre><p>
            This ensures the sandbox instances are running. In the case of a
            production deployment you would have to start the instances
            outside of MySQL Shell. Once the instances have started,
            connect to an instance and run MySQL Shell. Then restart the
            cluster by issuing:
        </p><p style="color:blue;">这将确保沙盒实例正在运行。在生产部署的情况下，必须在mysql shell之外启动实例。实例启动后，连接到实例并运行mysql shell。然后通过发出以下命令重新启动群集：</p><pre data-lang="mysqlsh" class="programlisting"><strong class="userinput"><code>
mysql-js&gt; <strong class="userinput"><code>shell.connect('root@localhost:3310');</code></strong>
mysql-js&gt; <strong class="userinput"><code>var cluster = dba.rebootClusterFromCompleteOutage();</code></strong>
</code></strong>
</pre>
            <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Tip
                </div>
                <p>
                    If the instance has
                    <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=ON</code></a> then you
                    might need to confirm that AdminAPI can set
                    <a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only=OFF</code></a>. See
                    <a class="xref" href="mysql-innodb-cluster-userguide.html#super-read-only-on-instance" title="Super Read-only and Instances">Super Read-only and Instances</a> for more
                    information.
                </p><p style="color:blue;">如果实例的super_read_only=on，则可能需要确认adminapi可以设置super_read_only=off。有关详细信息，请参见超级只读和实例。</p>
            </div>
            <p>
                This ensures the cluster is correctly reconfigured after a
                complete outage. It uses the instance that MySQL Shell is
                connected to as the new seed instance and recovers the cluster
                based on the existing metadata of that instance.
            </p><p style="color:blue;">这可以确保在完全中断后正确地重新配置集群。它使用MySQL shell连接的实例作为新的种子实例，并根据该实例的现有元数据恢复群集。</p><p>
            If this process fails, and the cluster metadata has become badly
            corrupted, you might need to drop the metadata and create the
            cluster again from scratch. You can drop the cluster metadata
            using <code class="literal">dba.dropMetadataSchema()</code>.
        </p><p style="color:blue;">如果此过程失败，并且群集元数据已严重损坏，则可能需要删除元数据并重新从头开始创建群集。可以使用dba.dropMetadataSchema（）删除集群元数据。</p>
            <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Warning
                </div>
                <p>
                    The <code class="literal">dba.dropMetadataSchema()</code> method should
                    only be used as a last resort, when it is not possible to
                    restore the cluster. It cannot be undone.
                </p><p style="color:blue;">dropMetadataSchema（）方法只能在无法还原群集时作为最后手段使用。无法撤消。</p>
            </div>

        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="rescan-cluster"></a>Rescanning a Cluster</h3>

                    </div>

                </div>

            </div>
            <p>
                If changes to an instance's configuration are made without
                using AdminAPI, you need to rescan the cluster to update the
                InnoDB cluster metadata. For example, if you manually add a
                new instance to the Group Replication group, the
                InnoDB cluster metadata is not modified based on this change
                to the cluster because MySQL Shell was not used. In such a
                scenario it is necessary to rescan the cluster with
                <code class="literal">cluster.rescan()</code> to update the
                InnoDB cluster metadata.
            </p><p style="color:blue;">如果在不使用adminapi的情况下对实例的配置进行了更改，则需要重新扫描集群以更新innodb集群元数据。例如，如果手动将新实例添加到组复制组，则不会基于对集群的此更改修改innodb集群元数据，因为未使用mysql shell。在这种情况下，需要使用cluster.rescan（）重新扫描集群，以更新innodb集群元数据。</p><p>
            After the command <code class="literal">cluster.rescan()</code> has been
            run, instances are identified that are newly discovered
            instances. You are prompted to add each of these newly
            discovered instances into your cluster as required, or you can
            choose to ignore them.
        </p><p style="color:blue;">运行命令cluster.rescan（）后，将标识新发现的实例。系统会提示您根据需要将每个新发现的实例添加到集群中，或者您可以选择忽略它们。</p><p>
            Instances that no longer belong to the cluster or which are
            unavailable are also reported. In this case you are prompted to
            remove the instance, or you can later attempt to add it back
            into the cluster using a command such as
            <code class="literal">cluster.rejoin('ic@ic-4:3306')</code>.
        </p><p style="color:blue;">也会报告不再属于群集或不可用的实例。在这种情况下，系统会提示您删除该实例，或者您可以稍后尝试使用cluster.rejoin（'ic@ic-4:3306'）等命令将其添加回集群。</p>
        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="check-instance-state"></a>Checking Instance State</h3>

                    </div>

                </div>

            </div>
            <p>
                The <code class="literal">cluster.checkInstanceState()</code> function can
                be used to verify the existing data on an instance does not
                prevent it from joining a cluster. This process works by
                validating the instance's global transaction identifier (GTID)
                state compared to the GTIDs already processed by the cluster.
                For more information on GTIDs see
                <a class="xref" href="replication.html#replication-gtids-concepts" title="16.1.3.1&nbsp;GTID Format and Storage">Section&nbsp;16.1.3.1, “GTID Format and Storage”</a>. This check enables
                you to determine if an instance which has processed transactions
                can be added to the cluster.
            </p><p style="color:blue;">Cuth.CytKistS祖先（）函数可以用来验证实例上的现有数据不会阻止它加入群集。此过程通过验证实例的全局事务标识符（gtid）状态（与集群已处理的gtid相比）来工作。有关gtid的更多信息，请参见第16.1.3.1节“gtid格式和存储”。此检查使您能够确定是否可以将已处理事务的实例添加到群集。</p><p>
            The following demonstrates issuing this in a running
            MySQL Shell:
        </p><p style="color:blue;">下面演示如何在正在运行的mysql shell中发出此命令：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>cluster.checkInstanceState('ic@ic-4:3306')</code></strong>
</pre><p>


            The output of this function can be one of the following:
        </p><p style="color:blue;">此函数的输出可以是以下之一：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    OK new: the instance has not executed any GTID transactions,
                    therefore it cannot conflict with the GTIDs executed by the
                    cluster
                </p><p style="color:blue;">ok new：实例没有执行任何gtid事务，因此它不能与集群执行的gtid冲突</p></li><li class="listitem"><p>
                    OK recoverable: the instance has executed GTIDs which do not
                    conflict with the executed GTIDs of the cluster seed
                    instances
                </p><p style="color:blue;">ok recoverable：实例执行的gtid与集群种子实例执行的gtid不冲突</p></li><li class="listitem"><p>
                    ERROR diverged: the instance has executed GTIDs which
                    diverge with the executed GTIDs of the cluster seed
                    instances
                </p><p style="color:blue;">发散错误：实例已执行gtid，该gtid与集群种子实例的已执行gtid发散</p></li><li class="listitem"><p>
                    ERROR lost_transactions: the instance has more executed
                    GTIDs than the executed GTIDs of the cluster seed instances
                </p><p style="color:blue;">error lost_事务：实例的已执行gtid比集群种子实例的已执行gtid多</p></li></ul>
            </div>
            <p>
                Instances with an OK status can be added to the cluster because
                any data on the instance is consistent with the cluster. In
                other words the instance being checked has not executed any
                transactions which conflict with the GTIDs executed by the
                cluster, and can be recovered to the same state as the rest of
                the cluster instances.
            </p><p style="color:blue;">可以将状态为“确定”的实例添加到群集，因为实例上的任何数据都与群集一致。换句话说，被检查的实例没有执行任何与集群执行的gtid冲突的事务，并且可以恢复到与其他集群实例相同的状态。</p>
        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="dissolve-innodb-cluster"></a>Dissolving an InnoDB Cluster</h3>

                    </div>

                </div>

            </div>
            <p>
                To dissolve an InnoDB cluster you connect to a read-write
                instance, for example the primary in a single-primary cluster,
                and use the <code class="literal">Cluster.dissolve()</code> command. This
                removes all metadata and configuration associated with the
                cluster, and disables Group Replication on the instances. Any
                data that was replicated between the instances is not removed.
                There is no way to undo the dissolving of a cluster, therefore
                you must pass <code class="literal">force: true</code> to confirm you want
                to dissolve the cluster. For example: to create it again use
                <code class="literal">dba.createCluster()</code>.
            </p><p style="color:blue;">要解散innodb集群，可以连接到读写实例，例如单个主集群中的主实例，然后使用cluster.dissole（）命令。这将删除与群集关联的所有元数据和配置，并在实例上禁用组复制。不会删除在实例之间复制的任何数据。无法撤消群集的解除，因此必须传递force:true以确认要解除群集。例如：要再次创建它，请使用dba.createCluster（）。</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt; <strong class="userinput"><code>session</code></strong>
&lt;ClassicSession:root@localhost:3310&gt;
mysql-js&gt; <strong class="userinput"><code>cluster.dissolve({force:true})</code></strong>
The cluster was successfully dissolved.
Replication was disabled but user data was left intact.
</pre>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Note
                </div>
                <p>
                    After issuing <code class="literal">cluster.dissolve()</code>, any
                    variable assigned to the <code class="literal">Cluster</code> object is
                    no longer valid.
                </p><p style="color:blue;">发出cluster.dissole（）后，分配给群集对象的任何变量都不再有效。</p>
            </div>

        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="mysql-innodb-cluster-securing"></a>Securing your Cluster</h3>

                    </div>

                </div>

            </div>
            <p>
                Server instances can be configured to use secure connections.
                For general information on using SSL with MySQL see
                <a class="xref" href="security.html#encrypted-connections" title="6.3&nbsp;Using Encrypted Connections">Section&nbsp;6.3, “Using Encrypted Connections”</a>. This section explains
                how to configure a cluster to use SSL. An additional security
                possibility is to configure which servers can access the
                cluster, see <a class="xref" href="mysql-innodb-cluster-userguide.html#create-whitelist-servers" title="Creating a Whitelist of Servers">Creating a Whitelist of Servers</a>.
            </p><p style="color:blue;">服务器实例可以配置为使用安全连接。有关在mysql中使用ssl的一般信息，请参见第6.3节“使用加密连接”。本节说明如何配置群集以使用ssl。另一种安全可能性是配置哪些服务器可以访问集群，请参阅创建服务器白名单。</p>
            <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Important
                </div>
                <p>
                    Once you have configured a cluster to use SSL you must add the
                    servers to the <code class="literal">ipWhitelist</code>.
                </p><p style="color:blue;">将集群配置为使用ssl后，必须将服务器添加到ipwhitelist。</p>
            </div>
            <p>
                When using <code class="literal">dba.createCluster()</code> to set up a
                cluster, if the server instance provides SSL encryption then it
                is automatically enabled on the seed instance. Pass the
                <code class="literal">memberSslMode</code> option to the
                <code class="literal">dba.createCluster()</code> method to specify a
                different SSL mode. The SSL mode of a cluster can only be set at
                the time of creation. The <code class="literal">memberSslMode</code>
                option is a string that configures the SSL mode to be used, it
                defaults to <code class="literal">AUTO</code>. The permitted values are
                <code class="literal">DISABLED</code>, <code class="literal">REQUIRED</code>, and
                <code class="literal">AUTO</code>. These modes are defined as:
            </p><p style="color:blue;">使用dba.createCluster（）设置群集时，如果服务器实例提供SSL加密，则会在种子实例上自动启用它。将membersSlMode选项传递给dba.createCluster（）方法以指定不同的SSL模式。群集的ssl模式只能在创建时设置。membersslmode选项是一个字符串，用于配置要使用的ssl模式，默认为auto。允许的值包括禁用、必需和自动。这些模式定义为：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    Setting
                    <code class="literal">createCluster({memberSslMode:'DISABLED'})</code>
                    ensures SSL encryption is disabled for the seed instance in
                    the cluster.
                </p><p style="color:blue;">设置createcluster（{membersslmode:'disabled'}）可确保对群集中的种子实例禁用ssl加密。</p></li><li class="listitem"><p>
                    Setting
                    <code class="literal">createCluster({memberSslMode:'REQUIRED'})</code>
                    then SSL encryption is enabled for the seed instance in the
                    cluster. If it cannot be enabled an error is raised.
                </p><p style="color:blue;">设置createcluster（{membersslmode:'required'}），然后为集群中的种子实例启用ssl加密。如果无法启用，则会引发错误。</p></li><li class="listitem"><p>
                    Setting
                    <code class="literal">createCluster({memberSslMode:'AUTO'})</code>
                    (the default) then SSL encryption is automatically enabled
                    if the server instance supports it, or disabled if the
                    server does not support it.
                </p><p style="color:blue;">设置createcluster（{membersslmode:'auto'}）（默认值），如果服务器实例支持ssl加密，则会自动启用；如果服务器不支持ssl加密，则会禁用ssl加密。</p></li></ul>
            </div>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                <div class="admon-title">
                    Note
                </div>
                <p>
                    When using the commercial version of MySQL, SSL is enabled by
                    default and you might need to configure the whitelist for all
                    instances. See <a class="xref" href="mysql-innodb-cluster-userguide.html#create-whitelist-servers" title="Creating a Whitelist of Servers">Creating a Whitelist of Servers</a>.
                </p><p style="color:blue;">在使用mysql的商业版本时，默认情况下会启用ssl，您可能需要为所有实例配置白名单。请参阅创建服务器白名单。</p>
            </div>
            <p>
                When you issue the <code class="literal">cluster.addInstance()</code> and
                <code class="literal">cluster.rejoinInstance()</code> commands, SSL
                encryption on the instance is enabled or disabled based on the
                setting found for the seed instance. For more control, the
                <code class="literal">cluster.addInstance()</code>, and
                <code class="literal">cluster.rejoinInstance()</code> commands accept the
                <code class="literal">memberSslMode</code> option. This can be used to
                test the SSL settings of the cluster when instances join. The
                behavior of the commands in this case is:
            </p><p style="color:blue;">当发出cluster.addinstance（）和cluster.rejoinInstance（）命令时，将根据为种子实例找到的设置启用或禁用实例上的SSL加密。为了获得更多控制，cluster.addinstance（）和cluster.rejoinInstance（）命令接受membersSlMode选项。这可用于在实例加入时测试集群的ssl设置。在这种情况下，命令的行为是：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    Setting <code class="literal">memberSslMode:'DISABLED'</code> ensures
                    SSL encryption is disabled for the instance in the cluster.
                </p><p style="color:blue;">设置membersslmode:“disabled”可确保对群集中的实例禁用ssl加密。</p></li><li class="listitem"><p>
                    Setting <code class="literal">memberSslMode:'REQUIRED'</code> forces
                    SSL encryption to be enabled for the instance in the
                    cluster.


                </p><p style="color:blue;">设置membersslmode:“必需”将强制为群集中的实例启用ssl加密。</p></li><li class="listitem"><p>
                    Setting <code class="literal">memberSslMode:'AUTO'</code> (the
                    default) then SSL encryption is automatically enabled or
                    disabled based on the setting used by the seed instance
                    (other members of the cluster) and the available SSL support
                    provided by the instance itself.
                </p><p style="color:blue;">设置membersslmode:“auto”（默认值），然后根据种子实例（群集的其他成员）使用的设置和实例本身提供的可用ssl支持自动启用或禁用ssl加密。</p></li></ul>
            </div>
            <p>
                When using <code class="literal">createCluster()</code> with the
                <code class="literal">adoptFromGR</code> option to adopt an existing Group
                Replication group, no SSL settings are changed on the adopted
                cluster:
            </p><p style="color:blue;">当使用CeaCeCuStUTE（）使用ApvtSufGr选项来使用现有的组复制组时，在所采用的群集上没有更改SSL设置：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    <code class="literal">memberSslMode</code> cannot be used with
                    <code class="literal">adoptFromGR</code>.
                </p><p style="color:blue;">membersslmode不能与adoptefromgr一起使用。</p></li><li class="listitem"><p>
                    If the SSL settings of the adopted cluster are different
                    from the ones supported by the MySQL Shell, in other words
                    SSL for Group Replication recovery and Group Communication,
                    both settings are not modified. This means you are not be
                    able to add new instances to the cluster, unless you change
                    the settings manually for the adopted cluster.
                </p><p style="color:blue;">如果采用的集群的ssl设置与mysql shell支持的不同，即用于组复制恢复和组通信的ssl，则不会修改这两个设置。这意味着您无法向集群添加新实例，除非您手动更改所采用集群的设置。</p></li></ul>
            </div>
            <p>
                MySQL Shell always enables or disables SSL for the cluster for
                both Group Replication recovery and Group Communication, see
                <a class="xref" href="group-replication.html#group-replication-secure-socket-layer-support-ssl" title="17.5.2&nbsp;Group Replication Secure Socket Layer (SSL) Support">Section&nbsp;17.5.2, “Group Replication Secure Socket Layer (SSL) Support”</a>.
                A verification is performed and an error issued in case those
                settings are different for the seed instance (for example as the
                result of a <code class="literal">dba.createCluster()</code> using
                <code class="literal">adoptFromGR</code>) when adding a new instance to
                the cluster. SSL encryption must be enabled or disabled for all
                instances in the cluster. Verifications are performed to ensure
                that this invariant holds when adding a new instance to the
                cluster.


            </p><p style="color:blue;">mysql shell始终为集群启用或禁用ssl，以实现组复制恢复和组通信，请参阅17.5.2节“组复制安全套接字层（ssl）支持”。将新实例添加到群集时，如果种子实例的这些设置不同（例如，使用adoptFromgr的dba.createCluster（）的结果），将执行验证并发出错误。必须为群集中的所有实例启用或禁用SSL加密。执行验证以确保在将新实例添加到集群时此不变量保持不变。</p><p>
            The <code class="literal">deploySandboxInstance()</code> command attempts
            to deploy sandbox instances with SSL encryption support by
            default. If it is not possible, the server instance is deployed
            without SSL support. Use the <code class="literal">ignoreSslError</code>
            option set to false to ensure that sandbox instances are
            deployed with SSL support, issuing an error if SSL support
            cannot be provided. When <code class="literal">ignoreSslError</code> is
            true, which is the default, no error is issued during the
            operation if the SSL support cannot be provided and the server
            instance is deployed without SSL support.
        </p><p style="color:blue;">默认情况下，deploySandboxInstance（）命令尝试部署具有SSL加密支持的沙盒实例。如果不可能，服务器实例将在没有ssl支持的情况下部署。使用设置为false的ignoresslerror选项确保沙盒实例部署时具有ssl支持，如果无法提供ssl支持，则发出错误消息。当ignoresslerror为true（这是默认值）时，如果无法提供ssl支持并且服务器实例部署时没有ssl支持，则在操作期间不会发出错误。</p>
        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="create-whitelist-servers"></a>Creating a Whitelist of Servers</h3>

                    </div>

                </div>

            </div>
            <p>


                When using a cluster's <code class="literal">createCluster()</code>,
                <code class="literal">addInstance()</code>, and
                <code class="literal">rejoinInstance()</code> methods you can optionally
                specify a list of approved servers that belong to the cluster,
                referred to as a whitelist. By specifying the whitelist
                explicitly in this way you can increase the security of your
                cluster because only servers in the whitelist can connect to the
                cluster.



                By default, if not specified explicitly, the whitelist is
                automatically set to the private network addresses that the
                server has network interfaces on. To configure the whitelist,
                specify the servers to add with the
                <code class="literal">ipWhitelist</code> option when using the method.
                Pass the servers as a comma separated list, surrounded by
                quotes. Using the <code class="literal">ipWhitelist</code> option
                configures the
                <a class="link" href="group-replication.html#sysvar_group_replication_ip_whitelist"><code class="literal">group_replication_ip_whitelist</code></a>
                system variable on the instance. For example:
            </p><p style="color:blue;">使用群集的createCluster（）、addInstance（）和rejoinInstance（）方法时，可以选择指定属于群集的已批准服务器的列表，称为白名单。通过以这种方式显式地指定白名单，您可以提高集群的安全性，因为只有白名单中的服务器才能连接到集群。默认情况下，如果未显式指定，则白名单将自动设置为服务器具有网络接口的专用网络地址。要配置白名单，请在使用该方法时使用ipwhitelist选项指定要添加的服务器。将服务器作为逗号分隔的列表传递，并用引号括起来。使用ip whitelist选项配置实例上的group_replication_ip_whitelist系统变量。例如：</p><pre data-lang="mysqlsh" class="programlisting">mysql-js&gt;<strong class="userinput"><code> cluster.addInstance("ic@ic-3:3306", {ipWhitelist: "203.0.113.0/24, 198.51.100.110"})</code></strong>
</pre><p>
            This configures the instance to only accept connections from
            servers at addresses <code class="literal">203.0.113.0/24</code> and
            <code class="literal">198.51.100.110</code>. From MySQL 5.7.21, the
            whitelist can also include host names, which are resolved only
            when a connection request is made by another server.
        </p><p style="color:blue;">这将实例配置为只接受来自地址203.0.113.0/24和198.51.100.110处服务器的连接。在mysql 5.7.21中，白名单还可以包含主机名，只有在另一台服务器发出连接请求时才能解析主机名。</p>
            <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Warning
                </div>
                <p>
                    Host names are inherently less secure than IP addresses in a
                    whitelist. MySQL carries out FCrDNS verification, which
                    provides a good level of protection, but can be compromised by
                    certain types of attack. Specify host names in your whitelist
                    only when strictly necessary, and ensure that all components
                    used for name resolution, such as DNS servers, are maintained
                    under your control. You can also implement name resolution
                    locally using the hosts file, to avoid the use of external
                    components.
                </p><p style="color:blue;">主机名本质上不如白名单中的IP地址安全。mysql执行fcrdns验证，这提供了很好的保护级别，但可能受到某些类型的攻击。仅在严格必要时在白名单中指定主机名，并确保用于名称解析的所有组件（如DNS服务器）都在您的控制下维护。还可以使用hosts文件在本地实现名称解析，以避免使用外部组件。</p>
            </div>

        </div>
        <div class="simplesect">
            <div class="titlepage">
                <div>
                    <div class="simple">
                        <h3 class="title"><a name="use-mysql-shell-execute-script"></a>Using MySQL Shell to Execute a Script</h3>

                    </div>

                </div>

            </div>
            <p>
                You can automate cluster configuration with scripts. For
                example:
            </p><p style="color:blue;">您可以使用脚本自动配置集群。例如：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlsh -f <em class="replaceable"><code>setup-innodb-cluster.js</code></em></code></strong>
</pre>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Note
                </div>
                <p>
                    Any command line options specified after the script file name
                    are passed to the script and <span class="emphasis"><em>not</em></span> to
                    MySQL Shell. You can access those options using the
                    <code class="literal">os.argv</code> array in JavaScript, or the
                    <code class="literal">sys.argv</code> array in Python. In both cases,
                    the first option picked up in the array is the script name.
                </p><p style="color:blue;">在脚本文件名之后指定的任何命令行选项都将传递给脚本，而不是mysql shell。可以使用javascript中的os.argv数组或python中的sys.argv数组访问这些选项。在这两种情况下，数组中选择的第一个选项是脚本名。</p>
            </div>
            <p>
                The contents of an example script file is shown here:
            </p><p style="color:blue;">示例脚本文件的内容如下所示：</p><pre data-lang="js" class="programlisting">  print('MySQL InnoDB cluster sandbox set up\n');
  print('==================================\n');
  print('Setting up a MySQL InnoDB cluster with 3 MySQL Server sandbox instances.\n');
  print('The instances will be installed in ~/mysql-sandboxes.\n');
  print('They will run on ports 3310, 3320 and 3330.\n\n');

  var dbPass = shell.prompt('Please enter a password for the MySQL root account: ', {type:"password"});

  try {
     print('\nDeploying the sandbox instances.');
     dba.deploySandboxInstance(3310, {password: dbPass});
     print('.');
     dba.deploySandboxInstance(3320, {password: dbPass});
     print('.');
     dba.deploySandboxInstance(3330, {password: dbPass});
     print('.\nSandbox instances deployed successfully.\n\n');

     print('Setting up InnoDB cluster...\n');
     shell.connect('root@localhost:3310', dbPass);

     var cluster = dba.createCluster("prodCluster");

     print('Adding instances to the cluster.');
     cluster.addInstance({user: "root", host: "localhost", port: 3320, password: dbPass});
     print('.');
     cluster.addInstance({user: "root", host: "localhost", port: 3330, password: dbPass});
     print('.\nInstances successfully added to the cluster.');

     print('\nInnoDB cluster deployed successfully.\n');
  } catch(e) {
     print('\nThe InnoDB cluster could not be created.\n\nError: ' +
     + e.message + '\n');
}</pre>
        </div>

    </div>
    <div class="section">
        <div class="titlepage">
            <div>
                <div>
                    <h2 class="title" style="clear: both"><a name="mysql-innodb-cluster-limitations"></a>20.5&nbsp;Known Limitations</h2>

                </div>

            </div>

        </div>
        <p>
            This section describes the known limitations of InnoDB cluster.
            As InnoDB cluster uses Group Replication, you should also be
            aware of its limitations, see
            <a class="xref" href="group-replication.html#group-replication-limitations" title="17.7.2&nbsp;Group Replication Limitations">Section&nbsp;17.7.2, “Group Replication Limitations”</a>.
        </p><p style="color:blue;">本节描述innodb集群的已知限制。由于innodb cluster使用组复制，您还应该了解它的局限性，请参见17.7.2节“组复制局限性”。</p>
        <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>






                The formatting of results which contain multi-byte characters
                sometimes do not have correctly aligned columns. Similarly,
                non-standard character sets are being corrupted in results.
            </p><p style="color:blue;">包含多字节字符的结果的格式有时没有正确对齐的列。类似地，非标准字符集在结果中也被破坏。</p></li><li class="listitem"><p>


                AdminAPI does not support Unix socket connections.
                MySQL Shell currently does not prevent you from attempting
                to use socket connections to a cluster, and attempting to use
                a socket connection to a cluster can cause unexpected results.
            </p><p style="color:blue;">adminapi不支持unix套接字连接。mysql shell目前并不阻止您尝试使用到集群的套接字连接，并且尝试使用到集群的套接字连接可能会导致意外的结果。</p></li><li class="listitem"><p>


                The MySQL Shell help describes an invalid URI:

            </p><p style="color:blue;">mysql shell帮助描述了一个无效的uri：</p><pre data-lang="simple" class="programlisting">USER[:PASS]@::SOCKET[/DB].</pre><p>

                This is invalid because the <code class="literal">@</code> symbol can
                not be present if no user information is provided.
            </p><p style="color:blue;">这是无效的，因为如果未提供用户信息，@符号将不存在。</p></li><li class="listitem"><p>


                If a session type is not specified when creating the global
                session, MySQL Shell provides automatic protocol detection
                which attempts to first create a NodeSession and if that fails
                it tries to create a ClassicSession. With an InnoDB cluster
                that consists of three server instances, where there is one
                read-write port and two read-only ports, this can cause
                MySQL Shell to only connect to one of the read-only
                instances. Therefore it is recommended to always specify the
                session type when creating the global session.
            </p><p style="color:blue;">如果在创建全局会话时未指定会话类型，mysql shell将提供自动协议检测，该检测将尝试首先创建nodesession，如果失败，则尝试创建classicsession。对于由三个服务器实例组成的innodb集群，其中有一个读写端口和两个只读端口，这可能导致mysql shell只连接到其中一个只读实例。因此，建议在创建全局会话时始终指定会话类型。</p></li><li class="listitem"><p>


                When adding non-sandbox server instances (instances which you
                have configured manually rather than using
                <code class="literal">dba.deploySandboxInstance()</code> ) to a cluster,
                MySQL Shell is not able to persist any configuration changes
                in the instance's configuration file. This leads to one or
                both of the following scenarios:
            </p><p style="color:blue;">将非沙盒服务器实例（您手动配置的实例，而不是使用dba.deploySandboxInstance（））添加到群集时，mysql shell无法在实例的配置文件中保留任何配置更改。这将导致以下一种或两种情况：</p>
                <div class="orderedlist">
                    <ol class="orderedlist" type="1"><li class="listitem"><p>
                        The Group Replication configuration is not persisted in
                        the instance's configuration file and upon restart the
                        instance does not rejoin the cluster.
                    </p><p style="color:blue;">组复制配置未保留在实例的配置文件中，并且在重新启动时实例不会重新加入群集。</p></li><li class="listitem"><p>
                        The instance is not valid for cluster usage. Although the
                        instance can be verified with
                        <code class="literal">dba.checkInstanceConfiguration()</code>, and
                        MySQL Shell makes the required configuration changes in
                        order to make the instance ready for cluster usage, those
                        changes are not persisted in the configuration file and so
                        are lost once a restart happens.
                    </p><p style="color:blue;">实例对群集使用无效。尽管可以使用dba.checkInstanceconfiguration（）对实例进行验证，并且mysql shell会进行所需的配置更改以使实例准备好群集使用，但这些更改不会保留在配置文件中，因此在重新启动后会丢失。</p></li></ol>
                </div>
                <p>
                    If only <code class="literal">a</code> happens, the instance does not
                    rejoin the cluster after a restart.
                </p><p style="color:blue;">如果仅发生，则实例在重新启动后不会重新加入群集。</p><p>
                    If <code class="literal">b</code> also happens, and you observe that the
                    instance did not rejoin the cluster after a restart, you
                    cannot use the recommended
                    <code class="literal">dba.rebootClusterFromCompleteOutage()</code> in
                    this situation to get the cluster back online. This is because
                    the instance loses any configuration changes made by
                    MySQL Shell, and because they were not persisted, the
                    instance reverts to the previous state before being configured
                    for the cluster. This causes Group Replication to stop
                    responding, and eventually the command times out.
                </p><p style="color:blue;">如果B也发生了，并且您观察到实例在重新启动后没有重新加入集群，那么在这种情况下，您不能使用推荐的dba.rebootclusterfromcompleteoutup（）来使集群重新联机。这是因为该实例丢失了mysql shell所做的任何配置更改，并且由于这些更改未被持久化，因此该实例将恢复到为群集配置之前的前一状态。这会导致组复制停止响应，并最终导致命令超时。</p><p>
                    To avoid this problem it is strongly recommended to use
                    <code class="literal">dba.configureLocalInstance()</code> before adding
                    instances to a cluster in order to persist the configuration
                    changes.
                </p><p style="color:blue;">为避免此问题，强烈建议在将实例添加到群集之前使用dba.configureLocalInstance（），以便保留配置更改。</p></li><li class="listitem"><p>


                Using MySQL server instances configured with the
                validate_password plugin and password policy set to
                <code class="literal">STRONG</code> causes InnoDB cluster
                <code class="literal">createCluster()</code> and MySQL Router bootstrap
                operations to fail. This is because the internal user required
                for access to the server instance can not be validated.
            </p><p style="color:blue;">使用将validate_password plugin和password策略设置为strong的mysql服务器实例会导致innodb cluster createcluster（）和mysql路由器引导操作失败。这是因为无法验证访问服务器实例所需的内部用户。</p></li><li class="listitem"><p>


                The MySQL Router <code class="option">--bootstrap</code> command line option
                does not accept IPv6 addresses.
            </p><p style="color:blue;">mysql router--bootstrap命令行选项不接受ipv6地址。</p></li><li class="listitem"><p>


                The commercial version of MySQL Router does not have the correct
                setting for AppArmor. A work around is to edit the AppArmor
                profile configuration file
                <code class="filename">/etc/apparmor.d/usr.sbin.mysqlrouter</code> and
                modify the line containing <code class="literal">/usr/sbin/mysqld</code>
                to use the path to MySQL Router, for example
                <code class="literal">/usr/sbin/mysqlrouter</code>.
            </p><p style="color:blue;">mysql路由器的商业版本没有apparmor的正确设置。解决方法是编辑apparmor配置文件/etc/apparmor.d/usr.sbin.mysql router并修改包含/usr/sbin/mysqld的行以使用mysql路由器的路径，例如/usr/sbin/mysqlrouter。</p></li><li class="listitem"><p>


                Using the <code class="literal">adoptFromGR</code> option with the
                <code class="literal">dba.createCluster()</code> function to create a
                cluster based on an existing deployment of Group Replication
                fails with an error that the instance is already part of a
                replication group. This happens in MySQL Shell's
                default wizard mode only. A workaround is to disable wizard
                mode by launching <span class="command"><strong>mysqlsh</strong></span> with the
                <a class="ulink" href="https://dev.mysql.com/doc/mysql-shell/8.0/en/mysqlsh.html#option_mysqlsh_no-wizard" target="_top"><code class="option">--no-wizard</code></a> command option.
            </p><p style="color:blue;">使用DAB.CONTAGLUBSUTE（）的ApvtSufRGR选项创建基于组复制的现有部署的集群失败，该错误是实例已经成为复制组的一部分。这只在mysql shell的默认向导模式下发生。解决方法是通过使用--no wizard命令选项启动mysqlsh来禁用向导模式。</p></li><li class="listitem"><p>






                The use of the
                <a class="link" href="server-administration.html#option_mysqld_defaults-extra-file"><code class="option">--defaults-extra-file</code></a> option to
                specify an option file is not supported by InnoDB cluster
                server instances. InnoDB cluster only supports a single
                option file on instances and no extra option files are
                supported. Therefore for any operation working with the
                instance's option file the main one should be specified. If
                you want to use multiple option files you have to configure
                the files manually and make sure they are updated correctly
                considering the precedence rules of the use of multiple option
                files and ensuring that the desired settings are not
                incorrectly overwritten by options in an extra unrecognized
                option file.
            </p><p style="color:blue;">innodb cluster server实例不支持使用--defaults extra file选项指定选项文件。innodb cluster只支持实例上的一个选项文件，不支持额外的选项文件。因此，对于使用实例的选项文件的任何操作，都应该指定main文件。如果要使用多个选项文件，则必须手动配置这些文件，并确保它们已正确更新，同时考虑到使用多个选项文件的优先规则，并确保所需设置不会被额外无法识别的选项文件中的选项错误覆盖。</p></li></ul>
        </div>

    </div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
    <hr>
    <table width="100%" summary="Navigation footer">
        <tbody><tr>
            <td width="40%" align="left"><a accesskey="p" href="document-store.html">Prev</a></td>
            <td width="20%" align="center"><a accesskey="u" href="">Up</a></td>
            <td width="40%" align="right">&nbsp;<a accesskey="n" href="mysql-cluster.html">Next</a></td>
        </tr>
        <tr>
            <td width="40%" align="left" valign="top">Chapter&nbsp;19 Using MySQL as a Document Store</td>
            <td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
            <td width="40%" align="right" valign="top">Chapter&nbsp;21 MySQL NDB Cluster 7.5 and NDB Cluster 7.6</td>
        </tr>
        </tbody></table>
</div>


</body></html>
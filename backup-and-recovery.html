<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Chapter&nbsp;7 Backup and Recovery</title>
    <link rel="stylesheet" href="mvl.css" type="text/css">
    <meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2">
    <link rel="start" href="index.html" title="{book-title}">
    <link rel="up" href="" title="">
    <link rel="prev" href="security.html" title="Chapter&nbsp;6 Security">
    <link rel="next" href="optimization.html" title="Chapter&nbsp;8 Optimization">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script></head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
    <table width="100%" summary="Navigation header">
        <tbody><tr>
            <th colspan="3" align="center">Chapter&nbsp;7 Backup and Recovery</th>
        </tr>
        <tr>
            <td width="20%" align="left"><a accesskey="p" href="security.html">Prev</a>&nbsp;</td>
            <th width="60%" align="center"></th>
            <td width="20%" align="right">&nbsp;<a accesskey="n" href="optimization.html">Next</a></td>
        </tr>
        </tbody></table>
    <hr>
</div>
<div class="chapter">
    <div class="titlepage">
        <div>
            <div>
                <h1 class="title"><a name="backup-and-recovery"></a>Chapter&nbsp;7&nbsp;Backup and Recovery</h1>

            </div>

        </div>

    </div>
    <div class="toc">
        <p><b>Table of Contents</b></p><p style="color:blue;">目录</p><dl class="toc"><dt><span class="section"><a href="backup-and-recovery.html#backup-types">7.1 Backup and Recovery Types</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#backup-methods">7.2 Database Backup Methods</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#backup-strategy-example">7.3 Example Backup and Recovery Strategy</a></span></dt><dd><dl><dt><span class="section"><a href="backup-and-recovery.html#backup-policy">7.3.1 Establishing a Backup Policy</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#recovery-from-backups">7.3.2 Using Backups for Recovery</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#backup-strategy-summary">7.3.3 Backup Strategy Summary</a></span></dt></dl></dd><dt><span class="section"><a href="backup-and-recovery.html#using-mysqldump">7.4 Using mysqldump for Backups</a></span></dt><dd><dl><dt><span class="section"><a href="backup-and-recovery.html#mysqldump-sql-format">7.4.1 Dumping Data in SQL Format with mysqldump</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#reloading-sql-format-dumps">7.4.2 Reloading SQL-Format Backups</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#mysqldump-delimited-text">7.4.3 Dumping Data in Delimited-Text Format with mysqldump</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#reloading-delimited-text-dumps">7.4.4 Reloading Delimited-Text Format Backups</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#mysqldump-tips">7.4.5 mysqldump Tips</a></span></dt></dl></dd><dt><span class="section"><a href="backup-and-recovery.html#point-in-time-recovery">7.5 Point-in-Time (Incremental) Recovery Using the Binary Log</a></span></dt><dd><dl><dt><span class="section"><a href="backup-and-recovery.html#point-in-time-recovery-times">7.5.1 Point-in-Time Recovery Using Event Times</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#point-in-time-recovery-positions">7.5.2 Point-in-Time Recovery Using Event Positions</a></span></dt></dl></dd><dt><span class="section"><a href="backup-and-recovery.html#myisam-table-maintenance">7.6 MyISAM Table Maintenance and Crash Recovery</a></span></dt><dd><dl><dt><span class="section"><a href="backup-and-recovery.html#myisam-crash-recovery">7.6.1 Using myisamchk for Crash Recovery</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#myisam-check">7.6.2 How to Check MyISAM Tables for Errors</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#myisam-repair">7.6.3 How to Repair MyISAM Tables</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#myisam-optimization">7.6.4 MyISAM Table Optimization</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#myisam-maintenance-schedule">7.6.5 Setting Up a MyISAM Table Maintenance Schedule</a></span></dt></dl></dd></dl>
    </div>
    <a class="indexterm" name="idm140286877168672"></a><a class="indexterm" name="idm140286877167184"></a><p>
    It is important to back up your databases so that you can recover
    your data and be up and running again in case problems occur, such
    as system crashes, hardware failures, or users deleting data by
    mistake. Backups are also essential as a safeguard before upgrading
    a MySQL installation, and they can be used to transfer a MySQL
    installation to another system or to set up replication slave
    servers.
</p><p style="color:blue;">备份数据库是很重要的，以便在出现问题（如系统崩溃、硬件故障或用户错误删除数据）时恢复数据并重新启动并运行。在升级mysql安装之前，备份也是必不可少的保护措施，它们可以用于将mysql安装转移到另一个系统或设置复制从属服务器。</p><p>
    MySQL offers a variety of backup strategies from which you can
    choose the methods that best suit the requirements for your
    installation. This chapter discusses several backup and recovery
    topics with which you should be familiar:
</p><p style="color:blue;">mysql提供了多种备份策略，您可以从中选择最适合安装要求的方法。本章讨论了几个您应该熟悉的备份和恢复主题：</p>
    <div class="itemizedlist">
        <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Types of backups: Logical versus physical, full versus
            incremental, and so forth.
        </p><p style="color:blue;">备份类型：逻辑备份与物理备份、完整备份与增量备份，等等。</p></li><li class="listitem"><p>
            Methods for creating backups.
        </p><p style="color:blue;">创建备份的方法。</p></li><li class="listitem"><p>
            Recovery methods, including point-in-time recovery.
        </p><p style="color:blue;">恢复方法，包括时间点恢复。</p></li><li class="listitem"><p>
            Backup scheduling, compression, and encryption.
        </p><p style="color:blue;">备份计划、压缩和加密。</p></li><li class="listitem"><p>
            Table maintenance, to enable recovery of corrupt tables.
        </p><p style="color:blue;">表维护，以便恢复损坏的表。</p></li></ul>
    </div>
    <h2><a name="idm140286877159952"></a>Additional Resources</h2>
    <p>
        Resources related to backup or to maintaining data availability
        include the following:
    </p><p style="color:blue;">与备份或维护数据可用性相关的资源包括：</p>
    <div class="itemizedlist">
        <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Customers of MySQL Enterprise Edition can use the MySQL Enterprise Backup product
            for backups. For an overview of the MySQL Enterprise Backup
            product, see <a class="xref" href="mysql-enterprise.html#mysql-enterprise-backup" title="29.2&nbsp;MySQL Enterprise Backup Overview">Section&nbsp;29.2, “MySQL Enterprise Backup Overview”</a>.
        </p><p style="color:blue;">mysql企业版的客户可以使用mysql企业备份产品进行备份。有关mysql企业备份产品的概述，请参阅29.2节“mysql企业备份概述”。</p></li><li class="listitem"><p>
            A forum dedicated to backup issues is available at
            <a class="ulink" href="https://forums.mysql.com/list.php?28" target="_top">https://forums.mysql.com/list.php?28</a>.
        </p><p style="color:blue;">专门讨论备份问题的论坛可以在https://forums.mysql.com/list.php上找到？28岁。</p></li><li class="listitem"><p>
            Details for <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> can be found in
            <a class="xref" href="programs.html" title="Chapter&nbsp;4&nbsp;MySQL Programs">Chapter&nbsp;4, <i>MySQL Programs</i></a>.
        </p><p style="color:blue;">mysqldump的详细信息可以在第4章mysql程序中找到。</p></li><li class="listitem"><p>
            The syntax of the SQL statements described here is given in
            <a class="xref" href="sql-syntax.html" title="Chapter&nbsp;13&nbsp;SQL Statement Syntax">Chapter&nbsp;13, <i>SQL Statement Syntax</i></a>.
        </p><p style="color:blue;">这里描述的sql语句的语法在第13章sql语句语法中给出。</p></li><li class="listitem"><p>
            For additional information about <code class="literal">InnoDB</code>
            backup procedures, see <a class="xref" href="innodb-storage-engine.html#innodb-backup" title="14.18.1&nbsp;InnoDB Backup">Section&nbsp;14.18.1, “InnoDB Backup”</a>.
        </p><p style="color:blue;">有关InnoDB备份过程的更多信息，请参阅第14.18.1节“InnoDB备份”。</p></li><li class="listitem"><p>
            Replication enables you to maintain identical data on multiple
            servers. This has several benefits, such as enabling client
            query load to be distributed over servers, availability of data
            even if a given server is taken offline or fails, and the
            ability to make backups with no impact on the master by using a
            slave server. See <a class="xref" href="replication.html" title="Chapter&nbsp;16&nbsp;Replication">Chapter&nbsp;16, <i>Replication</i></a>.
        </p><p style="color:blue;">复制使您能够在多台服务器上维护相同的数据。这有几个好处，例如允许客户机查询负载分布在服务器上，即使给定的服务器脱机或发生故障，数据也可用，以及通过使用从服务器在不影响主服务器的情况下进行备份的能力。见第16章，复制。</p></li><li class="listitem"><p>
            MySQL InnoDB cluster is a collection of products that work
            together to provide a high availability solution. A group of
            MySQL servers can be configured to create a cluster using
            MySQL Shell. The cluster of servers has a single master,
            called the primary, which acts as the read-write master.
            Multiple secondary servers are replicas of the master. A minimum
            of three servers are required to create a high availability
            cluster. A client application is connected to the primary via
            MySQL Router. If the primary fails, a secondary is automatically
            promoted to the role of primary, and MySQL Router routes requests to
            the new primary.
        </p><p style="color:blue;">mysql innodb cluster是一组产品，它们共同提供了一个高可用性解决方案。可以将一组mysql服务器配置为使用mysql shell创建集群。服务器集群有一个称为主服务器的主服务器，它充当读写主服务器。多个辅助服务器是主服务器的副本。创建高可用性群集至少需要三台服务器。客户端应用程序通过mysql路由器连接到主应用程序。如果主节点失败，则会自动将辅助节点提升为主节点的角色，并且mysql路由器会将请求路由到新的主节点。</p></li><li class="listitem"><p>
            NDB Cluster provides a high-availability, high-redundancy
            version of MySQL adapted for the distributed computing
            environment. See <a class="xref" href="mysql-cluster.html" title="Chapter&nbsp;21&nbsp;MySQL NDB Cluster 7.5 and NDB Cluster 7.6">Chapter&nbsp;21, <i>MySQL NDB Cluster 7.5 and NDB Cluster 7.6</i></a>, which provides
            information about MySQL NDB Cluster 7.5 (based on MySQL 5.7 but
            containing the latest improvements and fixes for the
            <a class="link" href="mysql-cluster.html" title="Chapter&nbsp;21&nbsp;MySQL NDB Cluster 7.5 and NDB Cluster 7.6"><code class="literal">NDB</code></a> storage engine).
        </p><p style="color:blue;">ndb集群提供了一个适用于分布式计算环境的高可用性、高冗余的mysql版本。参见第21章mysql ndb cluster 7.5和ndb cluster 7.6，其中提供了有关mysql ndb cluster 7.5的信息（基于mysql 5.7，但包含ndb存储引擎的最新改进和修复）。</p></li></ul>
    </div>
    <div class="section">
        <div class="titlepage">
            <div>
                <div>
                    <h2 class="title" style="clear: both"><a name="backup-types"></a>7.1&nbsp;Backup and Recovery Types</h2>

                </div>

            </div>

        </div>
        <p>
            This section describes the characteristics of different types of
            backups.
        </p><p style="color:blue;">本节介绍不同类型备份的特征。</p>
        <h3><a name="idm140286877140464"></a>Physical (Raw) Versus Logical Backups</h3>
        <p>
            Physical backups consist of raw copies of the directories and
            files that store database contents. This type of backup is
            suitable for large, important databases that need to be recovered
            quickly when problems occur.
        </p><p style="color:blue;">物理备份包括存储数据库内容的目录和文件的原始副本。这种类型的备份适用于需要在出现问题时快速恢复的大型重要数据库。</p><p>
        Logical backups save information represented as logical database
        structure (<a class="link" href="sql-syntax.html#create-database" title="13.1.11&nbsp;CREATE DATABASE Syntax"><code class="literal">CREATE DATABASE</code></a>,
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18&nbsp;CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements) and
        content (<a class="link" href="sql-syntax.html#insert" title="13.2.5&nbsp;INSERT Syntax"><code class="literal">INSERT</code></a> statements or
        delimited-text files). This type of backup is suitable for smaller
        amounts of data where you might edit the data values or table
        structure, or recreate the data on a different machine
        architecture.
    </p><p style="color:blue;">逻辑备份保存表示为逻辑数据库结构（创建数据库、创建表语句）和内容（插入语句或分隔文本文件）的信息。这种类型的备份适用于较小的数据量，您可以在其中编辑数据值或表结构，或者在不同的计算机体系结构上重新创建数据。</p><p>
        Physical backup methods have these characteristics:
    </p><p style="color:blue;">物理备份方法具有以下特点：</p>
        <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                The backup consists of exact copies of database directories
                and files. Typically this is a copy of all or part of the
                MySQL data directory.
            </p><p style="color:blue;">备份包括数据库目录和文件的精确副本。通常这是mysql数据目录的全部或部分副本。</p></li><li class="listitem"><p>
                Physical backup methods are faster than logical because they
                involve only file copying without conversion.
            </p><p style="color:blue;">物理备份方法比逻辑备份方法快，因为它们只涉及文件复制而不涉及转换。</p></li><li class="listitem"><p>
                Output is more compact than for logical backup.
            </p><p style="color:blue;">输出比逻辑备份更紧凑。</p></li><li class="listitem"><p>
                Because backup speed and compactness are important for busy,
                important databases, the MySQL Enterprise Backup product
                performs physical backups. For an overview of the MySQL
                Enterprise Backup product, see
                <a class="xref" href="mysql-enterprise.html#mysql-enterprise-backup" title="29.2&nbsp;MySQL Enterprise Backup Overview">Section&nbsp;29.2, “MySQL Enterprise Backup Overview”</a>.
            </p><p style="color:blue;">由于备份速度和紧凑性对于繁忙、重要的数据库非常重要，所以mysql企业备份产品执行物理备份。有关mysql企业备份产品的概述，请参阅29.2节“mysql企业备份概述”。</p></li><li class="listitem"><p>
                Backup and restore granularity ranges from the level of the
                entire data directory down to the level of individual files.
                This may or may not provide for table-level granularity,
                depending on storage engine. For example,
                <code class="literal">InnoDB</code> tables can each be in a separate
                file, or share file storage with other
                <code class="literal">InnoDB</code> tables; each
                <code class="literal">MyISAM</code> table corresponds uniquely to a set
                of files.
            </p><p style="color:blue;">备份和还原的粒度范围从整个数据目录的级别到单个文件的级别不等。这可能提供表级粒度，也可能不提供，具体取决于存储引擎。例如，innodb表可以分别位于单独的文件中，或者与其他innodb表共享文件存储；每个myisam表都与一组文件唯一对应。</p></li><li class="listitem"><p>
                In addition to databases, the backup can include any related
                files such as log or configuration files.
            </p><p style="color:blue;">除了数据库之外，备份还可以包含任何相关文件，如日志或配置文件。</p></li><li class="listitem"><p>
                Data from <code class="literal">MEMORY</code> tables is tricky to back
                up this way because their contents are not stored on disk.
                (The MySQL Enterprise Backup product has a feature where you
                can retrieve data from <code class="literal">MEMORY</code> tables during
                a backup.)
            </p><p style="color:blue;">内存表中的数据很难用这种方式备份，因为它们的内容不存储在磁盘上。（mysql企业备份产品有一个特性，您可以在备份期间从内存表中检索数据。）</p></li><li class="listitem"><p>
                Backups are portable only to other machines that have
                identical or similar hardware characteristics.
            </p><p style="color:blue;">备份只能移植到具有相同或相似硬件特性的其他计算机上。</p></li><li class="listitem"><p>
                Backups can be performed while the MySQL server is not
                running. If the server is running, it is necessary to perform
                appropriate locking so that the server does not change
                database contents during the backup. MySQL Enterprise Backup
                does this locking automatically for tables that require it.
            </p><p style="color:blue;">可以在mysql服务器未运行时执行备份。如果服务器正在运行，则需要执行适当的锁定，以便服务器在备份期间不会更改数据库内容。mysql enterprise backup会自动锁定需要它的表。</p></li><li class="listitem"><p>
                Physical backup tools include the
                <span class="command"><strong>mysqlbackup</strong></span> of MySQL Enterprise Backup for
                <code class="literal">InnoDB</code> or any other tables, or file
                system-level commands (such as <span class="command"><strong>cp</strong></span>,
                <span class="command"><strong>scp</strong></span>, <span class="command"><strong>tar</strong></span>,
                <span class="command"><strong>rsync</strong></span>) for <code class="literal">MyISAM</code>
                tables.
            </p><p style="color:blue;">物理备份工具包括mysql enterprise backup for innodb或任何其他表的mysqlbackup，或myisam表的文件系统级命令（如cp、scp、tar、rsync）。</p></li><li class="listitem"><p>
                For restore:
            </p><p style="color:blue;">要还原：</p>
                <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                        MySQL Enterprise Backup restores <code class="literal">InnoDB</code>
                        and other tables that it backed up.
                    </p><p style="color:blue;">mysql enterprise backup恢复它备份的innodb和其他表。</p></li><li class="listitem"><p>
                        <a class="link" href="mysql-cluster.html#mysql-cluster-programs-ndb-restore" title="21.4.24&nbsp;ndb_restore — Restore an NDB Cluster Backup"><span class="command"><strong>ndb_restore</strong></span></a> restores
                        <a class="link" href="mysql-cluster.html" title="Chapter&nbsp;21&nbsp;MySQL NDB Cluster 7.5 and NDB Cluster 7.6"><code class="literal">NDB</code></a> tables.
                    </p><p style="color:blue;">ndb_restore还原ndb表。</p></li><li class="listitem"><p>
                        Files copied at the file system level can be copied back
                        to their original locations with file system commands.
                    </p><p style="color:blue;">可以使用文件系统命令将在文件系统级别复制的文件复制回其原始位置。</p></li></ul>
                </div>
            </li></ul>
        </div>
        <p>
            Logical backup methods have these characteristics:
        </p><p style="color:blue;">逻辑备份方法具有以下特点：</p>
        <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                The backup is done by querying the MySQL server to obtain
                database structure and content information.
            </p><p style="color:blue;">备份是通过查询mysql服务器来获取数据库结构和内容信息。</p></li><li class="listitem"><p>
                Backup is slower than physical methods because the server must
                access database information and convert it to logical format.
                If the output is written on the client side, the server must
                also send it to the backup program.
            </p><p style="color:blue;">备份比物理方法慢，因为服务器必须访问数据库信息并将其转换为逻辑格式。如果输出是在客户端写入的，服务器还必须将其发送到备份程序。</p></li><li class="listitem"><p>
                Output is larger than for physical backup, particularly when
                saved in text format.
            </p><p style="color:blue;">输出大于物理备份，尤其是以文本格式保存时。</p></li><li class="listitem"><p>
                Backup and restore granularity is available at the server
                level (all databases), database level (all tables in a
                particular database), or table level. This is true regardless
                of storage engine.
            </p><p style="color:blue;">备份和还原粒度在服务器级别（所有数据库）、数据库级别（特定数据库中的所有表）或表级别可用。无论存储引擎如何，这都是正确的。</p></li><li class="listitem"><p>
                The backup does not include log or configuration files, or
                other database-related files that are not part of databases.
            </p><p style="color:blue;">备份不包括日志或配置文件，也不包括其他与数据库无关的文件。</p></li><li class="listitem"><p>
                Backups stored in logical format are machine independent and
                highly portable.
            </p><p style="color:blue;">以逻辑格式存储的备份是独立于计算机且高度可移植的。</p></li><li class="listitem"><p>
                Logical backups are performed with the MySQL server running.
                The server is not taken offline.
            </p><p style="color:blue;">在mysql服务器运行时执行逻辑备份。服务器未脱机。</p></li><li class="listitem"><p>
                Logical backup tools include the <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>
                program and the <a class="link" href="sql-syntax.html#select" title="13.2.9&nbsp;SELECT Syntax"><code class="literal">SELECT
                ... INTO OUTFILE</code></a> statement. These work for any
                storage engine, even <code class="literal">MEMORY</code>.
            </p><p style="color:blue;">逻辑备份工具包括mysqldump程序和select…进入外置文件语句。这些适用于任何存储引擎，甚至内存。</p></li><li class="listitem"><p>
                To restore logical backups, SQL-format dump files can be
                processed using the <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client. To load
                delimited-text files, use the <a class="link" href="sql-syntax.html#load-data" title="13.2.6&nbsp;LOAD DATA Syntax"><code class="literal">LOAD
                DATA</code></a> statement or the <a class="link" href="programs.html#mysqlimport" title="4.5.5&nbsp;mysqlimport — A Data Import Program"><span class="command"><strong>mysqlimport</strong></span></a>
                client.
            </p><p style="color:blue;">要恢复逻辑备份，可以使用mysql客户机处理sql格式的转储文件。要加载分隔文本文件，请使用LOAD DATA语句或mysqlimport客户机。</p></li></ul>
        </div>
        <h3><a name="idm140286877091328"></a>Online Versus Offline Backups</h3>
        <p>
            Online backups take place while the MySQL server is running so
            that the database information can be obtained from the server.
            Offline backups take place while the server is stopped. This
            distinction can also be described as <span class="quote">“<span class="quote">hot</span>”</span> versus
            <span class="quote">“<span class="quote">cold</span>”</span> backups; a <span class="quote">“<span class="quote">warm</span>”</span> backup is one
            where the server remains running but locked against modifying data
            while you access database files externally.
        </p><p style="color:blue;">联机备份在mysql服务器运行时进行，以便可以从服务器获取数据库信息。脱机备份在服务器停止时进行。这种区别也可以描述为“热”备份与“冷”备份；“热”备份是指在外部访问数据库文件时，服务器保持运行，但不修改数据的备份。</p><p>
        Online backup methods have these characteristics:
    </p><p style="color:blue;">联机备份方法具有以下特点：</p>
        <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                The backup is less intrusive to other clients, which can
                connect to the MySQL server during the backup and may be able
                to access data depending on what operations they need to
                perform.
            </p><p style="color:blue;">备份对其他客户机的干扰较小，这些客户机可以在备份期间连接到mysql服务器，并且可以根据需要执行的操作访问数据。</p></li><li class="listitem"><p>
                Care must be taken to impose appropriate locking so that data
                modifications do not take place that would compromise backup
                integrity. The MySQL Enterprise Backup product does such
                locking automatically.
            </p><p style="color:blue;">必须注意实施适当的锁定，以免发生会损害备份完整性的数据修改。mysql企业备份产品会自动执行这种锁定。</p></li></ul>
        </div>
        <p>
            Offline backup methods have these characteristics:
        </p><p style="color:blue;">脱机备份方法具有以下特点：</p>
        <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                Clients can be affected adversely because the server is
                unavailable during backup. For that reason, such backups are
                often taken from a replication slave server that can be taken
                offline without harming availability.
            </p><p style="color:blue;">由于服务器在备份期间不可用，客户端可能会受到不利影响。因此，此类备份通常是从复制从属服务器获取的，该服务器可以脱机而不会损害可用性。</p></li><li class="listitem"><p>
                The backup procedure is simpler because there is no
                possibility of interference from client activity.
            </p><p style="color:blue;">备份过程更简单，因为不可能受到客户端活动的干扰。</p></li></ul>
        </div>
        <p>
            A similar distinction between online and offline applies for
            recovery operations, and similar characteristics apply. However,
            it is more likely that clients will be affected for online
            recovery than for online backup because recovery requires stronger
            locking. During backup, clients might be able to read data while
            it is being backed up. Recovery modifies data and does not just
            read it, so clients must be prevented from accessing data while it
            is being restored.
        </p><p style="color:blue;">联机和脱机之间的类似区别适用于恢复操作，类似的特征也适用于恢复操作。但是，联机恢复比联机备份更可能影响客户端，因为恢复需要更强的锁定。在备份过程中，客户端可能可以在备份数据时读取数据。恢复会修改数据，而不仅仅是读取数据，因此必须防止客户端在还原数据时访问数据。</p>
        <h3><a name="idm140286877081808"></a>Local Versus Remote Backups</h3>
        <p>
            A local backup is performed on the same host where the MySQL
            server runs, whereas a remote backup is done from a different
            host. For some types of backups, the backup can be initiated from
            a remote host even if the output is written locally on the server.
            host.
        </p><p style="color:blue;">本地备份在mysql服务器运行的同一主机上执行，而远程备份则在不同的主机上执行。对于某些类型的备份，即使输出是在服务器上本地写入的，也可以从远程主机启动备份。主人。</p>
        <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> can connect to local or remote
                servers. For SQL output (<code class="literal">CREATE</code> and
                <a class="link" href="sql-syntax.html#insert" title="13.2.5&nbsp;INSERT Syntax"><code class="literal">INSERT</code></a> statements), local or
                remote dumps can be done and generate output on the client.
                For delimited-text output (with the
                <a class="link" href="programs.html#option_mysqldump_tab"><code class="option">--tab</code></a> option), data files
                are created on the server host.
            </p><p style="color:blue;">mysqldump可以连接到本地或远程服务器。对于sql输出（create和insert语句），可以在客户机上执行本地或远程转储并生成输出。对于分隔文本输出（使用--tab选项），将在服务器主机上创建数据文件。</p></li><li class="listitem"><p>
                <a class="link" href="sql-syntax.html#select-into" title="13.2.9.1&nbsp;SELECT ... INTO Syntax"><code class="literal">SELECT ... INTO
                    OUTFILE</code></a> can be initiated from a local or remote
                client host, but the output file is created on the server
                host.
            </p><p style="color:blue;">选择…into outfile可以从本地或远程客户端主机启动，但输出文件是在服务器主机上创建的。</p></li><li class="listitem"><p>
                Physical backup methods typically are initiated locally on the
                MySQL server host so that the server can be taken offline,
                although the destination for copied files might be remote.
            </p><p style="color:blue;">物理备份方法通常在mysql服务器主机上本地启动，这样服务器就可以脱机，尽管复制文件的目标可能是远程的。</p></li></ul>
        </div>
        <h3><a name="idm140286877071728"></a>Snapshot Backups</h3>
        <p>
            Some file system implementations enable <span class="quote">“<span class="quote">snapshots</span>”</span>
            to be taken. These provide logical copies of the file system at a
            given point in time, without requiring a physical copy of the
            entire file system. (For example, the implementation may use
            copy-on-write techniques so that only parts of the file system
            modified after the snapshot time need be copied.) MySQL itself
            does not provide the capability for taking file system snapshots.
            It is available through third-party solutions such as Veritas,
            LVM, or ZFS.
        </p><p style="color:blue;">一些文件系统实现允许拍摄“快照”。它们在给定的时间点提供文件系统的逻辑副本，而不需要整个文件系统的物理副本。（例如，实现可以使用写时拷贝技术，这样只需要拷贝快照时间之后修改的文件系统的一部分。）mysql本身不提供获取文件系统快照的功能。它可以通过第三方解决方案（如Veritas、LVM或ZFS）获得。</p>
        <h3><a name="idm140286877069648"></a>Full Versus Incremental Backups</h3>
        <p>
            A full backup includes all data managed by a MySQL server at a
            given point in time. An incremental backup consists of the changes
            made to the data during a given time span (from one point in time
            to another). MySQL has different ways to perform full backups,
            such as those described earlier in this section. Incremental
            backups are made possible by enabling the server's binary log,
            which the server uses to record data changes.
        </p><p style="color:blue;">完整备份包括MySQL服务器在给定时间点管理的所有数据。增量备份包括在给定时间范围内（从一个时间点到另一个时间点）对数据所做的更改。mysql有不同的方式来执行完整备份，如本节前面所述。通过启用服务器的二进制日志（服务器用来记录数据更改），可以进行增量备份。</p>
        <h3><a name="idm140286877068048"></a>Full Versus Point-in-Time (Incremental) Recovery</h3>
        <p>
            A full recovery restores all data from a full backup. This
            restores the server instance to the state that it had when the
            backup was made. If that state is not sufficiently current, a full
            recovery can be followed by recovery of incremental backups made
            since the full backup, to bring the server to a more up-to-date
            state.
        </p><p style="color:blue;">完全恢复从完全备份还原所有数据。这会将服务器实例还原到进行备份时的状态。如果该状态不是最新的，则完全恢复之后可以恢复自完全备份以来所做的增量备份，以使服务器处于更为最新的状态。</p><p>
        Incremental recovery is recovery of changes made during a given
        time span. This is also called point-in-time recovery because it
        makes a server's state current up to a given time. Point-in-time
        recovery is based on the binary log and typically follows a full
        recovery from the backup files that restores the server to its
        state when the backup was made. Then the data changes written in
        the binary log files are applied as incremental recovery to redo
        data modifications and bring the server up to the desired point in
        time.
    </p><p style="color:blue;">增量恢复是在给定时间范围内所做更改的恢复。这也称为时间点恢复，因为它使服务器的状态在给定时间内保持为当前状态。时间点恢复基于二进制日志，通常在从备份文件完全恢复后进行，该文件将服务器恢复到进行备份时的状态。然后，将写入二进制日志文件中的数据更改作为增量恢复应用，以重做数据修改并将服务器调到所需的时间点。</p>
        <h3><a name="idm140286877065536"></a>Table Maintenance</h3>
        <p>
            Data integrity can be compromised if tables become corrupt. For
            <a class="link" href="innodb-storage-engine.html" title="Chapter&nbsp;14&nbsp;The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> tables, this is not a typical
            issue. For programs to check <a class="link" href="storage-engines.html#myisam-storage-engine" title="15.2&nbsp;The MyISAM Storage Engine"><code class="literal">MyISAM</code></a>
            tables and repair them if problems are found, see
            <a class="xref" href="backup-and-recovery.html#myisam-table-maintenance" title="7.6&nbsp;MyISAM Table Maintenance and Crash Recovery">Section&nbsp;7.6, “MyISAM Table Maintenance and Crash Recovery”</a>.
        </p><p style="color:blue;">如果表损坏，数据完整性可能会受到损害。对于innodb表，这不是一个典型的问题。有关检查myisam表并在发现问题时修复它们的程序，请参阅第7.6节“myisam表维护和崩溃恢复”。</p>
        <h3><a name="idm140286877061056"></a>Backup Scheduling, Compression, and Encryption</h3>
        <p>
            Backup scheduling is valuable for automating backup procedures.
            Compression of backup output reduces space requirements, and
            encryption of the output provides better security against
            unauthorized access of backed-up data. MySQL itself does not
            provide these capabilities. The MySQL Enterprise Backup product
            can compress <code class="literal">InnoDB</code> backups, and compression or
            encryption of backup output can be achieved using file system
            utilities. Other third-party solutions may be available.
        </p><p style="color:blue;">备份计划对于自动化备份过程很有价值。压缩备份输出可减少空间需求，对输出进行加密可提供更好的安全性，防止未经授权访问备份数据。mysql本身并不提供这些功能。mysql企业备份产品可以压缩innodb备份，备份输出的压缩或加密可以使用文件系统实用程序实现。可能还有其他第三方解决方案。</p>
    </div>
    <div class="section">
        <div class="titlepage">
            <div>
                <div>
                    <h2 class="title" style="clear: both"><a name="backup-methods"></a>7.2&nbsp;Database Backup Methods</h2>

                </div>

            </div>

        </div>
        <p>
            This section summarizes some general methods for making backups.
        </p><p style="color:blue;">本节总结了一些常规的备份方法。</p>
        <h3><a name="idm140286877057040"></a>Making a Hot Backup with MySQL Enterprise Backup</h3>
        <p>
            Customers of MySQL Enterprise Edition can use the
            <a class="link" href="glossary.html#glos_mysql_enterprise_backup" title="MySQL Enterprise Backup">MySQL Enterprise
                Backup</a> product to do
            <a class="link" href="glossary.html#glos_physical" title="physical">physical</a> backups of entire
            instances or selected databases, tables, or both. This product
            includes features for
            <a class="link" href="glossary.html#glos_incremental_backup" title="incremental backup">incremental</a> and
            <a class="link" href="glossary.html#glos_compressed_backup" title="compressed backup">compressed</a> backups.
            Backing up the physical database files makes restore much faster
            than logical techniques such as the <code class="literal">mysqldump</code>
            command. <code class="literal">InnoDB</code> tables are copied using a
            <a class="link" href="glossary.html#glos_hot_backup" title="hot backup">hot backup</a> mechanism.
            (Ideally, the <code class="literal">InnoDB</code> tables should represent a
            substantial majority of the data.) Tables from other storage
            engines are copied using a <a class="link" href="glossary.html#glos_warm_backup" title="warm backup">warm
            backup</a> mechanism. For an overview of the MySQL Enterprise
            Backup product, see <a class="xref" href="mysql-enterprise.html#mysql-enterprise-backup" title="29.2&nbsp;MySQL Enterprise Backup Overview">Section&nbsp;29.2, “MySQL Enterprise Backup Overview”</a>.
        </p><p style="color:blue;">mysql企业版的客户可以使用mysql企业备份产品对整个实例或选定的数据库、表或两者进行物理备份。此产品包括增量备份和压缩备份的功能。备份物理数据库文件使恢复比mysqldump命令等逻辑技术快得多。使用热备份机制复制innodb表。（理想情况下，innodb表应该代表大部分数据。）使用热备份机制复制来自其他存储引擎的表。有关mysql企业备份产品的概述，请参阅29.2节“mysql企业备份概述”。</p>
        <h3><a name="idm140286877046816"></a>Making Backups with mysqldump</h3>
        <p>
            The <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> program can make backups. It can
            back up all kinds of tables. (See
            <a class="xref" href="backup-and-recovery.html#using-mysqldump" title="7.4&nbsp;Using mysqldump for Backups">Section&nbsp;7.4, “Using mysqldump for Backups”</a>.)
        </p><p style="color:blue;">mysqldump程序可以进行备份。它可以备份各种桌子。（请参阅第7.4节，“使用mysqldump进行备份”。）</p><p>
        For <code class="literal">InnoDB</code> tables, it is possible to perform an
        online backup that takes no locks on tables using the
        <a class="link" href="programs.html#option_mysqldump_single-transaction"><code class="option">--single-transaction</code></a> option to
        <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>. See <a class="xref" href="backup-and-recovery.html#backup-policy" title="7.3.1&nbsp;Establishing a Backup Policy">Section&nbsp;7.3.1, “Establishing a Backup Policy”</a>.
    </p><p style="color:blue;">对于innodb表，可以使用mysqldump的--single transaction选项执行不带锁的在线备份。参见第7.3.1节“建立备份策略”。</p>
        <h3><a name="idm140286877039408"></a>Making Backups by Copying Table Files</h3>
        <p>
            For storage engines that represent each table using its own files,
            tables can be backed up by copying those files. For example,
            <code class="literal">MyISAM</code> tables are stored as files, so it is
            easy to do a backup by copying files (<code class="filename">*.frm</code>,
            <code class="filename">*.MYD</code>, and <code class="filename">*.MYI</code> files).
            To get a consistent backup, stop the server or lock and flush the
            relevant tables:
        </p><p style="color:blue;">对于使用自己的文件表示每个表的存储引擎，可以通过复制这些文件来备份表。例如，myisam表存储为文件，因此通过复制文件（.frm、*.myd和*.myi文件）很容易进行备份。要获得一致的备份，请停止服务器或锁定并刷新相关表：</p><pre data-lang="sql" class="programlisting">FLUSH TABLES <em class="replaceable"><code>tbl_list</code></em> WITH READ LOCK;
</pre><p>
        You need only a read lock; this enables other clients to continue
        to query the tables while you are making a copy of the files in
        the database directory. The flush is needed to ensure that the all
        active index pages are written to disk before you start the
        backup. See <a class="xref" href="sql-syntax.html#lock-tables" title="13.3.5&nbsp;LOCK TABLES and UNLOCK TABLES Syntax">Section&nbsp;13.3.5, “LOCK TABLES and UNLOCK TABLES Syntax”</a>, and
        <a class="xref" href="sql-syntax.html#flush" title="13.7.6.3&nbsp;FLUSH Syntax">Section&nbsp;13.7.6.3, “FLUSH Syntax”</a>.
    </p><p style="color:blue;">您只需要一个读锁；这使其他客户机能够在您在数据库目录中复制文件时继续查询表。启动备份之前，需要刷新以确保所有活动索引页都写入磁盘。参见第13.3.5节“锁定表和解锁表语法”和第13.7.6.3节“刷新语法”。</p><p>
        You can also create a binary backup simply by copying all table
        files, as long as the server isn't updating anything. (But note
        that table file copying methods do not work if your database
        contains <code class="literal">InnoDB</code> tables. Also, even if the
        server is not actively updating data, <code class="literal">InnoDB</code>
        may still have modified data cached in memory and not flushed to
        disk.)
    </p><p style="color:blue;">只要服务器不更新任何内容，也可以通过复制所有表文件来创建二进制备份。（但请注意，如果数据库包含innodb表，则表文件复制方法不起作用。另外，即使服务器没有主动更新数据，innodb可能仍然有修改过的数据缓存在内存中，而没有刷新到磁盘。）</p>
        <h3><a name="idm140286877029488"></a>Making Delimited-Text File Backups</h3>
        <p>
            To create a text file containing a table's data, you can use
            <a class="link" href="sql-syntax.html#select-into" title="13.2.9.1&nbsp;SELECT ... INTO Syntax"><code class="literal">SELECT * INTO OUTFILE
                '<em class="replaceable"><code>file_name</code></em>' FROM
                <em class="replaceable"><code>tbl_name</code></em></code></a>. The file is created
            on the MySQL server host, not the client host. For this statement,
            the output file cannot already exist because permitting files to
            be overwritten constitutes a security risk. See
            <a class="xref" href="sql-syntax.html#select" title="13.2.9&nbsp;SELECT Syntax">Section&nbsp;13.2.9, “SELECT Syntax”</a>. This method works for any kind of data
            file, but saves only table data, not the table structure.
        </p><p style="color:blue;">要创建包含表数据的文本文件，可以使用select*into outfile'file_name'from tbl_name。该文件是在mysql服务器主机上创建的，而不是在客户端主机上创建的。对于此语句，输出文件不能存在，因为允许重写文件构成安全风险。参见第13.2.9节“选择语法”。此方法适用于任何类型的数据文件，但仅保存表数据，而不保存表结构。</p><p>
        Another way to create text data files (along with files containing
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18&nbsp;CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements for the
        backed up tables) is to use <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> with the
        <a class="link" href="programs.html#option_mysqldump_tab"><code class="option">--tab</code></a> option. See
        <a class="xref" href="backup-and-recovery.html#mysqldump-delimited-text" title="7.4.3&nbsp;Dumping Data in Delimited-Text Format with mysqldump">Section&nbsp;7.4.3, “Dumping Data in Delimited-Text Format with mysqldump”</a>.
    </p><p style="color:blue;">创建文本数据文件（以及包含备份表的CREATETABLE语句的文件）的另一种方法是使用mysqldump和--tab选项。见第7.4.3节，“使用mysqldump以分隔文本格式转储数据”。</p><p>
        To reload a delimited-text data file, use
        <a class="link" href="sql-syntax.html#load-data" title="13.2.6&nbsp;LOAD DATA Syntax"><code class="literal">LOAD DATA</code></a> or
        <a class="link" href="programs.html#mysqlimport" title="4.5.5&nbsp;mysqlimport — A Data Import Program"><span class="command"><strong>mysqlimport</strong></span></a>.
    </p><p style="color:blue;">若要重新加载分隔文本数据文件，请使用“加载数据”或“mysqlimport”。</p>
        <h3><a name="idm140286877017600"></a>Making Incremental Backups by Enabling the Binary Log</h3>
        <p>
            MySQL supports incremental backups: You must start the server with
            the <a class="link" href="replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a> option to enable
            binary logging; see <a class="xref" href="server-administration.html#binary-log" title="5.4.4&nbsp;The Binary Log">Section&nbsp;5.4.4, “The Binary Log”</a>. The binary log
            files provide you with the information you need to replicate
            changes to the database that are made subsequent to the point at
            which you performed a backup. At the moment you want to make an
            incremental backup (containing all changes that happened since the
            last full or incremental backup), you should rotate the binary log
            by using <a class="link" href="sql-syntax.html#flush-logs"><code class="literal">FLUSH LOGS</code></a>. This done, you
            need to copy to the backup location all binary logs which range
            from the one of the moment of the last full or incremental backup
            to the last but one. These binary logs are the incremental backup;
            at restore time, you apply them as explained in
            <a class="xref" href="backup-and-recovery.html#point-in-time-recovery" title="7.5&nbsp;Point-in-Time (Incremental) Recovery Using the Binary Log">Section&nbsp;7.5, “Point-in-Time (Incremental) Recovery Using the Binary Log”</a>. The next time you do a
            full backup, you should also rotate the binary log using
            <a class="link" href="sql-syntax.html#flush-logs"><code class="literal">FLUSH LOGS</code></a> or <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump
      --flush-logs</strong></span></a>. See <a class="xref" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program">Section&nbsp;4.5.4, “<span class="command"><strong>mysqldump</strong></span> — A Database Backup Program”</a>.
        </p><p style="color:blue;">MySQL支持增量备份：必须使用--log bin选项启动服务器才能启用二进制日志记录；请参阅5.4.4节“二进制日志”。二进制日志文件为您提供了将在执行备份之后所做的更改复制到数据库所需的信息。在您要进行增量备份（包含自上次完全备份或增量备份以来发生的所有更改）时，应该使用刷新日志来旋转二进制日志。完成后，您需要将所有二进制日志复制到备份位置，这些日志的范围从最后一次完整备份或增量备份的某一时刻到最后一次完整备份或增量备份的某一时刻。这些二进制日志是增量备份；在恢复时，您可以按照7.5节“使用二进制日志的时间点（增量）恢复”中的说明应用它们。下次执行完整备份时，还应该使用flush logs或mysqldump--flush logs旋转二进制日志。见4.5.4节，“mysqldump-数据库备份程序”。</p>
        <h3><a name="idm140286877008928"></a>Making Backups Using Replication Slaves</h3>
        <p>
            If you have performance problems with your master server while
            making backups, one strategy that can help is to set up
            replication and perform backups on the slave rather than on the
            master. See <a class="xref" href="replication.html#replication-solutions-backups" title="16.3.1&nbsp;Using Replication for Backups">Section&nbsp;16.3.1, “Using Replication for Backups”</a>.
        </p><p style="color:blue;">如果在备份时主服务器出现性能问题，一种有帮助的策略是在从服务器上而不是在主服务器上设置复制和执行备份。参见第16.3.1节“使用复制进行备份”。</p><p>
        If you are backing up a slave replication server, you should back
        up its master info and relay log info repositories (see
        <a class="xref" href="replication.html#slave-logs" title="16.2.4&nbsp;Replication Relay and Status Logs">Section&nbsp;16.2.4, “Replication Relay and Status Logs”</a>) when you back up the slave's
        databases, regardless of the backup method you choose. These
        information files are always needed to resume replication after
        you restore the slave's data. If your slave is replicating
        <a class="link" href="sql-syntax.html#load-data" title="13.2.6&nbsp;LOAD DATA Syntax"><code class="literal">LOAD DATA</code></a> statements, you should
        also back up any <code class="filename">SQL_LOAD-*</code> files that exist
        in the directory that the slave uses for this purpose. The slave
        needs these files to resume replication of any interrupted
        <a class="link" href="sql-syntax.html#load-data" title="13.2.6&nbsp;LOAD DATA Syntax"><code class="literal">LOAD DATA</code></a> operations. The location
        of this directory is the value of the
        <a class="link" href="replication.html#option_mysqld_slave-load-tmpdir"><code class="option">--slave-load-tmpdir</code></a> option. If the
        server was not started with that option, the directory location is
        the value of the <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a> system
        variable.
    </p><p style="color:blue;">如果要备份从复制服务器，无论选择何种备份方法，都应在备份从数据库时备份其主信息和中继日志信息存储库（请参阅第16.2.4节“复制中继和状态日志”）。在还原从机的数据后，始终需要这些信息文件来恢复复制。如果您的奴隶正在复制Load DATA语句，那么您也应该备份在该目录中使用的任何SqLyLoad -*文件。从机需要这些文件来恢复任何中断的加载数据操作的复制。此目录的位置是--slave load tmpdir选项的值。如果服务器不是使用该选项启动的，则目录位置是tmpdir系统变量的值。</p>
        <h3><a name="idm140286876999504"></a>Recovering Corrupt Tables</h3>
        <p>
            If you have to restore <code class="literal">MyISAM</code> tables that have
            become corrupt, try to recover them using
            <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5&nbsp;REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a> or <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk
      -r</strong></span></a> first. That should work in 99.9% of all cases. If
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> fails, see
            <a class="xref" href="backup-and-recovery.html#myisam-table-maintenance" title="7.6&nbsp;MyISAM Table Maintenance and Crash Recovery">Section&nbsp;7.6, “MyISAM Table Maintenance and Crash Recovery”</a>.
        </p><p style="color:blue;">如果必须恢复已损坏的myisam表，请先尝试使用repair table或myisamchk-r恢复它们。这在99.9%的情况下都有效。如果myisamchk出现故障，请参阅第7.6节“myisam表维护和崩溃恢复”。</p>
        <h3><a name="idm140286876993072"></a>Making Backups Using a File System Snapshot</h3>
        <p>
            If you are using a Veritas file system, you can make a backup like
            this:
        </p><p style="color:blue;">如果使用的是Veritas文件系统，则可以进行如下备份：</p>
        <div class="orderedlist">
            <ol class="orderedlist" type="1"><li class="listitem"><p>
                From a client program, execute <a class="link" href="sql-syntax.html#flush-tables-with-read-lock"><code class="literal">FLUSH
                TABLES WITH READ LOCK</code></a>.
            </p><p style="color:blue;">在客户端程序中，使用读锁执行刷新表。</p></li><li class="listitem"><p>
                From another shell, execute <code class="literal">mount vxfs
                snapshot</code>.
            </p><p style="color:blue;">从另一个shell执行mount vxfs snapshot。</p></li><li class="listitem"><p>
                From the first client, execute
                <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5&nbsp;LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
                    TABLES</code></a>.
            </p><p style="color:blue;">从第一个客户机执行unlock tables。</p></li><li class="listitem"><p>
                Copy files from the snapshot.
            </p><p style="color:blue;">从快照复制文件。</p></li><li class="listitem"><p>
                Unmount the snapshot.
            </p><p style="color:blue;">卸载快照。</p></li></ol>
        </div>
        <p>
            Similar snapshot capabilities may be available in other file
            systems, such as LVM or ZFS.
        </p><p style="color:blue;">类似的快照功能也可以在其他文件系统中使用，例如lvm或zfs。</p>
    </div>
    <div class="section">
        <div class="titlepage">
            <div>
                <div>
                    <h2 class="title" style="clear: both"><a name="backup-strategy-example"></a>7.3&nbsp;Example Backup and Recovery Strategy</h2>

                </div>

            </div>

        </div>
        <div class="toc">
            <dl class="toc"><dt><span class="section"><a href="backup-and-recovery.html#backup-policy">7.3.1 Establishing a Backup Policy</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#recovery-from-backups">7.3.2 Using Backups for Recovery</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#backup-strategy-summary">7.3.3 Backup Strategy Summary</a></span></dt></dl>
        </div>
        <p>
            This section discusses a procedure for performing backups that
            enables you to recover data after several types of crashes:
        </p><p style="color:blue;">本节讨论执行备份的过程，该过程使您能够在几种类型的崩溃后恢复数据：</p>
        <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                Operating system crash
            </p><p style="color:blue;">操作系统崩溃</p></li><li class="listitem"><p>
                Power failure
            </p><p style="color:blue;">停电</p></li><li class="listitem"><p>
                File system crash
            </p><p style="color:blue;">文件系统崩溃</p></li><li class="listitem"><p>
                Hardware problem (hard drive, motherboard, and so forth)
            </p><p style="color:blue;">硬件问题（硬盘、主板等）</p></li></ul>
        </div>
        <p>
            The example commands do not include options such as
            <a class="link" href="programs.html#option_general_user"><code class="option">--user</code></a> and
            <a class="link" href="programs.html#option_general_password"><code class="option">--password</code></a> for the
            <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> and <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client
            programs. You should include such options as necessary to enable
            client programs to connect to the MySQL server.
        </p><p style="color:blue;">示例命令不包括mysqldump和mysql客户端程序的--user和--password等选项。您应该包括必要的选项，以使客户端程序能够连接到mysql服务器。</p><p>
        Assume that data is stored in the <code class="literal">InnoDB</code>
        storage engine, which has support for transactions and automatic
        crash recovery. Assume also that the MySQL server is under load at
        the time of the crash. If it were not, no recovery would ever be
        needed.
    </p><p style="color:blue;">假设数据存储在innodb存储引擎中，该引擎支持事务和自动崩溃恢复。同时假设mysql服务器在崩溃时处于负载状态。如果不是这样，就永远不需要复苏。</p><p>
        For cases of operating system crashes or power failures, we can
        assume that MySQL's disk data is available after a restart. The
        <code class="literal">InnoDB</code> data files might not contain consistent
        data due to the crash, but <code class="literal">InnoDB</code> reads its
        logs and finds in them the list of pending committed and
        noncommitted transactions that have not been flushed to the data
        files. <code class="literal">InnoDB</code> automatically rolls back those
        transactions that were not committed, and flushes to its data
        files those that were committed. Information about this recovery
        process is conveyed to the user through the MySQL error log. The
        following is an example log excerpt:
    </p><p style="color:blue;">对于操作系统崩溃或电源故障的情况，我们可以假设mysql的磁盘数据在重启后可用。由于崩溃，innodb数据文件可能不包含一致的数据，但是innodb读取其日志，并在其中找到尚未刷新到数据文件的未决提交和未提交事务的列表。innodb会自动回滚那些未提交的事务，并刷新那些已提交的数据文件。有关此恢复过程的信息通过mysql错误日志传递给用户。以下是日志摘要示例：</p><pre data-lang="simple" class="programlisting">InnoDB: Database was not shut down normally.
InnoDB: Starting recovery from log files...
InnoDB: Starting log scan based on checkpoint at
InnoDB: log sequence number 0 13674004
InnoDB: Doing recovery: scanned up to log sequence number 0 13739520
InnoDB: Doing recovery: scanned up to log sequence number 0 13805056
InnoDB: Doing recovery: scanned up to log sequence number 0 13870592
InnoDB: Doing recovery: scanned up to log sequence number 0 13936128
...
InnoDB: Doing recovery: scanned up to log sequence number 0 20555264
InnoDB: Doing recovery: scanned up to log sequence number 0 20620800
InnoDB: Doing recovery: scanned up to log sequence number 0 20664692
InnoDB: 1 uncommitted transaction(s) which must be rolled back
InnoDB: Starting rollback of uncommitted transactions
InnoDB: Rolling back trx no 16745
InnoDB: Rolling back of trx no 16745 completed
InnoDB: Rollback of uncommitted transactions completed
InnoDB: Starting an apply batch of log records to the database...
InnoDB: Apply batch completed
InnoDB: Started
mysqld: ready for connections
</pre><p>
        For the cases of file system crashes or hardware problems, we can
        assume that the MySQL disk data is <span class="emphasis"><em>not</em></span>
        available after a restart. This means that MySQL fails to start
        successfully because some blocks of disk data are no longer
        readable. In this case, it is necessary to reformat the disk,
        install a new one, or otherwise correct the underlying problem.
        Then it is necessary to recover our MySQL data from backups, which
        means that backups must already have been made. To make sure that
        is the case, design and implement a backup policy.
    </p><p style="color:blue;">对于文件系统崩溃或硬件问题，我们可以假设mysql磁盘数据在重新启动后不可用。这意味着mysql无法成功启动，因为某些磁盘数据块不再可读。在这种情况下，需要重新格式化磁盘、安装新磁盘或以其他方式更正底层问题。然后需要从备份中恢复mysql数据，这意味着必须已经进行了备份。为了确保这一点，设计并实现一个备份策略。</p>
        <div class="section">

            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="backup-policy"></a>7.3.1&nbsp;Establishing a Backup Policy</h3>
                    </div>
                </div>
            </div>
            <p>
                To be useful, backups must be scheduled regularly. A full backup
                (a snapshot of the data at a point in time) can be done in MySQL
                with several tools. For example,
                <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="29.2&nbsp;MySQL Enterprise Backup Overview">MySQL Enterprise
                    Backup</a> can perform a
                <a class="link" href="glossary.html#glos_physical_backup" title="physical backup">physical backup</a> of
                an entire instance, with optimizations to minimize overhead and
                avoid disruption when backing up <code class="literal">InnoDB</code> data
                files; <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> provides online
                <a class="link" href="glossary.html#glos_logical_backup" title="logical backup">logical backup</a>. This
                discussion uses <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>.
            </p><p style="color:blue;">为了有用，必须定期安排备份。完整备份（一个时间点的数据快照）可以在mysql中使用多种工具完成。例如，mysql enterprise backup可以对整个实例执行物理备份，在备份innodb数据文件时进行优化以最小化开销并避免中断；mysqldump提供在线逻辑备份。此讨论使用mysqldump。</p><p>
            Assume that we make a full backup of all our
            <code class="literal">InnoDB</code> tables in all databases using the
            following command on Sunday at 1 p.m., when load is low:
        </p><p style="color:blue;">假设在周日下午1点，当负载较低时，我们使用以下命令对所有数据库中的所有innodb表进行完全备份：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump --all-databases --master-data --single-transaction &gt; backup_sunday_1_PM.sql</code></strong>
</pre><p>
            The resulting <code class="filename">.sql</code> file produced by
            <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> contains a set of SQL
            <a class="link" href="sql-syntax.html#insert" title="13.2.5&nbsp;INSERT Syntax"><code class="literal">INSERT</code></a> statements that can be
            used to reload the dumped tables at a later time.
        </p><p style="color:blue;">mysqldump生成的.sql文件包含一组sql insert语句，可用于以后重新加载转储的表。</p><p>
            This backup operation acquires a global read lock on all tables
            at the beginning of the dump (using <a class="link" href="sql-syntax.html#flush-tables-with-read-lock"><code class="literal">FLUSH
            TABLES WITH READ LOCK</code></a>). As soon as this lock has been
            acquired, the binary log coordinates are read and the lock is
            released. If long updating statements are running when the
            <a class="link" href="sql-syntax.html#flush" title="13.7.6.3&nbsp;FLUSH Syntax"><code class="literal">FLUSH</code></a> statement is issued, the
            backup operation may stall until those statements finish. After
            that, the dump becomes lock-free and does not disturb reads and
            writes on the tables.
        </p><p style="color:blue;">此备份操作在转储开始时获取所有表的全局读锁（使用带读锁的刷新表）。一旦获取了这个锁，就会读取二进制日志坐标并释放锁。如果发出flush语句时正在运行长更新语句，则备份操作可能会暂停，直到这些语句完成。之后，转储将变为无锁，并且不会干扰表上的读写操作。</p><p>
            It was assumed earlier that the tables to back up are
            <code class="literal">InnoDB</code> tables, so
            <a class="link" href="programs.html#option_mysqldump_single-transaction"><code class="option">--single-transaction</code></a> uses a
            consistent read and guarantees that data seen by
            <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> does not change. (Changes made by
            other clients to <code class="literal">InnoDB</code> tables are not seen
            by the <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> process.) If the backup
            operation includes nontransactional tables, consistency requires
            that they do not change during the backup. For example, for the
            <code class="literal">MyISAM</code> tables in the <code class="literal">mysql</code>
            database, there must be no administrative changes to MySQL
            accounts during the backup.
        </p><p style="color:blue;">前面假设要备份的表是innodb表，所以——单个事务使用一致的读取，并保证mysqldump看到的数据不会更改。（mysqldump进程看不到其他客户端对innodb表所做的更改。）如果备份操作包括非事务表，一致性要求它们在备份期间不发生更改。例如，对于mysql数据库中的myisam表，备份期间不得对mysql帐户进行管理更改。</p><p>
            Full backups are necessary, but it is not always convenient to
            create them. They produce large backup files and take time to
            generate. They are not optimal in the sense that each successive
            full backup includes all data, even that part that has not
            changed since the previous full backup. It is more efficient to
            make an initial full backup, and then to make incremental
            backups. The incremental backups are smaller and take less time
            to produce. The tradeoff is that, at recovery time, you cannot
            restore your data just by reloading the full backup. You must
            also process the incremental backups to recover the incremental
            changes.
        </p><p style="color:blue;">完全备份是必要的，但创建它们并不总是方便的。它们生成大型备份文件并需要时间来生成。它们不是最优的，因为每个连续的完整备份都包含所有数据，甚至包括自上次完整备份以来未更改的部分。首先进行完全备份，然后进行增量备份会更有效。增量备份更小，生成所需的时间也更少。折衷的办法是，在恢复时，不能仅通过重新加载完整备份来恢复数据。还必须处理增量备份以恢复增量更改。</p><p>
            To make incremental backups, we need to save the incremental
            changes. In MySQL, these changes are represented in the binary
            log, so the MySQL server should always be started with the
            <a class="link" href="replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a> option to enable that
            log. With binary logging enabled, the server writes each data
            change into a file while it updates data. Looking at the data
            directory of a MySQL server that was started with the
            <a class="link" href="replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a> option and that has
            been running for some days, we find these MySQL binary log
            files:
        </p><p style="color:blue;">要进行增量备份，我们需要保存增量更改。在MySQL中，这些更改在二进制日志中表示，因此MySQL服务器应该始终使用--log bin选项启动以启用该日志。启用二进制日志记录后，服务器在更新数据时将每个数据更改写入文件。查看一个MySQL服务器的数据目录，该服务器是用--log bin选项启动的，并且已经运行了几天，我们发现这些MySQL二进制日志文件：</p><pre data-lang="simple" class="programlisting">-rw-rw---- 1 guilhem  guilhem   1277324 Nov 10 23:59 gbichot2-bin.000001
-rw-rw---- 1 guilhem  guilhem         4 Nov 10 23:59 gbichot2-bin.000002
-rw-rw---- 1 guilhem  guilhem        79 Nov 11 11:06 gbichot2-bin.000003
-rw-rw---- 1 guilhem  guilhem       508 Nov 11 11:08 gbichot2-bin.000004
-rw-rw---- 1 guilhem  guilhem 220047446 Nov 12 16:47 gbichot2-bin.000005
-rw-rw---- 1 guilhem  guilhem    998412 Nov 14 10:08 gbichot2-bin.000006
-rw-rw---- 1 guilhem  guilhem       361 Nov 14 10:07 gbichot2-bin.index
</pre><p>
            Each time it restarts, the MySQL server creates a new binary log
            file using the next number in the sequence. While the server is
            running, you can also tell it to close the current binary log
            file and begin a new one manually by issuing a
            <a class="link" href="sql-syntax.html#flush-logs"><code class="literal">FLUSH LOGS</code></a> SQL statement or with
            a <a class="link" href="programs.html#mysqladmin" title="4.5.2&nbsp;mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin flush-logs</strong></span></a> command.
            <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> also has an option to flush the
            logs. The <code class="literal">.index</code> file in the data directory
            contains the list of all MySQL binary logs in the directory.
        </p><p style="color:blue;">每次重新启动时，mysql服务器都会使用序列中的下一个数字创建一个新的二进制日志文件。当服务器运行时，您还可以告诉它关闭当前的二进制日志文件，并通过发出flush logs sql语句或使用mysqladmin flush logs命令手动开始新的日志文件。mysqldump还有一个刷新日志的选项。data目录中的.index文件包含该目录中所有mysql二进制日志的列表。</p><p>
            The MySQL binary logs are important for recovery because they
            form the set of incremental backups. If you make sure to flush
            the logs when you make your full backup, the binary log files
            created afterward contain all the data changes made since the
            backup. Let's modify the previous <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>
            command a bit so that it flushes the MySQL binary logs at the
            moment of the full backup, and so that the dump file contains
            the name of the new current binary log:
        </p><p style="color:blue;">mysql二进制日志对于恢复非常重要，因为它们形成了一组增量备份。如果在进行完全备份时确保刷新日志，则随后创建的二进制日志文件将包含备份后所做的所有数据更改。让我们稍微修改一下前面的mysql dump命令，以便它在完全备份时刷新mysql二进制日志，并使转储文件包含新的当前二进制日志的名称：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump --single-transaction --flush-logs --master-data=2 \</code></strong>
         <strong class="userinput"><code>--all-databases &gt; backup_sunday_1_PM.sql</code></strong>
</pre><p>
            After executing this command, the data directory contains a new
            binary log file, <code class="filename">gbichot2-bin.000007</code>,
            because the <a class="link" href="programs.html#option_mysqldump_flush-logs"><code class="option">--flush-logs</code></a>
            option causes the server to flush its logs. The
            <a class="link" href="programs.html#option_mysqldump_master-data"><code class="option">--master-data</code></a> option causes
            <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to write binary log information to
            its output, so the resulting <code class="filename">.sql</code> dump file
            includes these lines:
        </p><p style="color:blue;">执行此命令后，数据目录包含一个新的二进制日志文件gbichot2-bin.000007，因为--flush logs选项使服务器刷新其日志。--master data选项使mysqldump将二进制日志信息写入其输出，因此生成的.sql转储文件包含以下行：</p><pre data-lang="simple" class="programlisting">-- Position to start replication or point-in-time recovery from
-- CHANGE MASTER TO MASTER_LOG_FILE='gbichot2-bin.000007',MASTER_LOG_POS=4;
</pre><p>
            Because the <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> command made a full
            backup, those lines mean two things:
        </p><p style="color:blue;">因为mysqldump命令进行了完全备份，所以这些行意味着两件事：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    The dump file contains all changes made before any changes
                    written to the <code class="filename">gbichot2-bin.000007</code>
                    binary log file or higher.
                </p><p style="color:blue;">转储文件包含在写入gbichot2-bin.000007二进制日志文件或更高版本之前所做的所有更改。</p></li><li class="listitem"><p>
                    All data changes logged after the backup are not present in
                    the dump file, but are present in the
                    <code class="filename">gbichot2-bin.000007</code> binary log file or
                    higher.
                </p><p style="color:blue;">备份后记录的所有数据更改不在转储文件中，但在gbichot2-bin.000007二进制日志文件或更高版本中存在。</p></li></ul>
            </div>
            <p>
                On Monday at 1 p.m., we can create an incremental backup by
                flushing the logs to begin a new binary log file. For example,
                executing a <a class="link" href="programs.html#mysqladmin" title="4.5.2&nbsp;mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin flush-logs</strong></span></a> command
                creates <code class="filename">gbichot2-bin.000008</code>. All changes
                between the Sunday 1 p.m. full backup and Monday 1 p.m. will be
                in the <code class="filename">gbichot2-bin.000007</code> file. This
                incremental backup is important, so it is a good idea to copy it
                to a safe place. (For example, back it up on tape or DVD, or
                copy it to another machine.) On Tuesday at 1 p.m., execute
                another <a class="link" href="programs.html#mysqladmin" title="4.5.2&nbsp;mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin flush-logs</strong></span></a> command. All
                changes between Monday 1 p.m. and Tuesday 1 p.m. will be in the
                <code class="filename">gbichot2-bin.000008</code> file (which also should
                be copied somewhere safe).
            </p><p style="color:blue;">周一下午1点，我们可以通过刷新日志来创建一个增量备份，以开始一个新的二进制日志文件。例如，执行mysqladmin flush logs命令将创建gbichot2-bin.000008。星期天下午1点完全备份到星期一下午1点之间的所有更改都将位于gbichot2-bin.000007文件中。这种增量备份非常重要，因此最好将其复制到安全的地方。（例如，将其备份到磁带或DVD上，或复制到另一台计算机上。）周二下午1点，执行另一个mysqladmin flush logs命令。星期一下午1点到星期二下午1点之间的所有更改都将保存在gbichot2-bin.000008文件中（该文件也应复制到安全的地方）。</p><p>
            The MySQL binary logs take up disk space. To free up space,
            purge them from time to time. One way to do this is by deleting
            the binary logs that are no longer needed, such as when we make
            a full backup:
        </p><p style="color:blue;">mysql二进制日志占用磁盘空间。要释放空间，请不时地清除它们。一种方法是删除不再需要的二进制日志，例如在进行完全备份时：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump --single-transaction --flush-logs --master-data=2 \</code></strong>
         <strong class="userinput"><code>--all-databases --delete-master-logs &gt; backup_sunday_1_PM.sql</code></strong>
</pre>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Note
                </div>
                <p>
                    Deleting the MySQL binary logs with <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump
          --delete-master-logs</strong></span></a> can be dangerous if your server
                    is a replication master server, because slave servers might
                    not yet fully have processed the contents of the binary log.
                    The description for the <a class="link" href="sql-syntax.html#purge-binary-logs" title="13.4.1.1&nbsp;PURGE BINARY LOGS Syntax"><code class="literal">PURGE BINARY
                    LOGS</code></a> statement explains what should be verified
                    before deleting the MySQL binary logs. See
                    <a class="xref" href="sql-syntax.html#purge-binary-logs" title="13.4.1.1&nbsp;PURGE BINARY LOGS Syntax">Section&nbsp;13.4.1.1, “PURGE BINARY LOGS Syntax”</a>.
                </p><p style="color:blue;">使用mysqldump删除mysql二进制日志——如果您的服务器是复制主服务器，则删除主日志可能会很危险，因为从服务器可能尚未完全处理二进制日志的内容。purge binary logs语句的说明解释了在删除mysql二进制日志之前应验证的内容。见第13.4.1.1节“清除二进制日志语法”。</p>
            </div>

        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="recovery-from-backups"></a>7.3.2&nbsp;Using Backups for Recovery</h3>

                    </div>

                </div>

            </div>
            <p>
                Now, suppose that we have a catastrophic crash on Wednesday at 8
                a.m. that requires recovery from backups. To recover, first we
                restore the last full backup we have (the one from Sunday 1
                p.m.). The full backup file is just a set of SQL statements, so
                restoring it is very easy:
            </p><p style="color:blue;">现在，假设周三早上8点发生了灾难性的崩溃，需要从备份中恢复。为了恢复，首先我们恢复最后一个完整备份（星期天下午1点的备份）。完整备份文件只是一组SQL语句，因此恢复非常容易：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysql &lt; backup_sunday_1_PM.sql</code></strong>
</pre><p>
            At this point, the data is restored to its state as of Sunday 1
            p.m.. To restore the changes made since then, we must use the
            incremental backups; that is, the
            <code class="filename">gbichot2-bin.000007</code> and
            <code class="filename">gbichot2-bin.000008</code> binary log files. Fetch
            the files if necessary from where they were backed up, and then
            process their contents like this:
        </p><p style="color:blue;">此时，数据将恢复到周日下午1点的状态。要恢复自那时以来所做的更改，我们必须使用增量备份；即gbichot2-bin.000007和gbichot2-bin.000008二进制日志文件。必要时从备份文件的位置获取文件，然后按如下方式处理其内容：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog gbichot2-bin.000007 gbichot2-bin.000008 | mysql</code></strong>
</pre><p>
            We now have recovered the data to its state as of Tuesday 1
            p.m., but still are missing the changes from that date to the
            date of the crash. To not lose them, we would have needed to
            have the MySQL server store its MySQL binary logs into a safe
            location (RAID disks, SAN, ...) different from the place where
            it stores its data files, so that these logs were not on the
            destroyed disk. (That is, we can start the server with a
            <a class="link" href="replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a> option that specifies a
            location on a different physical device from the one on which
            the data directory resides. That way, the logs are safe even if
            the device containing the directory is lost.) If we had done
            this, we would have the <code class="filename">gbichot2-bin.000009</code>
            file (and any subsequent files) at hand, and we could apply them
            using <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> and
            <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> to restore the most recent data changes
            with no loss up to the moment of the crash:
        </p><p style="color:blue;">目前，我们已将数据恢复到周二下午1点的状态，但仍缺少从该日期到坠机日期的变化。为了不丢失它们，我们需要让mysql服务器将其mysql二进制日志存储到一个安全的位置（raid磁盘、san，…），而不是存储其数据文件的位置，这样这些日志就不在被销毁的磁盘上。（也就是说，我们可以使用--log bin选项启动服务器，该选项指定数据目录所在物理设备上的不同位置。这样，即使包含目录的设备丢失了，日志也是安全的。）如果我们做到了这一点，我们将拥有gbichot2-bin.000009文件（以及任何后续文件），并且我们可以使用mysqlbinlog和mysql应用它们来还原最新的数据更改，直到崩溃时都不会丢失：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog gbichot2-bin.000009 ... | mysql</code></strong>
</pre><p>
            For more information about using <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a>
            to process binary log files, see
            <a class="xref" href="backup-and-recovery.html#point-in-time-recovery" title="7.5&nbsp;Point-in-Time (Incremental) Recovery Using the Binary Log">Section&nbsp;7.5, “Point-in-Time (Incremental) Recovery Using the Binary Log”</a>.
        </p><p style="color:blue;">有关使用mysqlbinlog处理二进制日志文件的更多信息，请参阅7.5节“使用二进制日志的时间点（增量）恢复”。</p>
        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="backup-strategy-summary"></a>7.3.3&nbsp;Backup Strategy Summary</h3>

                    </div>

                </div>

            </div>
            <p>
                In case of an operating system crash or power failure,
                <code class="literal">InnoDB</code> itself does all the job of recovering
                data. But to make sure that you can sleep well, observe the
                following guidelines:
            </p><p style="color:blue;">在操作系统崩溃或电源故障的情况下，innodb本身负责恢复数据的所有工作。但要确保你能睡得好，请遵守以下准则：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    Always run the MySQL server with the
                    <a class="link" href="replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a> option, or even
                    <a class="link" href="replication.html#option_mysqld_log-bin"><code class="option">--log-bin=<em class="replaceable"><code>log_name</code></em></code></a>,
                    where the log file name is located on some safe media
                    different from the drive on which the data directory is
                    located. If you have such safe media, this technique can
                    also be good for disk load balancing (which results in a
                    performance improvement).
                </p><p style="color:blue;">始终使用--log bin选项运行mysql服务器，甚至使用--log bin=log_name，其中日志文件名位于与数据目录所在驱动器不同的安全介质上。如果您有这样安全的介质，这种技术也可以很好地实现磁盘负载平衡（这会提高性能）。</p></li><li class="listitem"><p>
                    Make periodic full backups, using the
                    <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> command shown earlier in
                    <a class="xref" href="backup-and-recovery.html#backup-policy" title="7.3.1&nbsp;Establishing a Backup Policy">Section&nbsp;7.3.1, “Establishing a Backup Policy”</a>, that makes an online,
                    nonblocking backup.
                </p><p style="color:blue;">使用前面第7.3.1节“建立备份策略”中显示的mysqldump命令进行定期完整备份，该命令可进行在线、非阻塞备份。</p></li><li class="listitem"><p>
                    Make periodic incremental backups by flushing the logs with
                    <a class="link" href="sql-syntax.html#flush-logs"><code class="literal">FLUSH LOGS</code></a> or
                    <a class="link" href="programs.html#mysqladmin" title="4.5.2&nbsp;mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin flush-logs</strong></span></a>.
                </p><p style="color:blue;">通过使用刷新日志或mysqladmin刷新日志刷新日志来进行定期增量备份。</p></li></ul>
            </div>

        </div>

    </div>
    <div class="section">
        <div class="titlepage">
            <div>
                <div>
                    <h2 class="title" style="clear: both"><a name="using-mysqldump"></a>7.4&nbsp;Using mysqldump for Backups</h2>

                </div>

            </div>

        </div>
        <div class="toc">
            <dl class="toc"><dt><span class="section"><a href="backup-and-recovery.html#mysqldump-sql-format">7.4.1 Dumping Data in SQL Format with mysqldump</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#reloading-sql-format-dumps">7.4.2 Reloading SQL-Format Backups</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#mysqldump-delimited-text">7.4.3 Dumping Data in Delimited-Text Format with mysqldump</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#reloading-delimited-text-dumps">7.4.4 Reloading Delimited-Text Format Backups</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#mysqldump-tips">7.4.5 mysqldump Tips</a></span></dt></dl>
        </div>
        <a class="indexterm" name="idm140286876868528"></a><a class="indexterm" name="idm140286876867072"></a><p>
        This section describes how to use <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to
        produce dump files, and how to reload dump files. A dump file can
        be used in several ways:
    </p><p style="color:blue;">本节介绍如何使用mysqldump生成转储文件，以及如何重新加载转储文件。转储文件可以通过多种方式使用：</p>
        <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                As a backup to enable data recovery in case of data loss.
            </p><p style="color:blue;">作为备份，以便在数据丢失时进行数据恢复。</p></li><li class="listitem"><p>
                As a source of data for setting up replication slaves.
            </p><p style="color:blue;">作为设置复制从属服务器的数据源。</p></li><li class="listitem"><p>
                As a source of data for experimentation:
            </p><p style="color:blue;">作为实验数据的来源：</p>
                <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                        To make a copy of a database that you can use without
                        changing the original data.
                    </p><p style="color:blue;">复制一个可以使用而不更改原始数据的数据库。</p></li><li class="listitem"><p>
                        To test potential upgrade incompatibilities.
                    </p><p style="color:blue;">测试潜在的升级不兼容。</p></li></ul>
                </div>
            </li></ul>
        </div>
        <p>
            <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> produces two types of output,
            depending on whether the <a class="link" href="programs.html#option_mysqldump_tab"><code class="option">--tab</code></a>
            option is given:
        </p><p style="color:blue;">mysqldump根据是否提供--tab选项，生成两种类型的输出：</p>
        <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                Without <a class="link" href="programs.html#option_mysqldump_tab"><code class="option">--tab</code></a>,
                <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> writes SQL statements to the
                standard output. This output consists of
                <code class="literal">CREATE</code> statements to create dumped objects
                (databases, tables, stored routines, and so forth), and
                <code class="literal">INSERT</code> statements to load data into tables.
                The output can be saved in a file and reloaded later using
                <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> to recreate the dumped objects.
                Options are available to modify the format of the SQL
                statements, and to control which objects are dumped.
            </p><p style="color:blue;">如果没有--tab，mysqldump会将sql语句写入标准输出。此输出包括创建转储对象（数据库、表、存储例程等）的CREATE语句和将数据加载到表中的INSERT语句。输出可以保存在文件中，稍后使用mysql重新加载，以重新创建转储的对象。选项可用于修改SQL语句的格式，以及控制转储哪些对象。</p></li><li class="listitem"><p>
                With <a class="link" href="programs.html#option_mysqldump_tab"><code class="option">--tab</code></a>,
                <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> produces two output files for
                each dumped table. The server writes one file as tab-delimited
                text, one line per table row. This file is named
                <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.txt</code>
                in the output directory. The server also sends a
                <a class="link" href="sql-syntax.html#create-table" title="13.1.18&nbsp;CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement for the
                table to <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>, which writes it as a
                file named
                <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.sql</code>
                in the output directory.
            </p><p style="color:blue;">使用--tab，mysqldump为每个转储表生成两个输出文件。服务器以制表符分隔的文本形式写入一个文件，每个表行一行。此文件在输出目录中命名为tbl_name.txt。服务器还向mysqldump发送表的create table语句，mysqldump将其作为名为tbl_name.sql的文件写入输出目录。</p></li></ul>
        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="mysqldump-sql-format"></a>7.4.1&nbsp;Dumping Data in SQL Format with mysqldump</h3>

                    </div>

                </div>

            </div>
            <p>
                This section describes how to use <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>
                to create SQL-format dump files. For information about reloading
                such dump files, see
                <a class="xref" href="backup-and-recovery.html#reloading-sql-format-dumps" title="7.4.2&nbsp;Reloading SQL-Format Backups">Section&nbsp;7.4.2, “Reloading SQL-Format Backups”</a>.
            </p><p style="color:blue;">本节介绍如何使用mysqldump创建sql格式的转储文件。有关重新加载此类转储文件的信息，请参阅第7.4.2节“重新加载SQL格式备份”。</p><p>
            By default, <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> writes information as
            SQL statements to the standard output. You can save the output
            in a file:
        </p><p style="color:blue;">默认情况下，mysqldump将信息作为sql语句写入标准输出。您可以将输出保存在文件中：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump [<em class="replaceable"><code>arguments</code></em>] &gt; <em class="replaceable"><code>file_name</code></em></code></strong>
</pre><p>
            To dump all databases, invoke <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> with
            the <a class="link" href="programs.html#option_mysqldump_all-databases"><code class="option">--all-databases</code></a> option:
        </p><p style="color:blue;">要转储所有数据库，请使用--all databases选项调用mysqldump：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump --all-databases &gt; dump.sql</code></strong>
</pre><p>
            To dump only specific databases, name them on the command line
            and use the <a class="link" href="programs.html#option_mysqldump_databases"><code class="option">--databases</code></a>
            option:
        </p><p style="color:blue;">要仅转储特定的数据库，请在命令行中命名它们并使用--databases选项：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump --databases db1 db2 db3 &gt; dump.sql</code></strong>
</pre><p>
            The <a class="link" href="programs.html#option_mysqldump_databases"><code class="option">--databases</code></a> option causes
            all names on the command line to be treated as database names.
            Without this option, <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> treats the
            first name as a database name and those following as table
            names.
        </p><p style="color:blue;">--databases选项使命令行上的所有名称都被视为数据库名称。如果不使用此选项，mysqldump会将第一个名称视为数据库名称，将后面的名称视为表名称。</p><p>
            With <a class="link" href="programs.html#option_mysqldump_all-databases"><code class="option">--all-databases</code></a> or
            <a class="link" href="programs.html#option_mysqldump_databases"><code class="option">--databases</code></a>,
            <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> writes <a class="link" href="sql-syntax.html#create-database" title="13.1.11&nbsp;CREATE DATABASE Syntax"><code class="literal">CREATE
            DATABASE</code></a> and <a class="link" href="sql-syntax.html#use" title="13.8.4&nbsp;USE Syntax"><code class="literal">USE</code></a>
            statements prior to the dump output for each database. This
            ensures that when the dump file is reloaded, it creates each
            database if it does not exist and makes it the default database
            so database contents are loaded into the same database from
            which they came. If you want to cause the dump file to force a
            drop of each database before recreating it, use the
            <a class="link" href="programs.html#option_mysqldump_add-drop-database"><code class="option">--add-drop-database</code></a> option as
            well. In this case, <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> writes a
            <a class="link" href="sql-syntax.html#drop-database" title="13.1.22&nbsp;DROP DATABASE Syntax"><code class="literal">DROP DATABASE</code></a> statement preceding
            each <a class="link" href="sql-syntax.html#create-database" title="13.1.11&nbsp;CREATE DATABASE Syntax"><code class="literal">CREATE DATABASE</code></a> statement.
        </p><p style="color:blue;">对于--all databases或--databases，mysqldump在每个数据库的转储输出之前写入create database和use语句。这确保了当转储文件被重新加载时，它创建每个数据库，如果它不存在，并将其设为默认数据库，那么数据库内容就被加载到它们来的同一个数据库中。如果要使转储文件在重新创建之前强制删除每个数据库，也可以使用--add drop database选项。在本例中，mysqldump在每个create database语句之前写入一个drop database语句。</p><p>
            To dump a single database, name it on the command line:
        </p><p style="color:blue;">要转储单个数据库，请在命令行中命名它：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump --databases test &gt; dump.sql</code></strong>
</pre><p>
            In the single-database case, it is permissible to omit the
            <a class="link" href="programs.html#option_mysqldump_databases"><code class="option">--databases</code></a> option:
        </p><p style="color:blue;">在单个数据库的情况下，允许省略--databases选项：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump test &gt; dump.sql</code></strong>
</pre><p>
            The difference between the two preceding commands is that
            without <a class="link" href="programs.html#option_mysqldump_databases"><code class="option">--databases</code></a>, the dump
            output contains no <a class="link" href="sql-syntax.html#create-database" title="13.1.11&nbsp;CREATE DATABASE Syntax"><code class="literal">CREATE
            DATABASE</code></a> or <a class="link" href="sql-syntax.html#use" title="13.8.4&nbsp;USE Syntax"><code class="literal">USE</code></a>
            statements. This has several implications:
        </p><p style="color:blue;">前面两个命令的区别在于，如果没有--databases，转储输出就不包含create database或use语句。这有几个含义：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    When you reload the dump file, you must specify a default
                    database name so that the server knows which database to
                    reload.
                </p><p style="color:blue;">重新加载转储文件时，必须指定默认数据库名称，以便服务器知道要重新加载哪个数据库。</p></li><li class="listitem"><p>
                    For reloading, you can specify a database name different
                    from the original name, which enables you to reload the data
                    into a different database.
                </p><p style="color:blue;">对于重新加载，可以指定与原始名称不同的数据库名称，这样可以将数据重新加载到其他数据库中。</p></li><li class="listitem"><p>
                    If the database to be reloaded does not exist, you must
                    create it first.
                </p><p style="color:blue;">如果要重新加载的数据库不存在，则必须首先创建它。</p></li><li class="listitem"><p>
                    Because the output will contain no
                    <a class="link" href="sql-syntax.html#create-database" title="13.1.11&nbsp;CREATE DATABASE Syntax"><code class="literal">CREATE DATABASE</code></a> statement,
                    the <a class="link" href="programs.html#option_mysqldump_add-drop-database"><code class="option">--add-drop-database</code></a>
                    option has no effect. If you use it, it produces no
                    <a class="link" href="sql-syntax.html#drop-database" title="13.1.22&nbsp;DROP DATABASE Syntax"><code class="literal">DROP DATABASE</code></a> statement.
                </p><p style="color:blue;">由于输出将不包含CREATE DATABASE语句，--ADD DROP DATABASE选项无效。如果使用它，它不会生成DROP数据库语句。</p></li></ul>
            </div>
            <p>
                To dump only specific tables from a database, name them on the
                command line following the database name:
            </p><p style="color:blue;">要仅转储数据库中的特定表，请在命令行中按照数据库名称命名它们：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump test t1 t3 t7 &gt; dump.sql</code></strong>
</pre>
        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="reloading-sql-format-dumps"></a>7.4.2&nbsp;Reloading SQL-Format Backups</h3>

                    </div>

                </div>

            </div>
            <p>
                To reload a dump file written by <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>
                that consists of SQL statements, use it as input to the
                <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client. If the dump file was created by
                <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> with the
                <a class="link" href="programs.html#option_mysqldump_all-databases"><code class="option">--all-databases</code></a> or
                <a class="link" href="programs.html#option_mysqldump_databases"><code class="option">--databases</code></a> option, it
                contains <a class="link" href="sql-syntax.html#create-database" title="13.1.11&nbsp;CREATE DATABASE Syntax"><code class="literal">CREATE DATABASE</code></a> and
                <a class="link" href="sql-syntax.html#use" title="13.8.4&nbsp;USE Syntax"><code class="literal">USE</code></a> statements and it is not
                necessary to specify a default database into which to load the
                data:
            </p><p style="color:blue;">要重新加载mysql dump编写的包含sql语句的转储文件，请将其用作mysql客户端的输入。如果转储文件是由mysqldump使用--all databases或--databases选项创建的，则它包含create database和use语句，不必指定要将数据加载到其中的默认数据库：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysql &lt; dump.sql</code></strong>
</pre><p>
            Alternatively, from within <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a>, use a
            <code class="literal">source</code> command:
        </p><p style="color:blue;">或者，在mysql中，使用source命令：</p><pre data-lang="sql" class="programlisting">mysql&gt; <strong class="userinput"><code>source dump.sql</code></strong>
</pre><p>
            If the file is a single-database dump not containing
            <a class="link" href="sql-syntax.html#create-database" title="13.1.11&nbsp;CREATE DATABASE Syntax"><code class="literal">CREATE DATABASE</code></a> and
            <a class="link" href="sql-syntax.html#use" title="13.8.4&nbsp;USE Syntax"><code class="literal">USE</code></a> statements, create the
            database first (if necessary):
        </p><p style="color:blue;">如果文件是不包含CREATE DATABASE和USE语句的单个数据库转储，请首先创建数据库（如果需要）：</p><pre data-lang="sql" class="programlisting">shell&gt; <strong class="userinput"><code>mysqladmin create db1</code></strong>
</pre><p>
            Then specify the database name when you load the dump file:
        </p><p style="color:blue;">然后在加载转储文件时指定数据库名称：</p><pre data-lang="sql" class="programlisting">shell&gt; <strong class="userinput"><code>mysql db1 &lt; dump.sql</code></strong>
</pre><p>
            Alternatively, from within <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a>, create the
            database, select it as the default database, and load the dump
            file:
        </p><p style="color:blue;">或者，在mysql中，创建数据库，选择它作为默认数据库，并加载转储文件：</p><pre data-lang="sql" class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE DATABASE IF NOT EXISTS db1;</code></strong>
mysql&gt; <strong class="userinput"><code>USE db1;</code></strong>
mysql&gt; <strong class="userinput"><code>source dump.sql</code></strong>
</pre>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

                <div class="admon-title">
                    Note
                </div>
                <p>
                    For Windows PowerShell users: Because the "&lt;" character is
                    reserved for future use in PowerShell, an alternative approach
                    is required, such as using quotes <code class="literal">cmd.exe /c "mysql
                    &lt; dump.sql"</code>.
                </p><p style="color:blue;">对于windows powershell用户：由于“&lt;”字符是为将来在powershell中使用而保留的，因此需要另一种方法，例如使用quotes cmd.exe/c“mysql<dump.sql”。<p></dump.sql”。<p></p>
            </div>

        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="mysqldump-delimited-text"></a>7.4.3&nbsp;Dumping Data in Delimited-Text Format with mysqldump</h3>

                    </div>

                </div>

            </div>
            <p>
                This section describes how to use <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>
                to create delimited-text dump files. For information about
                reloading such dump files, see
                <a class="xref" href="backup-and-recovery.html#reloading-delimited-text-dumps" title="7.4.4&nbsp;Reloading Delimited-Text Format Backups">Section&nbsp;7.4.4, “Reloading Delimited-Text Format Backups”</a>.
            </p><p style="color:blue;">本节介绍如何使用mysqldump创建分隔文本转储文件。有关重新加载此类转储文件的信息，请参阅第7.4.4节“重新加载分隔文本格式备份”。</p><p>
            If you invoke <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> with the
            <a class="link" href="programs.html#option_mysqldump_tab"><code class="option">--tab=<em class="replaceable"><code>dir_name</code></em></code></a>
            option, it uses <em class="replaceable"><code>dir_name</code></em> as the
            output directory and dumps tables individually in that directory
            using two files for each table. The table name is the base name
            for these files. For a table named <code class="literal">t1</code>, the
            files are named <code class="filename">t1.sql</code> and
            <code class="filename">t1.txt</code>. The <code class="filename">.sql</code> file
            contains a <a class="link" href="sql-syntax.html#create-table" title="13.1.18&nbsp;CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement
            for the table. The <code class="filename">.txt</code> file contains the
            table data, one line per table row.
        </p><p style="color:blue;">如果使用--tab=dir_name选项调用mysqldump，它将使用dir_name作为输出目录，并使用每个表的两个文件分别转储该目录中的表。表名是这些文件的基名称。对于名为T1的表，文件名为T1.sql和T1.txt。.sql文件包含该表的create table语句。.txt文件包含表数据，每行一行。</p><p>
            The following command dumps the contents of the
            <code class="literal">db1</code> database to files in the
            <code class="filename">/tmp</code> database:
        </p><p style="color:blue;">以下命令将db1数据库的内容转储到/tmp数据库中的文件：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump --tab=/tmp db1</code></strong>
</pre><p>
            The <code class="filename">.txt</code> files containing table data are
            written by the server, so they are owned by the system account
            used for running the server. The server uses
            <a class="link" href="sql-syntax.html#select-into" title="13.2.9.1&nbsp;SELECT ... INTO Syntax"><code class="literal">SELECT ... INTO
                OUTFILE</code></a> to write the files, so you must have the
            <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege to perform this
            operation, and an error occurs if a given
            <code class="filename">.txt</code> file already exists.
        </p><p style="color:blue;">包含表数据的.txt文件由服务器写入，因此它们归用于运行服务器的系统帐户所有。服务器使用选择…进入文件写入文件，因此您必须具有执行此操作的文件特权，并且如果给定的.txt文件已经存在，则会发生错误。</p><p>
            The server sends the <code class="literal">CREATE</code> definitions for
            dumped tables to <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>, which writes them
            to <code class="filename">.sql</code> files. These files therefore are
            owned by the user who executes <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>.
        </p><p style="color:blue;">服务器将转储表的创建定义发送到mysqldump，mysqldump将其写入.sql文件。因此，这些文件归执行mysqldump的用户所有。</p><p>
            It is best that <a class="link" href="programs.html#option_mysqldump_tab"><code class="option">--tab</code></a> be used
            only for dumping a local server. If you use it with a remote
            server, the <a class="link" href="programs.html#option_mysqldump_tab"><code class="option">--tab</code></a> directory
            must exist on both the local and remote hosts, and the
            <code class="filename">.txt</code> files will be written by the server in
            the remote directory (on the server host), whereas the
            <code class="filename">.sql</code> files will be written by
            <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> in the local directory (on the
            client host).
        </p><p style="color:blue;">最好是--tab只用于转储本地服务器。如果使用远程服务器，则在本地主机和远程主机上都必须存在-tab目录，并且.txt文件将由远程目录（服务器主机）中的服务器编写，而.sql文件将由本地目录（客户端主机）上的MySQLDUMP编写。</p><p>
            For <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump --tab</strong></span></a>, the server by default
            writes table data to <code class="filename">.txt</code> files one line
            per row with tabs between column values, no quotation marks
            around column values, and newline as the line terminator. (These
            are the same defaults as for
            <a class="link" href="sql-syntax.html#select-into" title="13.2.9.1&nbsp;SELECT ... INTO Syntax"><code class="literal">SELECT ... INTO
                OUTFILE</code></a>.)
        </p><p style="color:blue;">对于mysqldump--tab，服务器默认情况下将表数据写入.txt文件，每行一行，列值之间有制表符，列值周围没有引号，换行符是换行符。（这些默认值与select相同…进入出口。）</p><p>
            To enable data files to be written using a different format,
            <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> supports these options:
        </p><p style="color:blue;">要使用不同格式写入数据文件，mysqldump支持以下选项：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    <a class="link" href="programs.html#option_mysqldump_fields"><code class="option">--fields-terminated-by=<em class="replaceable"><code>str</code></em></code></a>
                </p><p style="color:blue;">--以=str结尾的字段</p><p>
                    The string for separating column values (default: tab).
                </p><p style="color:blue;">用于分隔列值的字符串（默认值：tab）。</p></li><li class="listitem"><p>
                    <a class="link" href="programs.html#option_mysqldump_fields"><code class="option">--fields-enclosed-by=<em class="replaceable"><code>char</code></em></code></a>
                </p><p style="color:blue;">--由= char括起的字段</p><p>
                    The character within which to enclose column values
                    (default: no character).
                </p><p style="color:blue;">将列值括起来的字符（默认值：无字符）。</p></li><li class="listitem"><p>
                    <a class="link" href="programs.html#option_mysqldump_fields"><code class="option">--fields-optionally-enclosed-by=<em class="replaceable"><code>char</code></em></code></a>
                </p><p style="color:blue;">--可选地由=char括起的字段</p><p>
                    The character within which to enclose non-numeric column
                    values (default: no character).
                </p><p style="color:blue;">将非数值列值括起来的字符（默认值：无字符）。</p></li><li class="listitem"><p>
                    <a class="link" href="programs.html#option_mysqldump_fields"><code class="option">--fields-escaped-by=<em class="replaceable"><code>char</code></em></code></a>
                </p><p style="color:blue;">--字段转义方式=char</p><p>
                    The character for escaping special characters (default: no
                    escaping).
                </p><p style="color:blue;">用于转义特殊字符的字符（默认值：不转义）。</p></li><li class="listitem"><p>
                    <a class="link" href="programs.html#option_mysqldump_lines-terminated-by"><code class="option">--lines-terminated-by=<em class="replaceable"><code>str</code></em></code></a>
                </p><p style="color:blue;">--以=str结尾的行</p><p>
                    The line-termination string (default: newline).
                </p><p style="color:blue;">行终止字符串（默认：换行）。</p></li></ul>
            </div>
            <p>
                Depending on the value you specify for any of these options, it
                might be necessary on the command line to quote or escape the
                value appropriately for your command interpreter. Alternatively,
                specify the value using hex notation. Suppose that you want
                <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to quote column values within
                double quotation marks. To do so, specify double quote as the
                value for the
                <a class="link" href="programs.html#option_mysqldump_fields"><code class="option">--fields-enclosed-by</code></a>
                option. But this character is often special to command
                interpreters and must be treated specially. For example, on
                Unix, you can quote the double quote like this:
            </p><p style="color:blue;">根据您为这些选项中的任何一个指定的值，可能需要在命令行上引用或转义适合您的命令解释器的值。或者，使用十六进制表示法指定值。假设您希望mysqldump在双引号内引用列值。为此，请指定双引号作为选项括起的--fields的值。但这种性格往往是特殊的指挥口译员，必须特别对待。例如，在unix上，您可以这样引用双引号：</p><pre data-lang="simple" class="programlisting">--fields-enclosed-by='"'
</pre><p>
            On any platform, you can specify the value in hex:
        </p><p style="color:blue;">在任何平台上，都可以用十六进制指定值：</p><pre data-lang="simple" class="programlisting">--fields-enclosed-by=0x22
</pre><p>
            It is common to use several of the data-formatting options
            together. For example, to dump tables in comma-separated values
            format with lines terminated by carriage-return/newline pairs
            (<code class="literal">\r\n</code>), use this command (enter it on a
            single line):
        </p><p style="color:blue;">通常会同时使用多个数据格式选项。例如，要以逗号分隔值格式转储以回车/换行符对结尾的行的表（\r\n），请使用以下命令（在单行中输入）：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump --tab=/tmp --fields-terminated-by=,</code></strong>
         <strong class="userinput"><code>--fields-enclosed-by='"' --lines-terminated-by=0x0d0a db1</code></strong>
</pre><p>
            Should you use any of the data-formatting options to dump table
            data, you will need to specify the same format when you reload
            data files later, to ensure proper interpretation of the file
            contents.
        </p><p style="color:blue;">如果使用任何数据格式选项来转储表数据，则需要在以后重新加载数据文件时指定相同的格式，以确保正确解释文件内容。</p>
        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="reloading-delimited-text-dumps"></a>7.4.4&nbsp;Reloading Delimited-Text Format Backups</h3>

                    </div>

                </div>

            </div>
            <p>
                For backups produced with <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump --tab</strong></span></a>,
                each table is represented in the output directory by an
                <code class="filename">.sql</code> file containing the
                <a class="link" href="sql-syntax.html#create-table" title="13.1.18&nbsp;CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement for the
                table, and a <code class="filename">.txt</code> file containing the table
                data. To reload a table, first change location into the output
                directory. Then process the <code class="filename">.sql</code> file with
                <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> to create an empty table and process
                the <code class="filename">.txt</code> file to load the data into the
                table:
            </p><p style="color:blue;">对于使用mysqldump--tab生成的备份，每个表在输出目录中由一个包含表的create table语句的.sql文件和一个包含表数据的.txt文件表示。若要重新加载表，请首先将位置更改为输出目录。然后使用mysql处理.sql文件以创建空表，并处理.txt文件以将数据加载到表中：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysql db1 &lt; t1.sql</code></strong>
shell&gt; <strong class="userinput"><code>mysqlimport db1 t1.txt</code></strong>
</pre><p>
            An alternative to using <a class="link" href="programs.html#mysqlimport" title="4.5.5&nbsp;mysqlimport — A Data Import Program"><span class="command"><strong>mysqlimport</strong></span></a> to load
            the data file is to use the <a class="link" href="sql-syntax.html#load-data" title="13.2.6&nbsp;LOAD DATA Syntax"><code class="literal">LOAD
            DATA</code></a> statement from within the
            <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client:
        </p><p style="color:blue;">使用mysqlimport加载数据文件的另一种方法是使用mysql客户端中的load data语句：</p><pre data-lang="sql" class="programlisting">mysql&gt; <strong class="userinput"><code>USE db1;</code></strong>
mysql&gt; <strong class="userinput"><code>LOAD DATA INFILE 't1.txt' INTO TABLE t1;</code></strong>
</pre><p>
            If you used any data-formatting options with
            <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> when you initially dumped the
            table, you must use the same options with
            <a class="link" href="programs.html#mysqlimport" title="4.5.5&nbsp;mysqlimport — A Data Import Program"><span class="command"><strong>mysqlimport</strong></span></a> or <a class="link" href="sql-syntax.html#load-data" title="13.2.6&nbsp;LOAD DATA Syntax"><code class="literal">LOAD
            DATA</code></a> to ensure proper interpretation of the data file
            contents:
        </p><p style="color:blue;">如果在最初转储表时对mysqldump使用了任何数据格式选项，则必须对mysqlimport或load data使用相同的选项，以确保正确解释数据文件内容：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlimport --fields-terminated-by=,</code></strong>
         <strong class="userinput"><code>--fields-enclosed-by='"' --lines-terminated-by=0x0d0a db1 t1.txt</code></strong>
</pre><p>
            Or:
        </p><p style="color:blue;">或：</p><pre data-lang="sql" class="programlisting">mysql&gt; <strong class="userinput"><code>USE db1;</code></strong>
mysql&gt; <strong class="userinput"><code>LOAD DATA INFILE 't1.txt' INTO TABLE t1</code></strong>
       <strong class="userinput"><code>FIELDS TERMINATED BY ',' FIELDS ENCLOSED BY '"'</code></strong>
       <strong class="userinput"><code>LINES TERMINATED BY '\r\n';</code></strong>
</pre>
        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="mysqldump-tips"></a>7.4.5&nbsp;mysqldump Tips</h3>

                    </div>

                </div>

            </div>
            <div class="toc">
                <dl class="toc"><dt><span class="section"><a href="backup-and-recovery.html#mysqldump-copying-database">7.4.5.1 Making a Copy of a Database</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#mysqldump-copying-to-other-server">7.4.5.2 Copy a Database from one Server to Another</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#mysqldump-stored-programs">7.4.5.3 Dumping Stored Programs</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#mysqldump-definition-data-dumps">7.4.5.4 Dumping Table Definitions and Content Separately</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#mysqldump-upgrade-testing">7.4.5.5 Using mysqldump to Test for Upgrade Incompatibilities</a></span></dt></dl>
            </div>
            <p>
                This section surveys techniques that enable you to use
                <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to solve specific problems:
            </p><p style="color:blue;">本节介绍使用mysqldump解决特定问题的技术：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    How to make a copy a database
                </p><p style="color:blue;">如何复制数据库</p></li><li class="listitem"><p>
                    How to copy a database from one server to another
                </p><p style="color:blue;">如何将数据库从一台服务器复制到另一台服务器</p></li><li class="listitem"><p>
                    How to dump stored programs (stored procedures and
                    functions, triggers, and events)
                </p><p style="color:blue;">如何转储存储程序（存储过程和函数、触发器和事件）</p></li><li class="listitem"><p>
                    How to dump definitions and data separately
                </p><p style="color:blue;">如何分别转储定义和数据</p></li></ul>
            </div>
            <div class="section">
                <div class="titlepage">
                    <div>
                        <div>
                            <h4 class="title"><a name="mysqldump-copying-database"></a>7.4.5.1&nbsp;Making a Copy of a Database</h4>

                        </div>

                    </div>

                </div>
                <pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump db1 &gt; dump.sql</code></strong>
shell&gt; <strong class="userinput"><code>mysqladmin create db2</code></strong>
shell&gt; <strong class="userinput"><code>mysql db2 &lt; dump.sql</code></strong>
</pre><p>
                Do not use <a class="link" href="programs.html#option_mysqldump_databases"><code class="option">--databases</code></a> on
                the <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> command line because that
                causes <code class="literal">USE db1</code> to be included in the dump
                file, which overrides the effect of naming
                <code class="literal">db2</code> on the <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> command
                line.
            </p><p style="color:blue;">不要在mysql dump命令行上使用--databases，因为这会导致在转储文件中包含use db1，这会覆盖在mysql命令行上命名db2的效果。</p>
            </div>
            <div class="section">
                <div class="titlepage">
                    <div>
                        <div>
                            <h4 class="title"><a name="mysqldump-copying-to-other-server"></a>7.4.5.2&nbsp;Copy a Database from one Server to Another</h4>

                        </div>

                    </div>

                </div>
                <p>
                    On Server 1:
                </p><p style="color:blue;">在服务器1上：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump --databases db1 &gt; dump.sql</code></strong>
</pre><p>
                Copy the dump file from Server 1 to Server 2.
            </p><p style="color:blue;">将转储文件从服务器1复制到服务器2。</p><p>
                On Server 2:
            </p><p style="color:blue;">在服务器2上：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysql &lt; dump.sql</code></strong>
</pre><p>
                Use of <a class="link" href="programs.html#option_mysqldump_databases"><code class="option">--databases</code></a> with the
                <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> command line causes the dump file
                to include <a class="link" href="sql-syntax.html#create-database" title="13.1.11&nbsp;CREATE DATABASE Syntax"><code class="literal">CREATE DATABASE</code></a> and
                <a class="link" href="sql-syntax.html#use" title="13.8.4&nbsp;USE Syntax"><code class="literal">USE</code></a> statements that create the
                database if it does exist and make it the default database for
                the reloaded data.
            </p><p style="color:blue;">使用MySql DUMP命令行的数据库会使转储文件包含CREATE数据库，如果存在，则使用创建数据库的语句，并将其设置为重新加载数据的默认数据库。</p><p>
                Alternatively, you can omit
                <a class="link" href="programs.html#option_mysqldump_databases"><code class="option">--databases</code></a> from the
                <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> command. Then you will need to
                create the database on Server 2 (if necessary) and specify it
                as the default database when you reload the dump file.
            </p><p style="color:blue;">或者，可以从mysqldump命令中省略--databases。然后需要在服务器2上创建数据库（如果需要），并在重新加载转储文件时将其指定为默认数据库。</p><p>
                On Server 1:
            </p><p style="color:blue;">在服务器1上：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump db1 &gt; dump.sql</code></strong>
</pre><p>
                On Server 2:
            </p><p style="color:blue;">在服务器2上：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqladmin create db1</code></strong>
shell&gt; <strong class="userinput"><code>mysql db1 &lt; dump.sql</code></strong>
</pre><p>
                You can specify a different database name in this case, so
                omitting <a class="link" href="programs.html#option_mysqldump_databases"><code class="option">--databases</code></a> from
                the <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> command enables you to dump
                data from one database and load it into another.
            </p><p style="color:blue;">在这种情况下，您可以指定不同的数据库名称，因此从mysqldump命令中省略--databases可以使您从一个数据库转储数据并将其加载到另一个数据库中。</p>
            </div>
            <div class="section">
                <div class="titlepage">
                    <div>
                        <div>
                            <h4 class="title"><a name="mysqldump-stored-programs"></a>7.4.5.3&nbsp;Dumping Stored Programs</h4>

                        </div>

                    </div>

                </div>
                <p>
                    Several options control how <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>
                    handles stored programs (stored procedures and functions,
                    triggers, and events):
                </p><p style="color:blue;">有几个选项控制mysqldump如何处理存储程序（存储过程和函数、触发器和事件）：</p>
                <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                        <a class="link" href="programs.html#option_mysqldump_events"><code class="option">--events</code></a>: Dump Event
                        Scheduler events
                    </p><p style="color:blue;">--事件：转储事件计划程序事件</p></li><li class="listitem"><p>
                        <a class="link" href="programs.html#option_mysqldump_routines"><code class="option">--routines</code></a>: Dump stored
                        procedures and functions
                    </p><p style="color:blue;">--例程：转储存储过程和函数</p></li><li class="listitem"><p>
                        <a class="link" href="programs.html#option_mysqldump_triggers"><code class="option">--triggers</code></a>: Dump
                        triggers for tables
                    </p><p style="color:blue;">--触发器：表的转储触发器</p></li></ul>
                </div>
                <p>
                    The <a class="link" href="programs.html#option_mysqldump_triggers"><code class="option">--triggers</code></a> option is
                    enabled by default so that when tables are dumped, they are
                    accompanied by any triggers they have. The other options are
                    disabled by default and must be specified explicitly to dump
                    the corresponding objects. To disable any of these options
                    explicitly, use its skip form:
                    <a class="link" href="programs.html#option_mysqldump_events"><code class="option">--skip-events</code></a>,
                    <a class="link" href="programs.html#option_mysqldump_routines"><code class="option">--skip-routines</code></a>,
                    or
                    <a class="link" href="programs.html#option_mysqldump_triggers"><code class="option">--skip-triggers</code></a>.
                </p><p style="color:blue;">默认情况下，--triggers选项是启用的，这样当表被转储时，它们会伴随着它们拥有的任何触发器。默认情况下，其他选项被禁用，必须显式指定才能转储相应的对象。要显式禁用这些选项中的任何一个，请使用其跳过形式：--跳过事件，--跳过例程，或--skip触发器。</p>
            </div>
            <div class="section">
                <div class="titlepage">
                    <div>
                        <div>
                            <h4 class="title"><a name="mysqldump-definition-data-dumps"></a>7.4.5.4&nbsp;Dumping Table Definitions and Content Separately</h4>

                        </div>

                    </div>

                </div>
                <p>
                    The <a class="link" href="programs.html#option_mysqldump_no-data"><code class="option">--no-data</code></a> option tells
                    <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> not to dump table data, resulting
                    in the dump file containing only statements to create the
                    tables. Conversely, the
                    <a class="link" href="programs.html#option_mysqldump_no-create-info"><code class="option">--no-create-info</code></a> option
                    tells <a class="link" href="programs.html#mysqldump" title="4.5.4&nbsp;mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to suppress
                    <code class="literal">CREATE</code> statements from the output, so that
                    the dump file contains only table data.
                </p><p style="color:blue;">--no data选项告诉mysqldump不要转储表数据，导致转储文件只包含创建表的语句。相反，--no create info选项告诉mysqldump禁止从输出中创建语句，以便转储文件只包含表数据。</p><p>
                For example, to dump table definitions and data separately for
                the <code class="literal">test</code> database, use these commands:
            </p><p style="color:blue;">例如，要分别转储测试数据库的表定义和数据，请使用以下命令：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump --no-data test &gt; dump-defs.sql</code></strong>
shell&gt; <strong class="userinput"><code>mysqldump --no-create-info test &gt; dump-data.sql</code></strong>
</pre><p>
                For a definition-only dump, add the
                <a class="link" href="programs.html#option_mysqldump_routines"><code class="option">--routines</code></a>
                and
                <a class="link" href="programs.html#option_mysqldump_events"><code class="option">--events</code></a>
                options to also include stored routine and event definitions:
            </p><p style="color:blue;">对于仅限定义的转储，添加--routines和--events选项以同时包括存储的例程和事件定义：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump --no-data --routines --events test &gt; dump-defs.sql</code></strong>
</pre>
            </div>
            <div class="section">
                <div class="titlepage">
                    <div>
                        <div>
                            <h4 class="title"><a name="mysqldump-upgrade-testing"></a>7.4.5.5&nbsp;Using mysqldump to Test for Upgrade Incompatibilities</h4>

                        </div>

                    </div>

                </div>
                <p>
                    When contemplating a MySQL upgrade, it is prudent to install
                    the newer version separately from your current production
                    version. Then you can dump the database and database object
                    definitions from the production server and load them into the
                    new server to verify that they are handled properly. (This is
                    also useful for testing downgrades.)
                </p><p style="color:blue;">在考虑mysql升级时，谨慎的做法是将新版本与当前生产版本分开安装。然后，可以从生产服务器转储数据库和数据库对象定义，并将它们加载到新服务器中，以验证是否正确处理了它们。（这对于测试降级也很有用。）</p><p>
                On the production server:
            </p><p style="color:blue;">在生产服务器上：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump --all-databases --no-data --routines --events &gt; dump-defs.sql</code></strong>
</pre><p>
                On the upgraded server:
            </p><p style="color:blue;">在升级的服务器上：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysql &lt; dump-defs.sql</code></strong>
</pre><p>
                Because the dump file does not contain table data, it can be
                processed quickly. This enables you to spot potential
                incompatibilities without waiting for lengthy data-loading
                operations. Look for warnings or errors while the dump file is
                being processed.
            </p><p style="color:blue;">由于转储文件不包含表数据，因此可以快速处理。这使您能够发现潜在的不兼容性，而无需等待冗长的数据加载操作。在处理转储文件时查找警告或错误。</p><p>
                After you have verified that the definitions are handled
                properly, dump the data and try to load it into the upgraded
                server.
            </p><p style="color:blue;">验证定义处理正确后，转储数据并尝试将其加载到升级的服务器中。</p><p>
                On the production server:
            </p><p style="color:blue;">在生产服务器上：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqldump --all-databases --no-create-info &gt; dump-data.sql</code></strong>
</pre><p>
                On the upgraded server:
            </p><p style="color:blue;">在升级的服务器上：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysql &lt; dump-data.sql</code></strong>
</pre><p>
                Now check the table contents and run some test queries.
            </p><p style="color:blue;">现在检查表内容并运行一些测试查询。</p>
            </div>

        </div>

    </div>
    <div class="section">
        <div class="titlepage">
            <div>
                <div>
                    <h2 class="title" style="clear: both"><a name="point-in-time-recovery"></a>7.5&nbsp;Point-in-Time (Incremental) Recovery Using the Binary Log</h2>

                </div>

            </div>

        </div>
        <div class="toc">
            <dl class="toc"><dt><span class="section"><a href="backup-and-recovery.html#point-in-time-recovery-times">7.5.1 Point-in-Time Recovery Using Event Times</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#point-in-time-recovery-positions">7.5.2 Point-in-Time Recovery Using Event Positions</a></span></dt></dl>
        </div>
        <a class="indexterm" name="idm140286876596144"></a><a class="indexterm" name="idm140286876595104"></a><a class="indexterm" name="idm140286876593616"></a><a class="indexterm" name="idm140286876592544"></a><p>
        Point-in-time recovery refers to recovery of data changes made
        since a given point in time. Typically, this type of recovery is
        performed after restoring a full backup that brings the server to
        its state as of the time the backup was made. (The full backup can
        be made in several ways, such as those listed in
        <a class="xref" href="backup-and-recovery.html#backup-methods" title="7.2&nbsp;Database Backup Methods">Section&nbsp;7.2, “Database Backup Methods”</a>.) Point-in-time recovery then
        brings the server up to date incrementally from the time of the
        full backup to a more recent time.
    </p><p style="color:blue;">时间点恢复是指恢复自给定时间点以来所做的数据更改。通常，这种类型的恢复是在还原完整备份（使服务器恢复到备份时的状态）之后执行的。（完全备份可以通过多种方式进行，如第7.2节“数据库备份方法”中所列的方式）时间点恢复然后将服务器从完全备份的时间增量更新到最近的时间。</p>
        <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

            <div class="admon-title">
                Note
            </div>
            <p>
                Many of the examples here use the <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a>
                client to process binary log output produced by
                <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a>. If your binary log contains
                <code class="literal">\0</code> (null) characters, that output cannot be
                parsed by <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> unless you invoke it with the
                <a class="link" href="programs.html#option_mysql_binary-mode"><code class="option">--binary-mode</code></a> option.
            </p><p style="color:blue;">这里的许多示例使用mysql客户机处理mysqlbinlog生成的二进制日志输出。如果二进制日志包含\0（空）字符，则mysql无法分析该输出，除非使用--binary mode选项调用它。</p>
        </div>
        <p>
            Point-in-time recovery is based on these principles:
        </p><p style="color:blue;">时间点恢复基于以下原则：</p>
        <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                The source of information for point-in-time recovery is the
                set of incremental backups represented by the binary log files
                generated subsequent to the full backup operation. Therefore,
                the server must be started with the
                <a class="link" href="replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a> option to enable
                binary logging (see <a class="xref" href="server-administration.html#binary-log" title="5.4.4&nbsp;The Binary Log">Section&nbsp;5.4.4, “The Binary Log”</a>).
            </p><p style="color:blue;">时间点恢复的信息源是由完整备份操作后生成的二进制日志文件表示的增量备份集。因此，必须使用--log bin选项启动服务器，以启用二进制日志记录（请参阅第5.4.4节“二进制日志”）。</p><p>
                To restore data from the binary log, you must know the name
                and location of the current binary log files. By default, the
                server creates binary log files in the data directory, but a
                path name can be specified with the
                <a class="link" href="replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a> option to place the
                files in a different location. <a class="xref" href="server-administration.html#binary-log" title="5.4.4&nbsp;The Binary Log">Section&nbsp;5.4.4, “The Binary Log”</a>.
            </p><p style="color:blue;">要从二进制日志还原数据，必须知道当前二进制日志文件的名称和位置。默认情况下，服务器在数据目录中创建二进制日志文件，但可以使用--log bin选项指定路径名，以将文件放置在其他位置。第5.4.4节，“二进制日志”。</p><p>
                To see a listing of all binary log files, use this statement:
            </p><p style="color:blue;">要查看所有二进制日志文件的列表，请使用以下语句：</p><pre data-lang="sql" class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW BINARY LOGS;</code></strong>
</pre><p>
                To determine the name of the current binary log file, issue
                the following statement:
            </p><p style="color:blue;">要确定当前二进制日志文件的名称，请发出以下语句：</p><pre data-lang="sql" class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW MASTER STATUS;</code></strong>
</pre></li><li class="listitem"><p>
                The <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> utility converts the events
                in the binary log files from binary format to text so that
                they can be executed or viewed. <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a>
                has options for selecting sections of the binary log based on
                event times or position of events within the log. See
                <a class="xref" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files">Section&nbsp;4.6.7, “<span class="command"><strong>mysqlbinlog</strong></span> — Utility for Processing Binary Log Files”</a>.
            </p><p style="color:blue;">mysqlbinlog实用程序将二进制日志文件中的事件从二进制格式转换为文本，以便执行或查看它们。mysqlbinlog具有根据事件时间或事件在日志中的位置选择二进制日志部分的选项。参见4.6.7节，“mysqlbinlog-处理二进制日志文件的实用程序”。</p></li><li class="listitem"><p>
                Executing events from the binary log causes the data
                modifications they represent to be redone. This enables
                recovery of data changes for a given span of time. To execute
                events from the binary log, process
                <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> output using the
                <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client:
            </p><p style="color:blue;">从二进制日志执行事件会导致重做它们所表示的数据修改。这允许在给定的时间范围内恢复数据更改。要从二进制日志执行事件，请使用mysql客户端处理mysqlbinlog输出：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog <em class="replaceable"><code>binlog_files</code></em> | mysql -u root -p</code></strong>
</pre></li><li class="listitem"><p>
                Viewing log contents can be useful when you need to determine
                event times or positions to select partial log contents prior
                to executing events. To view events from the log, send
                <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> output into a paging program:
            </p><p style="color:blue;">当需要在执行事件之前确定事件时间或位置以选择部分日志内容时，查看日志内容非常有用。要查看日志中的事件，请将mysqlbinlog输出发送到分页程序：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog <em class="replaceable"><code>binlog_files</code></em> | more</code></strong>
</pre><p>
                Alternatively, save the output in a file and view the file in
                a text editor:
            </p><p style="color:blue;">或者，将输出保存在文件中，并在文本编辑器中查看该文件：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog <em class="replaceable"><code>binlog_files</code></em> &gt; tmpfile</code></strong>
shell&gt; ... <em class="replaceable"><code>edit tmpfile</code></em> ...
</pre></li><li class="listitem"><p>
                Saving the output in a file is useful as a preliminary to
                executing the log contents with certain events removed, such
                as an accidental <a class="link" href="sql-syntax.html#drop-database" title="13.1.22&nbsp;DROP DATABASE Syntax"><code class="literal">DROP DATABASE</code></a>.
                You can delete from the file any statements not to be executed
                before executing its contents. After editing the file, execute
                the contents as follows:
            </p><p style="color:blue;">将输出保存在文件中对于在删除某些事件（例如意外删除数据库）的情况下执行日志内容是非常有用的。您可以从文件中删除在执行其内容之前不执行的任何语句。编辑文件后，执行以下内容：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u root -p &lt; tmpfile</code></strong>
</pre></li></ul>
        </div>
        <p>
            If you have more than one binary log to execute on the MySQL
            server, the safe method is to process them all using a single
            connection to the server. Here is an example that demonstrates
            what may be <span class="emphasis"><em>unsafe</em></span>:
        </p><p style="color:blue;">如果要在mysql服务器上执行多个二进制日志，安全的方法是使用到服务器的单个连接来处理所有日志。下面是一个示例，演示了哪些是不安全的：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog binlog.000001 | mysql -u root -p # DANGER!!</code></strong>
shell&gt; <strong class="userinput"><code>mysqlbinlog binlog.000002 | mysql -u root -p # DANGER!!</code></strong>
</pre><p>
        Processing binary logs this way using different connections to the
        server causes problems if the first log file contains a
        <a class="link" href="sql-syntax.html#create-table" title="13.1.18&nbsp;CREATE TABLE Syntax"><code class="literal">CREATE TEMPORARY
            TABLE</code></a> statement and the second log contains a statement
        that uses the temporary table. When the first
        <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> process terminates, the server drops the
        temporary table. When the second <a class="link" href="programs.html#mysql" title="4.5.1&nbsp;mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> process
        attempts to use the table, the server reports <span class="quote">“<span class="quote">unknown
      table.</span>”</span>
    </p><p style="color:blue;">如果第一个日志文件包含create temporary table语句，而第二个日志包含使用临时表的语句，则使用与服务器不同的连接以这种方式处理二进制日志会导致问题。当第一个mysql进程终止时，服务器将删除临时表。当第二个mysql进程尝试使用该表时，服务器将报告“unknown table”。</p><p>
        To avoid problems like this, use a <span class="emphasis"><em>single</em></span>
        connection to execute the contents of all binary logs that you
        want to process. Here is one way to do so:
    </p><p style="color:blue;">若要避免此类问题，请使用单个连接来执行要处理的所有二进制日志的内容。有一种方法：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog binlog.000001 binlog.000002 | mysql -u root -p</code></strong>
</pre><p>
        Another approach is to write all the logs to a single file and
        then process the file:
    </p><p style="color:blue;">另一种方法是将所有日志写入一个文件，然后处理该文件：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog binlog.000001 &gt;  /tmp/statements.sql</code></strong>
shell&gt; <strong class="userinput"><code>mysqlbinlog binlog.000002 &gt;&gt; /tmp/statements.sql</code></strong>
shell&gt; <strong class="userinput"><code>mysql -u root -p -e "source /tmp/statements.sql"</code></strong>
</pre><p>
        When writing to a dump file while reading back from a binary log
        containing GTIDs (see <a class="xref" href="replication.html#replication-gtids" title="16.1.3&nbsp;Replication with Global Transaction Identifiers">Section&nbsp;16.1.3, “Replication with Global Transaction Identifiers”</a>), use
        the <a class="link" href="programs.html#option_mysqlbinlog_skip-gtids"><code class="option">--skip-gtids</code></a> option with
        <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a>, like this:
    </p><p style="color:blue;">在从包含gtid的二进制日志中读取数据时写入转储文件（请参阅16.1.3节，“使用全局事务标识符复制”）时，将--skip gtids选项与mysqlbinlog一起使用，如下所示：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog --skip-gtids binlog.000001 &gt;  /tmp/dump.sql</code></strong>
shell&gt; <strong class="userinput"><code>mysqlbinlog --skip-gtids binlog.000002 &gt;&gt; /tmp/dump.sql</code></strong>
shell&gt; <strong class="userinput"><code>mysql -u root -p -e "source /tmp/dump.sql"</code></strong>
</pre>
        <div class="section">

            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="point-in-time-recovery-times"></a>7.5.1&nbsp;Point-in-Time Recovery Using Event Times</h3>
                    </div>
                </div>
            </div>
            <p>
                To indicate the start and end times for recovery, specify the
                <a class="link" href="programs.html#option_mysqlbinlog_start-datetime"><code class="option">--start-datetime</code></a> and
                <a class="link" href="programs.html#option_mysqlbinlog_stop-datetime"><code class="option">--stop-datetime</code></a> options for
                <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a>, in
                <a class="link" href="data-types.html#datetime" title="11.3.1&nbsp;The DATE, DATETIME, and TIMESTAMP Types"><code class="literal">DATETIME</code></a> format. As an example,
                suppose that exactly at 10:00 a.m. on April 20, 2005 an SQL
                statement was executed that deleted a large table. To restore
                the table and data, you could restore the previous night's
                backup, and then execute the following command:
            </p><p style="color:blue;">要指示恢复的开始和结束时间，请以datetime格式为mysqlbinlog指定--start datetime和--stop datetime选项。例如，假设在2005年4月20日上午10:00执行了一条删除了一个大表的sql语句。要还原表和数据，可以还原前一天晚上的备份，然后执行以下命令：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog --stop-datetime="2005-04-20 9:59:59" \</code></strong>
         <strong class="userinput"><code>/var/log/mysql/bin.123456 | mysql -u root -p</code></strong>
</pre><p>
            This command recovers all of the data up until the date and time
            given by the <a class="link" href="programs.html#option_mysqlbinlog_stop-datetime"><code class="option">--stop-datetime</code></a>
            option. If you did not detect the erroneous SQL statement that
            was entered until hours later, you will probably also want to
            recover the activity that occurred afterward. Based on this, you
            could run <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> again with a start date
            and time, like so:
        </p><p style="color:blue;">此命令将恢复所有数据，直到--stop date time选项指定的日期和时间为止。如果直到数小时后才检测到输入的错误sql语句，则可能还需要恢复随后发生的活动。基于此，您可以使用开始日期和时间再次运行mysqlbinlog，如下所示：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog --start-datetime="2005-04-20 10:01:00" \</code></strong>
         <strong class="userinput"><code>/var/log/mysql/bin.123456 | mysql -u root -p</code></strong>
</pre><p>
            In this command, the SQL statements logged from 10:01 a.m. on
            will be re-executed. The combination of restoring of the
            previous night's dump file and the two
            <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> commands restores everything up
            until one second before 10:00 a.m. and everything from 10:01
            a.m. on.
        </p><p style="color:blue;">在此命令中，将重新执行从上午10:01开始记录的SQL语句。恢复前一天晚上的转储文件和两个mysqlbinlog命令的组合可以将所有内容恢复到上午10:00之前的一秒钟，并从上午10:01开始恢复所有内容。</p><p>
            To use this method of point-in-time recovery, you should examine
            the log to be sure of the exact times to specify for the
            commands. To display the log file contents without executing
            them, use this command:
        </p><p style="color:blue;">要使用这种时间点恢复方法，您应该检查日志以确保为命令指定的准确时间。要显示日志文件内容而不执行它们，请使用以下命令：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog /var/log/mysql/bin.123456 &gt; /tmp/mysql_restore.sql</code></strong>
</pre><p>
            Then open the <code class="filename">/tmp/mysql_restore.sql</code> file
            with a text editor to examine it.
        </p><p style="color:blue;">然后用文本编辑器打开/tmp/mysql_restore.sql文件进行检查。</p><p>
            Excluding specific changes by specifying times for
            <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> does not work well if multiple
            statements executed at the same time as the one to be excluded.
        </p><p style="color:blue;">如果多个语句与要排除的语句同时执行，则通过指定mysqlbinlog的时间来排除特定更改将不起作用。</p>
        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="point-in-time-recovery-positions"></a>7.5.2&nbsp;Point-in-Time Recovery Using Event Positions</h3>

                    </div>

                </div>

            </div>
            <p>
                Instead of specifying dates and times, the
                <a class="link" href="programs.html#option_mysqlbinlog_start-position"><code class="option">--start-position</code></a> and
                <a class="link" href="programs.html#option_mysqlbinlog_stop-position"><code class="option">--stop-position</code></a> options for
                <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> can be used for specifying log
                positions. They work the same as the start and stop date
                options, except that you specify log position numbers rather
                than dates. Using positions may enable you to be more precise
                about which part of the log to recover, especially if many
                transactions occurred around the same time as a damaging SQL
                statement. To determine the position numbers, run
                <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> for a range of times near the
                time when the unwanted transaction was executed, but redirect
                the results to a text file for examination. This can be done
                like so:
            </p><p style="color:blue;">mysqlbinlog的--start position和--stop position选项可用于指定日志位置，而不是指定日期和时间。它们的工作方式与“开始日期”和“停止日期”选项相同，只是您指定的是日志位置编号，而不是日期。使用positions可以更精确地确定要恢复日志的哪个部分，特别是在许多事务与一个损坏的sql语句同时发生的情况下。要确定位置号，请在执行不需要的事务的时间附近运行mysqlbinlog一段时间，但将结果重定向到文本文件进行检查。可以这样做：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog --start-datetime="2005-04-20 9:55:00" \</code></strong>
         <strong class="userinput"><code>--stop-datetime="2005-04-20 10:05:00" \</code></strong>
         <strong class="userinput"><code>/var/log/mysql/bin.123456 &gt; /tmp/mysql_restore.sql</code></strong>
</pre><p>
            This command creates a small text file in the
            <code class="filename">/tmp</code> directory that contains the SQL
            statements around the time that the deleterious SQL statement
            was executed. Open this file with a text editor and look for the
            statement that you do not want to repeat. Determine the
            positions in the binary log for stopping and resuming the
            recovery and make note of them. Positions are labeled as
            <code class="literal">log_pos</code> followed by a number. After restoring
            the previous backup file, use the position numbers to process
            the binary log file. For example, you would use commands
            something like these:
        </p><p style="color:blue;">此命令在/tmp目录中创建一个小文本文件，其中包含执行有害sql语句前后的sql语句。使用文本编辑器打开此文件，并查找不想重复的语句。确定二进制日志中停止和恢复恢复的位置，并记录下来。位置标记为日志位置，后跟一个数字。还原上一个备份文件后，使用位置号处理二进制日志文件。例如，您可以使用如下命令：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysqlbinlog --stop-position=368312 /var/log/mysql/bin.123456 \</code></strong>
         <strong class="userinput"><code>| mysql -u root -p</code></strong>

shell&gt; <strong class="userinput"><code>mysqlbinlog --start-position=368315 /var/log/mysql/bin.123456 \</code></strong>
         <strong class="userinput"><code>| mysql -u root -p</code></strong>
</pre><p>
            The first command recovers all the transactions up until the
            stop position given. The second command recovers all
            transactions from the starting position given until the end of
            the binary log. Because the output of
            <a class="link" href="programs.html#mysqlbinlog" title="4.6.7&nbsp;mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> includes <code class="literal">SET
            TIMESTAMP</code> statements before each SQL statement
            recorded, the recovered data and related MySQL logs will reflect
            the original times at which the transactions were executed.
        </p><p style="color:blue;">第一个命令恢复所有事务，直到给出停止位置。第二个命令从给定的起始位置恢复所有事务，直到二进制日志结束。由于mysqlbinlog的输出包括记录每个sql语句之前的set timestamp语句，因此恢复的数据和相关的mysql日志将反映事务执行的原始时间。</p>
        </div>

    </div>
    <div class="section">
        <div class="titlepage">
            <div>
                <div>
                    <h2 class="title" style="clear: both"><a name="myisam-table-maintenance"></a>7.6&nbsp;MyISAM Table Maintenance and Crash Recovery</h2>

                </div>

            </div>

        </div>
        <div class="toc">
            <dl class="toc"><dt><span class="section"><a href="backup-and-recovery.html#myisam-crash-recovery">7.6.1 Using myisamchk for Crash Recovery</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#myisam-check">7.6.2 How to Check MyISAM Tables for Errors</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#myisam-repair">7.6.3 How to Repair MyISAM Tables</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#myisam-optimization">7.6.4 MyISAM Table Optimization</a></span></dt><dt><span class="section"><a href="backup-and-recovery.html#myisam-maintenance-schedule">7.6.5 Setting Up a MyISAM Table Maintenance Schedule</a></span></dt></dl>
        </div>
        <p>
            This section discusses how to use <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to
            check or repair <code class="literal">MyISAM</code> tables (tables that have
            <code class="filename">.MYD</code> and <code class="filename">.MYI</code> files for
            storing data and indexes). For general
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> background, see
            <a class="xref" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility">Section&nbsp;4.6.3, “<span class="command"><strong>myisamchk</strong></span> — MyISAM Table-Maintenance Utility”</a>. Other table-repair information can be
            found at <a class="xref" href="installing.html#rebuilding-tables" title="2.11.12&nbsp;Rebuilding or Repairing Tables or Indexes">Section&nbsp;2.11.12, “Rebuilding or Repairing Tables or Indexes”</a>.
        </p><p style="color:blue;">本节讨论如何使用myisamchk检查或修复myisam表（包含用于存储数据和索引的.myd和.myi文件的表）。有关myisamchk的一般背景，请参阅第4.6.3节“myisamchk-myisam表维护实用程序”。其他表修复信息见第2.11.12节“重建或修复表或索引”。</p><p>
        You can use <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to check, repair, or
        optimize database tables. The following sections describe how to
        perform these operations and how to set up a table maintenance
        schedule. For information about using <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>
        to get information about your tables, see
        <a class="xref" href="programs.html#myisamchk-table-info" title="4.6.3.5&nbsp;Obtaining Table Information with myisamchk">Section&nbsp;4.6.3.5, “Obtaining Table Information with myisamchk”</a>.
    </p><p style="color:blue;">您可以使用myisamchk检查、修复或优化数据库表。以下各节介绍如何执行这些操作以及如何设置表维护计划。有关使用myisamchk获取表信息的信息，请参阅第4.6.3.5节“使用myisamchk获取表信息”。</p><p>
        Even though table repair with <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> is
        quite secure, it is always a good idea to make a backup
        <span class="emphasis"><em>before</em></span> doing a repair or any maintenance
        operation that could make a lot of changes to a table.
    </p><p style="color:blue;">尽管使用myisamchk进行表修复是非常安全的，但在进行修复或任何可能对表进行大量更改的维护操作之前，最好先进行备份。</p><p>
        <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> operations that affect indexes can
        cause <code class="literal">MyISAM</code> <code class="literal">FULLTEXT</code>
        indexes to be rebuilt with full-text parameters that are
        incompatible with the values used by the MySQL server. To avoid
        this problem, follow the guidelines in
        <a class="xref" href="programs.html#myisamchk-general-options" title="4.6.3.1&nbsp;myisamchk General Options">Section&nbsp;4.6.3.1, “myisamchk General Options”</a>.
    </p><p style="color:blue;">影响索引的myisamchk操作会导致myisam全文索引使用与mysql服务器使用的值不兼容的全文参数重建。若要避免此问题，请遵循第4.6.3.1节“Myisamchk一般选项”中的指南。</p><p>
        <code class="literal">MyISAM</code> table maintenance can also be done using
        the SQL statements that perform operations similar to what
        <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> can do:
    </p><p style="color:blue;">myisam表维护也可以使用执行类似于myisamchk的操作的sql语句来完成：</p>
        <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                To check <code class="literal">MyISAM</code> tables, use
                <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2&nbsp;CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a>.
            </p><p style="color:blue;">要检查myisam表，请使用check table。</p></li><li class="listitem"><p>
                To repair <code class="literal">MyISAM</code> tables, use
                <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5&nbsp;REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>.
            </p><p style="color:blue;">要修复myisam表，请使用repair table。</p></li><li class="listitem"><p>
                To optimize <code class="literal">MyISAM</code> tables, use
                <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4&nbsp;OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>.
            </p><p style="color:blue;">要优化myisam表，请使用optimize table。</p></li><li class="listitem"><p>
                To analyze <code class="literal">MyISAM</code> tables, use
                <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1&nbsp;ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>.
            </p><p style="color:blue;">要分析myisam表，请使用analyze table。</p></li></ul>
        </div>
        <p>
            For additional information about these statements, see
            <a class="xref" href="sql-syntax.html#table-maintenance-sql" title="13.7.2&nbsp;Table Maintenance Statements">Section&nbsp;13.7.2, “Table Maintenance Statements”</a>.
        </p><p style="color:blue;">有关这些报表的更多信息，请参见第13.7.2节“表维护报表”。</p><p>
        These statements can be used directly or by means of the
        <a class="link" href="programs.html#mysqlcheck" title="4.5.3&nbsp;mysqlcheck — A Table Maintenance Program"><span class="command"><strong>mysqlcheck</strong></span></a> client program. One advantage of
        these statements over <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> is that the
        server does all the work. With <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>, you
        must make sure that the server does not use the tables at the same
        time so that there is no unwanted interaction between
        <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> and the server.
    </p><p style="color:blue;">这些语句可以直接使用，也可以通过mysqlcheck客户端程序使用。与myisamchk相比，这些语句的一个优点是服务器完成所有工作。使用myisamchk时，必须确保服务器不会同时使用这些表，以便myisamchk和服务器之间没有不必要的交互。</p>
        <div class="section">

            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="myisam-crash-recovery"></a>7.6.1&nbsp;Using myisamchk for Crash Recovery</h3>
                    </div>
                </div>
            </div>
            <a class="indexterm" name="idm140286876450080"></a><a class="indexterm" name="idm140286876448624"></a><a class="indexterm" name="idm140286876447136"></a><a class="indexterm" name="idm140286876446064"></a><p>
            This section describes how to check for and deal with data
            corruption in MySQL databases. If your tables become corrupted
            frequently, you should try to find the reason why. See
            <a class="xref" href="error-handling.html#crashing" title="B.4.3.3&nbsp;What to Do If MySQL Keeps Crashing">Section&nbsp;B.4.3.3, “What to Do If MySQL Keeps Crashing”</a>.
        </p><p style="color:blue;">本节介绍如何检查和处理mysql数据库中的数据损坏。如果您的表经常损坏，您应该尝试找出原因。请参阅B.4.3.3节，“如果MySQL不断崩溃该怎么办”。</p><p>
            For an explanation of how <code class="literal">MyISAM</code> tables can
            become corrupted, see <a class="xref" href="storage-engines.html#myisam-table-problems" title="15.2.4&nbsp;MyISAM Table Problems">Section&nbsp;15.2.4, “MyISAM Table Problems”</a>.
        </p><p style="color:blue;">有关myisam表如何损坏的解释，请参阅15.2.4节“myisam表问题”。</p><p>
            If you run <a class="link" href="programs.html#mysqld" title="4.3.1&nbsp;mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with external locking
            disabled (which is the default), you cannot reliably use
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to check a table when
            <a class="link" href="programs.html#mysqld" title="4.3.1&nbsp;mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is using the same table. If you can be
            certain that no one will access the tables through
            <a class="link" href="programs.html#mysqld" title="4.3.1&nbsp;mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> while you run
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>, you only have to execute
            <a class="link" href="programs.html#mysqladmin" title="4.5.2&nbsp;mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin flush-tables</strong></span></a> before you start
            checking the tables. If you cannot guarantee this, you must stop
            <a class="link" href="programs.html#mysqld" title="4.3.1&nbsp;mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> while you check the tables. If you run
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to check tables that
            <a class="link" href="programs.html#mysqld" title="4.3.1&nbsp;mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is updating at the same time, you may
            get a warning that a table is corrupt even when it is not.
        </p><p style="color:blue;">如果在禁用外部锁定（这是默认设置）的情况下运行mysqld，则当mysqld使用同一个表时，不能可靠地使用myisamchk检查表。如果可以确定在运行myisamchk时没有人会通过mysqld访问这些表，那么在开始检查这些表之前，只需执行mysqladmin flush tables。如果您不能保证这一点，那么您必须在检查表时停止mysqld。如果运行myisamchk来检查mysqld同时更新的表，则可能会收到一个警告，即一个表已损坏，即使它没有损坏。</p><p>
            If the server is run with external locking enabled, you can use
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to check tables at any time. In
            this case, if the server tries to update a table that
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> is using, the server will wait for
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to finish before it continues.
        </p><p style="color:blue;">如果服务器在启用外部锁定的情况下运行，则可以随时使用myisamchk检查表。在这种情况下，如果服务器试图更新myisamchk正在使用的表，则服务器将等待myisamchk完成后再继续。</p><p>
            If you use <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to repair or optimize
            tables, you <span class="emphasis"><em>must</em></span> always ensure that the
            <a class="link" href="programs.html#mysqld" title="4.3.1&nbsp;mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server is not using the table (this
            also applies if external locking is disabled). If you do not
            stop <a class="link" href="programs.html#mysqld" title="4.3.1&nbsp;mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>, you should at least do a
            <a class="link" href="programs.html#mysqladmin" title="4.5.2&nbsp;mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin flush-tables</strong></span></a> before you run
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>. Your tables <span class="emphasis"><em>may become
        corrupted</em></span> if the server and
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> access the tables simultaneously.
        </p><p style="color:blue;">如果使用myisamchk修复或优化表，则必须始终确保mysqld服务器不使用该表（如果禁用了外部锁定，这也适用）。如果不停止mysqld，至少应该在运行myisamchk之前执行mysqladmin刷新表。如果服务器和myisamchk同时访问表，则您的表可能会损坏。</p><p>
            When performing crash recovery, it is important to understand
            that each <code class="literal">MyISAM</code> table
            <em class="replaceable"><code>tbl_name</code></em> in a database corresponds to
            the three files in the database directory shown in the following
            table.
        </p><p style="color:blue;">执行崩溃恢复时，必须了解数据库中的每个myisam表tbl_名称都对应于下表所示的数据库目录中的三个文件。</p>
            <div class="informaltable">
                <table summary="The three files in the database directory that correspond to each MyISAM table."><colgroup><col width="20%"><col width="40%"></colgroup><thead><tr>
                    <th scope="col">File</th>
                    <th scope="col">Purpose</th>
                </tr></thead><tbody><tr>
                    <td scope="row"><code class="filename"><em class="replaceable"><code>tbl_name</code></em>.frm</code></td>
                    <td>Definition (format) file</td>
                </tr><tr>
                    <td scope="row"><code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYD</code></td>
                    <td>Data file</td>
                </tr><tr>
                    <td scope="row"><code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYI</code></td>
                    <td>Index file</td>
                </tr></tbody></table>
            </div>
            <p>
                Each of these three file types is subject to corruption in
                various ways, but problems occur most often in data files and
                index files.
            </p><p style="color:blue;">这三种文件类型中的每一种都会以各种方式损坏，但问题通常出现在数据文件和索引文件中。</p><p>
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> works by creating a copy of the
            <code class="filename">.MYD</code> data file row by row. It ends the
            repair stage by removing the old <code class="filename">.MYD</code> file
            and renaming the new file to the original file name. If you use
            <a class="link" href="programs.html#option_myisamchk_quick"><code class="option">--quick</code></a>,
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> does not create a temporary
            <code class="filename">.MYD</code> file, but instead assumes that the
            <code class="filename">.MYD</code> file is correct and generates only a
            new index file without touching the <code class="filename">.MYD</code>
            file. This is safe, because <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>
            automatically detects whether the <code class="filename">.MYD</code> file
            is corrupt and aborts the repair if it is. You can also specify
            the <a class="link" href="programs.html#option_myisamchk_quick"><code class="option">--quick</code></a> option twice to
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>. In this case,
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> does not abort on some errors (such
            as duplicate-key errors) but instead tries to resolve them by
            modifying the <code class="filename">.MYD</code> file. Normally the use
            of two <a class="link" href="programs.html#option_myisamchk_quick"><code class="option">--quick</code></a> options is
            useful only if you have too little free disk space to perform a
            normal repair. In this case, you should at least make a backup
            of the table before running <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>.
        </p><p style="color:blue;">myisamchk的工作方式是逐行创建.myd数据文件的副本。它通过删除旧的.myd文件并将新文件重命名为原始文件名来结束修复阶段。如果使用--quick，myisamchk不会创建临时的.myd文件，而是假定.myd文件是正确的，并且只生成一个新的索引文件，而不接触.myd文件。这是安全的，因为myisamchk会自动检测.myd文件是否已损坏，如果损坏则中止修复。您还可以两次将--quick选项指定给myisamchk。在这种情况下，myisamchk不会中止某些错误（例如重复密钥错误），而是试图通过修改.myd文件来解决这些错误。通常，只有当可用磁盘空间太少而无法执行正常修复时，使用两个快速选项才有用。在这种情况下，至少应该在运行myisamchk之前备份表。</p>
        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="myisam-check"></a>7.6.2&nbsp;How to Check MyISAM Tables for Errors</h3>

                    </div>

                </div>

            </div>
            <a class="indexterm" name="idm140286876381040"></a><a class="indexterm" name="idm140286876379584"></a><a class="indexterm" name="idm140286876378096"></a><p>
            To check a <code class="literal">MyISAM</code> table, use the following
            commands:
        </p><p style="color:blue;">要检查myisam表，请使用以下命令：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk
            <em class="replaceable"><code>tbl_name</code></em></strong></span></a>
                </p><p style="color:blue;">Myisamchk待定</p><p>
                    This finds 99.99% of all errors. What it cannot find is
                    corruption that involves <span class="emphasis"><em>only</em></span> the data
                    file (which is very unusual). If you want to check a table,
                    you should normally run <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> without
                    options or with the <code class="option">-s</code> (silent) option.
                </p><p style="color:blue;">这会发现99.99%的错误。它找不到的是只涉及数据文件的损坏（这是非常不寻常的）。如果您想检查一个表，通常应该运行myisamchk而不使用选项或使用-s（silent）选项。</p></li><li class="listitem"><p>
                    <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -m
            <em class="replaceable"><code>tbl_name</code></em></strong></span></a>
                </p><p style="color:blue;">Myisamchk-待定</p><p>
                    This finds 99.999% of all errors. It first checks all index
                    entries for errors and then reads through all rows. It
                    calculates a checksum for all key values in the rows and
                    verifies that the checksum matches the checksum for the keys
                    in the index tree.
                </p><p style="color:blue;">这会发现99.999%的错误。它首先检查所有索引项是否有错误，然后读取所有行。它计算行中所有键值的校验和，并验证校验和是否与索引树中键的校验和匹配。</p></li><li class="listitem"><p>
                    <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -e
            <em class="replaceable"><code>tbl_name</code></em></strong></span></a>
                </p><p style="color:blue;">Myisamchk-姓名待定</p><p>
                    This does a complete and thorough check of all data
                    (<code class="option">-e</code> means <span class="quote">“<span class="quote">extended check</span>”</span>).
                    It does a check-read of every key for each row to verify
                    that they indeed point to the correct row. This may take a
                    long time for a large table that has many indexes. Normally,
                    <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> stops after the first error it
                    finds. If you want to obtain more information, you can add
                    the <code class="option">-v</code> (verbose) option. This causes
                    <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to keep going, up through a
                    maximum of 20 errors.
                </p><p style="color:blue;">这将对所有数据进行完整彻底的检查（e表示“扩展检查”）。它对每一行的每个键进行检查读取，以验证它们确实指向正确的行。对于具有许多索引的大型表，这可能需要很长时间。通常，myisamchk在发现第一个错误后停止。如果您想获得更多信息，可以添加-v（verbose）选项。这导致MySAMCHK继续前进，最多通过20个错误。</p></li><li class="listitem"><p>
                    <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -e -i
            <em class="replaceable"><code>tbl_name</code></em></strong></span></a>
                </p><p style="color:blue;">myisamchk-e-i待定</p><p>
                    This is like the previous command, but the
                    <code class="option">-i</code> option tells
                    <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to print additional statistical
                    information.
                </p><p style="color:blue;">这与前面的命令类似，但是-i选项告诉myisamchk打印其他统计信息。</p></li></ul>
            </div>
            <p>
                In most cases, a simple <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> command
                with no arguments other than the table name is sufficient to
                check a table.
            </p><p style="color:blue;">在大多数情况下，一个简单的myisamchk命令（除了表名之外没有其他参数）足以检查表。</p>
        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="myisam-repair"></a>7.6.3&nbsp;How to Repair MyISAM Tables</h3>

                    </div>

                </div>

            </div>
            <a class="indexterm" name="idm140286876352624"></a><a class="indexterm" name="idm140286876351168"></a><p>
            The discussion in this section describes how to use
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> on <code class="literal">MyISAM</code> tables
            (extensions <code class="filename">.MYI</code> and
            <code class="filename">.MYD</code>).
        </p><p style="color:blue;">本节中的讨论描述如何在myisam表（extensions.myi和.myd）上使用myisamchk。</p><p>
            You can also use the <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2&nbsp;CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a>
            and <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5&nbsp;REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a> statements to
            check and repair <code class="literal">MyISAM</code> tables. See
            <a class="xref" href="sql-syntax.html#check-table" title="13.7.2.2&nbsp;CHECK TABLE Syntax">Section&nbsp;13.7.2.2, “CHECK TABLE Syntax”</a>, and
            <a class="xref" href="sql-syntax.html#repair-table" title="13.7.2.5&nbsp;REPAIR TABLE Syntax">Section&nbsp;13.7.2.5, “REPAIR TABLE Syntax”</a>.
        </p><p style="color:blue;">您还可以使用check table和repair table语句来检查和修复myisam表。参见第13.7.2.2节“检查表语法”和第13.7.2.5节“修复表语法”。</p><p>
            Symptoms of corrupted tables include queries that abort
            unexpectedly and observable errors such as these:
        </p><p style="color:blue;">损坏表的症状包括意外中止的查询和可观察到的错误，例如：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.frm</code>
                    is locked against change
                </p><p style="color:blue;">tbl_name.frm已锁定，无法更改</p></li><li class="listitem"><p>
                    Can't find file
                    <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYI</code>
                    (Errcode: <em class="replaceable"><code>nnn</code></em>)
                </p><p style="color:blue;">找不到文件tbl_name.myi（错误代码：nnn）</p></li><li class="listitem"><p>
                    Unexpected end of file
                </p><p style="color:blue;">意外的文件结尾</p></li><li class="listitem"><p>
                    Record file is crashed
                </p><p style="color:blue;">记录文件崩溃</p></li><li class="listitem"><p>
                    Got error <em class="replaceable"><code>nnn</code></em> from table handler
                </p><p style="color:blue;">从表处理程序中获取错误nnn</p></li></ul>
            </div>
            <p>
                To get more information about the error, run
                <a class="link" href="programs.html#perror" title="4.8.2&nbsp;perror — Display MySQL Error Message Information"><span class="command"><strong>perror</strong></span></a> <em class="replaceable"><code>nnn</code></em>, where
                <em class="replaceable"><code>nnn</code></em> is the error number. The
                following example shows how to use <a class="link" href="programs.html#perror" title="4.8.2&nbsp;perror — Display MySQL Error Message Information"><span class="command"><strong>perror</strong></span></a> to
                find the meanings for the most common error numbers that
                indicate a problem with a table:
            </p><p style="color:blue;">要获取有关错误的详细信息，请运行perror nnn，其中nnn是错误号。下面的示例演示如何使用perror查找表示表有问题的最常见错误号的含义：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>perror 126 127 132 134 135 136 141 144 145</code></strong>
MySQL error code 126 = Index file is crashed
MySQL error code 127 = Record-file is crashed
MySQL error code 132 = Old database file
MySQL error code 134 = Record was already deleted (or record file crashed)
MySQL error code 135 = No more room in record file
MySQL error code 136 = No more room in index file
MySQL error code 141 = Duplicate unique key or constraint on write or update
MySQL error code 144 = Table is crashed and last repair failed
MySQL error code 145 = Table was marked as crashed and should be repaired
</pre><p>
            Note that error 135 (no more room in record file) and error 136
            (no more room in index file) are not errors that can be fixed by
            a simple repair. In this case, you must use
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.8&nbsp;ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to increase the
            <code class="literal">MAX_ROWS</code> and
            <code class="literal">AVG_ROW_LENGTH</code> table option values:
        </p><p style="color:blue;">注意，错误135（记录文件中没有更多的空间）和错误136（索引文件中没有更多的空间）不是可以通过简单的修复来修复的错误。在这种情况下，必须使用alter table来增加max_rows和avg_row_length table选项值：</p><pre data-lang="sql" class="programlisting">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> MAX_ROWS=<em class="replaceable"><code>xxx</code></em> AVG_ROW_LENGTH=<em class="replaceable"><code>yyy</code></em>;
</pre><p>
            If you do not know the current table option values, use
            <a class="link" href="sql-syntax.html#show-create-table" title="13.7.5.10&nbsp;SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE TABLE</code></a>.
        </p><p style="color:blue;">如果不知道当前表选项值，请使用show create table。</p><p>
            For the other errors, you must repair your tables.
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> can usually detect and fix most
            problems that occur.
        </p><p style="color:blue;">对于其他错误，必须修复表。myisamchk通常可以检测并修复大多数出现的问题。</p><p>
            The repair process involves up to four stages, described here.
            Before you begin, you should change location to the database
            directory and check the permissions of the table files. On Unix,
            make sure that they are readable by the user that
            <a class="link" href="programs.html#mysqld" title="4.3.1&nbsp;mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> runs as (and to you, because you need
            to access the files you are checking). If it turns out you need
            to modify files, they must also be writable by you.
        </p><p style="color:blue;">修理过程包括四个阶段，如下所述。开始之前，应将位置更改为数据库目录并检查表文件的权限。在unix上，确保mysqld运行的用户可以读取这些文件（对您来说，因为您需要访问正在检查的文件）。如果您需要修改文件，它们也必须是可写的。</p><p>
            This section is for the cases where a table check fails (such as
            those described in <a class="xref" href="backup-and-recovery.html#myisam-check" title="7.6.2&nbsp;How to Check MyISAM Tables for Errors">Section&nbsp;7.6.2, “How to Check MyISAM Tables for Errors”</a>), or you want
            to use the extended features that <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>
            provides.
        </p><p style="color:blue;">本节适用于表检查失败的情况（如第7.6.2节“如何检查myisam表是否有错误”）或您希望使用myisamchk提供的扩展功能。</p><p>
            The <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> options used for table
            maintenance with are described in <a class="xref" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility">Section&nbsp;4.6.3, “<span class="command"><strong>myisamchk</strong></span> — MyISAM Table-Maintenance Utility”</a>.
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> also has variables that you can set
            to control memory allocation that may improve performance. See
            <a class="xref" href="programs.html#myisamchk-memory" title="4.6.3.6&nbsp;myisamchk Memory Usage">Section&nbsp;4.6.3.6, “myisamchk Memory Usage”</a>.
        </p><p style="color:blue;">用于表维护的myisamchk选项在第4.6.3节“myisamchk-myisam表维护实用程序”中描述。myisamchk还有一些变量，可以设置为控制内存分配，从而提高性能。见4.6.3.6节，“myisamchk内存使用”。</p><p>
            If you are going to repair a table from the command line, you
            must first stop the <a class="link" href="programs.html#mysqld" title="4.3.1&nbsp;mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server. Note that
            when you do <a class="link" href="programs.html#mysqladmin" title="4.5.2&nbsp;mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin shutdown</strong></span></a> on a remote
            server, the <a class="link" href="programs.html#mysqld" title="4.3.1&nbsp;mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server is still available
            for a while after <a class="link" href="programs.html#mysqladmin" title="4.5.2&nbsp;mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a> returns, until
            all statement-processing has stopped and all index changes have
            been flushed to disk.
        </p><p style="color:blue;">如果要从命令行修复表，必须首先停止mysqld服务器。请注意，当您在远程服务器上关闭mysqladmin时，mysqld服务器在mysqladmin返回后仍有一段时间可用，直到所有语句处理都停止并且所有索引更改都刷新到磁盘为止。</p><p>
            <span class="bold"><strong>Stage 1: Checking your tables</strong></span>
        </p><p style="color:blue;">第一步：检查你的桌子</p><p>
            Run <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk *.MYI</strong></span></a> or <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -e
        *.MYI</strong></span></a> if you have more time. Use the
            <code class="option">-s</code> (silent) option to suppress unnecessary
            information.
        </p><p style="color:blue;">如果有更多时间，请运行myisamchk*.myi或myisamchk-e*.myi。使用-s（静默）选项抑制不必要的信息。</p><p>
            If the <a class="link" href="programs.html#mysqld" title="4.3.1&nbsp;mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server is stopped, you should
            use the <a class="link" href="programs.html#option_myisamchk_update-state"><code class="option">--update-state</code></a> option
            to tell <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to mark the table as
            <span class="quote">“<span class="quote">checked.</span>”</span>
        </p><p style="color:blue;">如果mysqld服务器已停止，则应使用--update state选项告诉myisamchk将表标记为“checked”。</p><p>
            You have to repair only those tables for which
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> announces an error. For such
            tables, proceed to Stage 2.
        </p><p style="color:blue;">您只需修复Myisamchk宣布出错的表。对于此类表格，进入第2阶段。</p><p>
            If you get unexpected errors when checking (such as <code class="literal">out
            of memory</code> errors), or if <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>
            crashes, go to Stage 3.
        </p><p style="color:blue;">如果在检查时出现意外错误（例如内存不足错误），或者myisamchk崩溃，请转到第3阶段。</p><p>
            <span class="bold"><strong>Stage 2: Easy safe repair</strong></span>
        </p><p style="color:blue;">第二阶段：易于安全维修</p><p>
            First, try <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -r -q
        <em class="replaceable"><code>tbl_name</code></em></strong></span></a> (<code class="option">-r
            -q</code> means <span class="quote">“<span class="quote">quick recovery mode</span>”</span>). This
            attempts to repair the index file without touching the data
            file. If the data file contains everything that it should and
            the delete links point at the correct locations within the data
            file, this should work, and the table is fixed. Start repairing
            the next table. Otherwise, use the following procedure:
        </p><p style="color:blue;">首先，尝试myisamchk-r-q tbl_name（-r-q表示“快速恢复模式”）。这将尝试在不接触数据文件的情况下修复索引文件。如果数据文件包含它应该包含的所有内容，并且删除链接指向数据文件中的正确位置，则此操作应该有效，并且表是固定的。开始修理下一张桌子。否则，请使用以下步骤：</p>
            <div class="orderedlist">
                <ol class="orderedlist" type="1"><li class="listitem"><p>
                    Make a backup of the data file before continuing.
                </p><p style="color:blue;">在继续之前备份数据文件。</p></li><li class="listitem"><p>
                    Use <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -r
            <em class="replaceable"><code>tbl_name</code></em></strong></span></a>
                    (<code class="option">-r</code> means <span class="quote">“<span class="quote">recovery mode</span>”</span>).
                    This removes incorrect rows and deleted rows from the data
                    file and reconstructs the index file.
                </p><p style="color:blue;">使用myisamchk-r tbl_name（-r表示“恢复模式”）。这将从数据文件中删除不正确的行和已删除的行，并重新构造索引文件。</p></li><li class="listitem"><p>
                    If the preceding step fails, use <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk
            --safe-recover
            <em class="replaceable"><code>tbl_name</code></em></strong></span></a>. Safe recovery
                    mode uses an old recovery method that handles a few cases
                    that regular recovery mode does not (but is slower).
                </p><p style="color:blue;">如果前面的步骤失败，请使用myisamchk--safe recover tbl_name。安全恢复模式使用一种旧的恢复方法，它可以处理一些常规恢复模式不能处理的情况（但速度较慢）。</p></li></ol>
            </div>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                <div class="admon-title">
                    Note
                </div>
                <p>
                    If you want a repair operation to go much faster, you should
                    set the values of the
                    <a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a> and
                    <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> variables
                    each to about 25% of your available memory when running
                    <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>.
                </p><p style="color:blue;">如果希望修复操作更快，则应在运行myisamchk时将sort_buffer_size和key_buffer_size变量的值分别设置为可用内存的25%左右。</p>
            </div>
            <p>
                If you get unexpected errors when repairing (such as
                <code class="literal">out of memory</code> errors), or if
                <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> crashes, go to Stage 3.
            </p><p style="color:blue;">如果在修复时遇到意外错误（例如内存不足错误），或者myisamchk崩溃，请转到第3阶段。</p><p>
            <span class="bold"><strong>Stage 3: Difficult repair</strong></span>
        </p><p style="color:blue;">第3阶段：难以修复</p><p>
            You should reach this stage only if the first 16KB block in the
            index file is destroyed or contains incorrect information, or if
            the index file is missing. In this case, it is necessary to
            create a new index file. Do so as follows:
        </p><p style="color:blue;">只有当索引文件中的第一个16KB块被破坏或包含不正确的信息，或者索引文件丢失时，才应进入此阶段。在这种情况下，需要创建一个新的索引文件。操作如下：</p>
            <div class="orderedlist">
                <ol class="orderedlist" type="1"><li class="listitem"><p>
                    Move the data file to a safe place.
                </p><p style="color:blue;">将数据文件移到安全的地方。</p></li><li class="listitem"><p>
                    Use the table description file to create new (empty) data
                    and index files:
                </p><p style="color:blue;">使用表说明文件创建新（空）数据和索引文件：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>mysql <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><pre data-lang="sql" class="programlisting">mysql&gt; <strong class="userinput"><code>SET autocommit=1;</code></strong>
mysql&gt; <strong class="userinput"><code>TRUNCATE TABLE <em class="replaceable"><code>tbl_name</code></em>;</code></strong>
mysql&gt; <strong class="userinput"><code>quit</code></strong>
</pre></li><li class="listitem"><p>
                    Copy the old data file back onto the newly created data
                    file. (Do not just move the old file back onto the new file.
                    You want to retain a copy in case something goes wrong.)
                </p><p style="color:blue;">将旧数据文件复制回新创建的数据文件。（不要将旧文件移回新文件。你想保留一份副本以防出错。）</p></li></ol>
            </div>
            <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
                <div class="admon-title">
                    Important
                </div>
                <p>
                    If you are using replication, you should stop it prior to
                    performing the above procedure, since it involves file system
                    operations, and these are not logged by MySQL.
                </p><p style="color:blue;">如果您使用的是复制，那么您应该在执行上述过程之前停止复制，因为它涉及到文件系统操作，并且这些操作不由mysql记录。</p>
            </div>
            <p>
                Go back to Stage 2. <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -r -q</strong></span></a> should
                work. (This should not be an endless loop.)
            </p><p style="color:blue;">回到第二阶段。myisamchk-r-q应该有用。（这不应该是一个无止境的循环。）</p><p>
            You can also use the <code class="literal">REPAIR TABLE
            <em class="replaceable"><code>tbl_name</code></em> USE_FRM</code> SQL
            statement, which performs the whole procedure automatically.
            There is also no possibility of unwanted interaction between a
            utility and the server, because the server does all the work
            when you use <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5&nbsp;REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>. See
            <a class="xref" href="sql-syntax.html#repair-table" title="13.7.2.5&nbsp;REPAIR TABLE Syntax">Section&nbsp;13.7.2.5, “REPAIR TABLE Syntax”</a>.
        </p><p style="color:blue;">您还可以使用repair table tbl_name use_frm sql语句，该语句将自动执行整个过程。实用程序和服务器之间也不存在不必要的交互，因为当您使用repair table时，服务器会完成所有工作。见第13.7.2.5节“修复表语法”。</p><p>
            <span class="bold"><strong>Stage 4: Very difficult repair</strong></span>
        </p><p style="color:blue;">第4阶段：非常难修复</p><p>
            You should reach this stage only if the
            <code class="filename">.frm</code> description file has also crashed.
            That should never happen, because the description file is not
            changed after the table is created:
        </p><p style="color:blue;">只有当.frm描述文件也崩溃时，您才应该进入此阶段。这种情况永远不会发生，因为创建表后描述文件不会更改：</p>
            <div class="orderedlist">
                <ol class="orderedlist" type="1"><li class="listitem"><p>
                    Restore the description file from a backup and go back to
                    Stage 3. You can also restore the index file and go back to
                    Stage 2. In the latter case, you should start with
                    <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -r</strong></span></a>.
                </p><p style="color:blue;">从备份还原描述文件并返回到第3阶段。您还可以还原索引文件并返回到第2阶段。在后一种情况下，你应该从myisamchk-r开始。</p></li><li class="listitem"><p>
                    If you do not have a backup but know exactly how the table
                    was created, create a copy of the table in another database.
                    Remove the new data file, and then move the
                    <code class="filename">.frm</code> description and
                    <code class="filename">.MYI</code> index files from the other
                    database to your crashed database. This gives you new
                    description and index files, but leaves the
                    <code class="filename">.MYD</code> data file alone. Go back to Stage
                    2 and attempt to reconstruct the index file.
                </p><p style="color:blue;">如果您没有备份，但确切知道表是如何创建的，请在另一个数据库中创建表的副本。删除新的数据文件，然后将.frm描述和.myi索引文件从另一个数据库移到崩溃的数据库。这将为您提供新的描述和索引文件，但只留下.myd数据文件。返回到第2阶段并尝试重建索引文件。</p></li></ol>
            </div>

        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="myisam-optimization"></a>7.6.4&nbsp;MyISAM Table Optimization</h3>

                    </div>

                </div>

            </div>
            <a class="indexterm" name="idm140286876243728"></a><a class="indexterm" name="idm140286876242272"></a><p>
            To coalesce fragmented rows and eliminate wasted space that
            results from deleting or updating rows, run
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> in recovery mode:
        </p><p style="color:blue;">要合并碎片行并消除删除或更新行所造成的浪费空间，请在恢复模式下运行myisamchk：</p><pre data-lang="sql" class="programlisting">shell&gt; <strong class="userinput"><code>myisamchk -r <em class="replaceable"><code>tbl_name</code></em></code></strong>
</pre><p>
            You can optimize a table in the same way by using the
            <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4&nbsp;OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> SQL statement.
            <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4&nbsp;OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> does a table
            repair and a key analysis, and also sorts the index tree so that
            key lookups are faster. There is also no possibility of unwanted
            interaction between a utility and the server, because the server
            does all the work when you use <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4&nbsp;OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
            TABLE</code></a>. See <a class="xref" href="sql-syntax.html#optimize-table" title="13.7.2.4&nbsp;OPTIMIZE TABLE Syntax">Section&nbsp;13.7.2.4, “OPTIMIZE TABLE Syntax”</a>.
        </p><p style="color:blue;">您可以使用optimize table sql语句以同样的方式优化表。optimize table执行表修复和键分析，并对索引树进行排序，以便键查找更快。实用程序和服务器之间也不存在不必要的交互，因为当您使用optimize table时，服务器会完成所有工作。见第13.7.2.4节“优化表语法”。</p><p>
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> has a number of other options that
            you can use to improve the performance of a table:
        </p><p style="color:blue;">myisamchk还有许多其他选项可用于提高表的性能：</p>
            <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    <a class="link" href="programs.html#option_myisamchk_analyze"><code class="option">--analyze</code></a> or
                    <code class="option">-a</code>: Perform key distribution analysis. This
                    improves join performance by enabling the join optimizer to
                    better choose the order in which to join the tables and
                    which indexes it should use.
                </p><p style="color:blue;">--分析或-a：执行密钥分配分析。这通过使联接优化器能够更好地选择联接表的顺序以及应该使用哪些索引来提高联接性能。</p></li><li class="listitem"><p>
                    <a class="link" href="programs.html#option_myisamchk_sort-index"><code class="option">--sort-index</code></a> or
                    <code class="option">-S</code>: Sort the index blocks. This optimizes
                    seeks and makes table scans that use indexes faster.
                </p><p style="color:blue;">--排序索引或-s：对索引块排序。这优化了查找并使使用索引的表扫描更快。</p></li><li class="listitem"><p>
                    <a class="link" href="programs.html#option_myisamchk_sort-records"><code class="option">--sort-records=<em class="replaceable"><code>index_num</code></em></code></a>
                    or <code class="option">-R <em class="replaceable"><code>index_num</code></em></code>:
                    Sort data rows according to a given index. This makes your
                    data much more localized and may speed up range-based
                    <a class="link" href="sql-syntax.html#select" title="13.2.9&nbsp;SELECT Syntax"><code class="literal">SELECT</code></a> and <code class="literal">ORDER
                    BY</code> operations that use this index.
                </p><p style="color:blue;">--sort records=index_num或-r index_num：根据给定索引对数据行排序。这将使您的数据更加本地化，并可能加速使用此索引的基于范围的选择和按顺序操作。</p></li></ul>
            </div>
            <p>
                For a full description of all available options, see
                <a class="xref" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility">Section&nbsp;4.6.3, “<span class="command"><strong>myisamchk</strong></span> — MyISAM Table-Maintenance Utility”</a>.
            </p><p style="color:blue;">有关所有可用选项的完整说明，请参阅第4.6.3节“MyISAMCHK-MyISAM表格维护实用程序”。</p>
        </div>
        <div class="section">
            <div class="titlepage">
                <div>
                    <div>
                        <h3 class="title"><a name="myisam-maintenance-schedule"></a>7.6.5&nbsp;Setting Up a MyISAM Table Maintenance Schedule</h3>

                    </div>

                </div>

            </div>
            <a class="indexterm" name="idm140286876217856"></a><a class="indexterm" name="idm140286876216368"></a><p>
            It is a good idea to perform table checks on a regular basis
            rather than waiting for problems to occur. One way to check and
            repair <code class="literal">MyISAM</code> tables is with the
            <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2&nbsp;CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> and
            <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5&nbsp;REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a> statements. See
            <a class="xref" href="sql-syntax.html#table-maintenance-sql" title="13.7.2&nbsp;Table Maintenance Statements">Section&nbsp;13.7.2, “Table Maintenance Statements”</a>.
        </p><p style="color:blue;">最好定期执行表检查，而不是等待出现问题。检查和修复myisam表的一种方法是使用check table和repair table语句。见第13.7.2节，“表维护说明”。</p><p>
            Another way to check tables is to use
            <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>. For maintenance purposes, you can
            use <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -s</strong></span></a>. The <code class="option">-s</code>
            option (short for <a class="link" href="programs.html#option_myisamchk_silent"><code class="option">--silent</code></a>)
            causes <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to run in silent mode,
            printing messages only when errors occur.
        </p><p style="color:blue;">另一种检查表格的方法是使用myisamchk。出于维护目的，您可以使用myisamchk-s，-s选项（简称--silent）使myisamchk在静默模式下运行，仅当发生错误时才打印消息。</p><a class="indexterm" name="idm140286876204848"></a><p>
            It is also a good idea to enable automatic
            <code class="literal">MyISAM</code> table checking. For example, whenever
            the machine has done a restart in the middle of an update, you
            usually need to check each table that could have been affected
            before it is used further. (These are <span class="quote">“<span class="quote">expected crashed
        tables.</span>”</span>) To cause the server to check
            <code class="literal">MyISAM</code> tables automatically, start it with
            the <a class="link" href="server-administration.html#sysvar_myisam_recover_options"><code class="literal">myisam_recover_options</code></a>
            system variable set. See
            <a class="xref" href="server-administration.html#server-system-variables" title="5.1.7&nbsp;Server System Variables">Section&nbsp;5.1.7, “Server System Variables”</a>.
        </p><p style="color:blue;">启用myisam表自动检查也是一个好主意。例如，每当计算机在更新过程中重新启动时，通常需要检查每个可能受到影响的表，然后才能进一步使用它。（这些是“预期的崩溃表”。）要使服务器自动检查myisam表，请使用myisam_recover_options系统变量集启动它。见第5.1.7节“服务器系统变量”。</p><p>
            You should also check your tables regularly during normal system
            operation. For example, you can run a <span class="command"><strong>cron</strong></span>
            job to check important tables once a week, using a line like
            this in a <code class="filename">crontab</code> file:
        </p><p style="color:blue;">在系统正常运行期间，您还应该定期检查您的表。例如，可以在crontab文件中使用这样的行，每周运行一次cron作业来检查重要的表：</p><pre data-lang="simple" class="programlisting">35 0 * * 0 <em class="replaceable"><code>/path/to/myisamchk</code></em> --fast --silent <em class="replaceable"><code>/path/to/datadir</code></em>/*/*.MYI
</pre><p>
            This prints out information about crashed tables so that you can
            examine and repair them as necessary.
        </p><p style="color:blue;">这将打印出有关崩溃表的信息，以便您可以在必要时检查和修复它们。</p><p>
            To start with, execute <a class="link" href="programs.html#myisamchk" title="4.6.3&nbsp;myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -s</strong></span></a> each
            night on all tables that have been updated during the last 24
            hours. As you see that problems occur infrequently, you can back
            off the checking frequency to once a week or so.
        </p><p style="color:blue;">首先，每晚对所有在过去24小时内更新的表执行myisamchk-s。正如您所看到的，问题很少发生，您可以将检查频率调到每周一次左右。</p><a class="indexterm" name="idm140286876192896"></a><p>
            Normally, MySQL tables need little maintenance. If you are
            performing many updates to <code class="literal">MyISAM</code> tables with
            dynamic-sized rows (tables with
            <a class="link" href="data-types.html#char" title="11.4.1&nbsp;The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
            <a class="link" href="data-types.html#blob" title="11.4.3&nbsp;The BLOB and TEXT Types"><code class="literal">BLOB</code></a>, or
            <a class="link" href="data-types.html#blob" title="11.4.3&nbsp;The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns) or have tables with
            many deleted rows you may want to defragment/reclaim space from
            the tables from time to time. You can do this by using
            <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4&nbsp;OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> on the tables in
            question. Alternatively, if you can stop the
            <a class="link" href="programs.html#mysqld" title="4.3.1&nbsp;mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server for a while, change location
            into the data directory and use this command while the server is
            stopped:
        </p><p style="color:blue;">通常，mysql表需要很少的维护。如果您正在使用动态大小的行（包含varchar、blob或text列的表）对myisam表执行许多更新，或者有包含许多已删除行的表，则可能需要不时对这些表进行碎片整理/回收空间。可以通过对相关表使用优化表来完成此操作。或者，如果可以暂时停止mysqld服务器，请将位置更改为数据目录，并在服务器停止时使用此命令：</p><pre data-lang="terminal" class="programlisting">shell&gt; <strong class="userinput"><code>myisamchk -r -s --sort-index --myisam_sort_buffer_size=16M */*.MYI</code></strong>
</pre>
        </div>

    </div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
    <hr>
    <table width="100%" summary="Navigation footer">
        <tbody><tr>
            <td width="40%" align="left"><a accesskey="p" href="security.html">Prev</a></td>
            <td width="20%" align="center"><a accesskey="u" href="">Up</a></td>
            <td width="40%" align="right">&nbsp;<a accesskey="n" href="optimization.html">Next</a></td>
        </tr>
        <tr>
            <td width="40%" align="left" valign="top">Chapter&nbsp;6 Security</td>
            <td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
            <td width="40%" align="right" valign="top">Chapter&nbsp;8 Optimization</td>
        </tr>
        </tbody></table>
</div>


</body></html>